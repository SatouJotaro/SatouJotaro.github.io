<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"satoujotaro.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="关于我从24年开始拖拖拉拉的喊“我要学SQL”最后只完成了喊如今箭在弦上不得不发挑战一天速成而据说这本又经典又简单于是又抱着应该一天就能学会的妄想翻开了书24年请教学长的建议：  1&#x2F;22 基本概念 一些基本的数据库概念   数据库 数据库管理系统 表 表名 模式 列 数据类型 行 记录 主键 外键    标准 SQL(ANSI SQL) PL&#x2F;SQL(Oracle) Tra">
<meta property="og:type" content="article">
<meta property="og:title" content="【读书笔记】《SQL必知必会》">
<meta property="og:url" content="https://satoujotaro.github.io/2025/02/20/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E3%80%8ASQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E3%80%8B/index.html">
<meta property="og:site_name" content="Hakuxc">
<meta property="og:description" content="关于我从24年开始拖拖拉拉的喊“我要学SQL”最后只完成了喊如今箭在弦上不得不发挑战一天速成而据说这本又经典又简单于是又抱着应该一天就能学会的妄想翻开了书24年请教学长的建议：  1&#x2F;22 基本概念 一些基本的数据库概念   数据库 数据库管理系统 表 表名 模式 列 数据类型 行 记录 主键 外键    标准 SQL(ANSI SQL) PL&#x2F;SQL(Oracle) Tra">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://satoujotaro.github.io/images/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A1.png">
<meta property="og:image" content="https://satoujotaro.github.io/images/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A2.png">
<meta property="og:image" content="https://satoujotaro.github.io/images/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A3.png">
<meta property="article:published_time" content="2025-02-20T10:10:49.000Z">
<meta property="article:modified_time" content="2025-02-23T12:51:01.090Z">
<meta property="article:author" content="Hakuxc在存档">
<meta property="article:tag" content="读书笔记">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://satoujotaro.github.io/images/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A1.png">


<link rel="canonical" href="https://satoujotaro.github.io/2025/02/20/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E3%80%8ASQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E3%80%8B/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://satoujotaro.github.io/2025/02/20/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E3%80%8ASQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E3%80%8B/","path":"2025/02/20/【读书笔记】《SQL必知必会》/","title":"【读书笔记】《SQL必知必会》"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【读书笔记】《SQL必知必会》 | Hakuxc</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hakuxc</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-22-%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">1&#x2F;22 基本概念</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-22-%E9%80%89%E6%8B%A9-SELECT"><span class="nav-number">2.</span> <span class="nav-text">2&#x2F;22 选择 SELECT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-number">2.1.</span> <span class="nav-text">常用关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SELECT-%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.2.</span> <span class="nav-text">SELECT 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE"><span class="nav-number">2.2.1.</span> <span class="nav-text">查询所有数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A"><span class="nav-number">2.2.1.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="nav-number">2.2.1.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E5%88%97%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">2.2.2.</span> <span class="nav-text">查询指定列的数据</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-1"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-1"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-WHERE-%E5%AD%90%E5%8F%A5%E8%BF%9B%E8%A1%8C%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-number">2.2.3.</span> <span class="nav-text">使用 WHERE 子句进行条件查询</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-2"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-2"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-AND-%E5%92%8C-OR-%E8%BF%9E%E6%8E%A5%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6"><span class="nav-number">2.2.4.</span> <span class="nav-text">使用 AND 和 OR 连接多个条件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-3"><span class="nav-number">2.2.4.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-3"><span class="nav-number">2.2.4.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-ORDER-BY-%E6%8E%92%E5%BA%8F%E7%BB%93%E6%9E%9C"><span class="nav-number">2.2.5.</span> <span class="nav-text">使用 ORDER BY 排序结果</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-4"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-4"><span class="nav-number">2.2.5.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-LIMIT-%E9%99%90%E5%88%B6%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">2.2.6.</span> <span class="nav-text">使用 LIMIT 限制返回结果的数量</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-5"><span class="nav-number">2.2.6.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-5"><span class="nav-number">2.2.6.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-DISTINCT-%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%AE%B0%E5%BD%95"><span class="nav-number">2.2.7.</span> <span class="nav-text">使用 DISTINCT 去除重复记录</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-6"><span class="nav-number">2.2.7.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-6"><span class="nav-number">2.2.7.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-LIKE-%E8%BF%9B%E8%A1%8C%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D"><span class="nav-number">2.2.8.</span> <span class="nav-text">使用 LIKE 进行模糊匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-7"><span class="nav-number">2.2.8.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-7"><span class="nav-number">2.2.8.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-IN-%E6%9D%A5%E5%8C%B9%E9%85%8D%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="nav-number">2.2.9.</span> <span class="nav-text">使用 IN 来匹配多个值</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-8"><span class="nav-number">2.2.9.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-8"><span class="nav-number">2.2.9.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-BETWEEN-%E6%9F%A5%E8%AF%A2%E8%8C%83%E5%9B%B4"><span class="nav-number">2.2.10.</span> <span class="nav-text">使用 BETWEEN 查询范围</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-9"><span class="nav-number">2.2.10.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-9"><span class="nav-number">2.2.10.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-GROUP-BY-%E5%92%8C%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">2.2.11.</span> <span class="nav-text">使用 GROUP BY 和聚合函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-10"><span class="nav-number">2.2.11.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-10"><span class="nav-number">2.2.11.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-HAVING-%E5%AF%B9%E5%88%86%E7%BB%84%E7%BB%93%E6%9E%9C%E8%BF%9B%E8%A1%8C%E7%AD%9B%E9%80%89"><span class="nav-number">2.2.12.</span> <span class="nav-text">使用 HAVING 对分组结果进行筛选</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%EF%BC%9A-11"><span class="nav-number">2.2.12.1.</span> <span class="nav-text">语法：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A-11"><span class="nav-number">2.2.12.2.</span> <span class="nav-text">示例：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%85%E4%BC%9A"><span class="nav-number">2.2.13.</span> <span class="nav-text">必会</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-22-%E6%8E%92%E5%BA%8F-ORDER-BY"><span class="nav-number">3.</span> <span class="nav-text">3&#x2F;22 排序 ORDER BY</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ORDER-BY-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">ORDER BY 的基本用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%89%E5%A4%9A%E4%B8%AA%E5%88%97%E6%8E%92%E5%BA%8F"><span class="nav-number">3.2.</span> <span class="nav-text">按多个列排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%89%E5%88%97%E4%BD%8D%E7%BD%AE%E6%8E%92%E5%BA%8F"><span class="nav-number">3.3.</span> <span class="nav-text">按列位置排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NULL-%E5%80%BC%E7%9A%84%E6%8E%92%E5%BA%8F%E9%80%BB%E8%BE%91"><span class="nav-number">3.4.</span> <span class="nav-text">NULL 值的排序逻辑</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ORDER-BY-%E5%92%8C-LIMIT-%E7%BB%93%E5%90%88"><span class="nav-number">3.5.</span> <span class="nav-text">ORDER BY 和 LIMIT 结合</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%85%E4%BC%9A-1"><span class="nav-number">3.6.</span> <span class="nav-text">必会</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F%E6%97%B6%EF%BC%8C%E6%98%AF%E5%90%A6%E5%8C%BA%E5%88%86%E5%A4%A7%E5%B0%8F%E5%86%99%EF%BC%9F"><span class="nav-number">3.7.</span> <span class="nav-text">数据库对文本数据排序时，是否区分大小写？</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-5-22-%E8%BF%87%E6%BB%A4-WHERE"><span class="nav-number">4.</span> <span class="nav-text">4&amp;5&#x2F;22 过滤 WHERE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-WHERE-%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">4.1.</span> <span class="nav-text">使用 WHERE 过滤数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%A4%9A%E4%B8%AA%E6%9D%A1%E4%BB%B6-AND-OR"><span class="nav-number">4.2.</span> <span class="nav-text">过滤多个条件 (AND &#x2F; OR)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-IN-%E8%BF%87%E6%BB%A4%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="nav-number">4.3.</span> <span class="nav-text">使用 IN 过滤多个值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-BETWEEN-%E8%BF%87%E6%BB%A4%E8%8C%83%E5%9B%B4"><span class="nav-number">4.4.</span> <span class="nav-text">使用 BETWEEN 过滤范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-LIKE-%E8%BF%9B%E8%A1%8C%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D-1"><span class="nav-number">4.5.</span> <span class="nav-text">使用 LIKE 进行模糊匹配</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81-LIKE-%E8%AF%AD%E6%B3%95"><span class="nav-number">4.5.1.</span> <span class="nav-text">常见 LIKE 语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%84%E7%90%86-NULL-%E5%80%BC"><span class="nav-number">4.6.</span> <span class="nav-text">处理 NULL 值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E5%90%88-ORDER-BY-%E8%BF%9B%E8%A1%8C%E6%8E%92%E5%BA%8F"><span class="nav-number">4.7.</span> <span class="nav-text">结合 ORDER BY 进行排序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E5%90%88-LIMIT-%E9%99%90%E5%88%B6%E7%BB%93%E6%9E%9C"><span class="nav-number">4.8.</span> <span class="nav-text">结合 LIMIT 限制结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-22-%E9%80%9A%E9%85%8D%E7%AC%A6-%E8%B0%93%E8%AF%8D"><span class="nav-number">5.</span> <span class="nav-text">6&#x2F;22 通配符&amp;谓词</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6%EF%BC%88Wildcard%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">通配符（Wildcard）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.1.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%93%E8%AF%8D%EF%BC%88Predicate%EF%BC%89"><span class="nav-number">5.2.</span> <span class="nav-text">谓词（Predicate）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">5.2.1.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E9%85%8D%E7%AC%A6-vs-%E8%B0%93%E8%AF%8D-%E7%9A%84%E5%85%B3%E9%94%AE%E5%8C%BA%E5%88%AB"><span class="nav-number">5.3.</span> <span class="nav-text">通配符 vs 谓词 的关键区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E5%90%88%E9%80%9A%E9%85%8D%E7%AC%A6%E5%92%8C%E8%B0%93%E8%AF%8D"><span class="nav-number">5.4.</span> <span class="nav-text">结合通配符和谓词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B9%E6%8B%AC%E5%8F%B7%E9%80%9A%E9%85%8D%E7%AC%A6"><span class="nav-number">5.5.</span> <span class="nav-text">方括号通配符</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-22-%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5"><span class="nav-number">6.</span> <span class="nav-text">7&#x2F;22 计算字段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5%EF%BC%88Calculated-Fields%EF%BC%89%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="nav-number">6.1.</span> <span class="nav-text">计算字段（Calculated Fields）是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5%E7%9A%84%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95"><span class="nav-number">6.2.</span> <span class="nav-text">计算字段的常见用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.3.</span> <span class="nav-text">计算字段的示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="nav-number">6.3.1.</span> <span class="nav-text">** 基本算术运算**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">6.3.2.</span> <span class="nav-text">连接字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%97%A5%E6%9C%9F%E6%95%B0%E6%8D%AE"><span class="nav-number">6.3.3.</span> <span class="nav-text">处理日期数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E5%B0%8F%E6%95%B0"><span class="nav-number">6.3.4.</span> <span class="nav-text">** 处理小数**</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5-vs-%E6%95%B0%E6%8D%AE%E8%A1%A8%E5%AD%97%E6%AE%B5"><span class="nav-number">6.4.</span> <span class="nav-text">计算字段 vs 数据表字段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5%E5%A6%82%E4%BD%95%E6%B0%B8%E4%B9%85%E5%AD%98%E5%82%A8%EF%BC%9F"><span class="nav-number">6.5.</span> <span class="nav-text">计算字段如何永久存储？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-1%EF%BC%9A%E5%9C%A8%E8%A1%A8%E4%B8%AD%E6%96%B0%E5%A2%9E%E5%88%97%EF%BC%8C%E5%B9%B6%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0"><span class="nav-number">6.5.1.</span> <span class="nav-text">方法 1：在表中新增列，并手动更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-2%EF%BC%9A%E4%BD%BF%E7%94%A8-GENERATED-COLUMN%EF%BC%88%E7%94%9F%E6%88%90%E5%88%97%EF%BC%89"><span class="nav-number">6.5.2.</span> <span class="nav-text">方法 2：使用 GENERATED COLUMN（生成列）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-3%EF%BC%9A%E5%88%9B%E5%BB%BA%E6%96%B0%E8%A1%A8%E5%AD%98%E5%82%A8%E8%AE%A1%E7%AE%97%E5%AD%97%E6%AE%B5"><span class="nav-number">6.5.3.</span> <span class="nav-text">方法 3：创建新表存储计算字段</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#8-22-%E5%87%BD%E6%95%B0"><span class="nav-number">7.</span> <span class="nav-text">8&#x2F;22 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E5%87%BD%E6%95%B0%EF%BC%88Text-Functions%EF%BC%89"><span class="nav-number">7.1.</span> <span class="nav-text">文本函数（Text Functions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0%EF%BC%88Numeric-Functions%EF%BC%89"><span class="nav-number">7.2.</span> <span class="nav-text">数值函数（Numeric Functions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0%EF%BC%88Date-and-Time-Functions%EF%BC%89"><span class="nav-number">7.3.</span> <span class="nav-text">日期和时间函数（Date and Time Functions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%87%BD%E6%95%B0%EF%BC%88Formatting-Functions%EF%BC%89"><span class="nav-number">7.4.</span> <span class="nav-text">格式化函数（Formatting Functions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%87%BD%E6%95%B0%EF%BC%88System-Functions%EF%BC%89"><span class="nav-number">7.5.</span> <span class="nav-text">系统函数（System Functions）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%85%B6%E4%BB%96"><span class="nav-number">7.6.</span> <span class="nav-text">一些其他</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SOUNDEX-%E5%87%BD%E6%95%B0"><span class="nav-number">7.6.1.</span> <span class="nav-text">SOUNDEX() 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SOUNDEX-%E5%9C%A8-MySQL-%E4%B8%AD%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-number">7.6.1.1.</span> <span class="nav-text">SOUNDEX() 在 MySQL 中的用法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SOUNDEX-%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">7.6.1.2.</span> <span class="nav-text">SOUNDEX() 的应用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SOUNDEX-%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="nav-number">7.6.1.3.</span> <span class="nav-text">SOUNDEX() 的局限性</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#9-10-22-%E8%81%9A%E9%9B%86-%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="nav-number">8.</span> <span class="nav-text">9&amp;10&#x2F;22 聚集&#x2F;分组函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#COUNT-%E8%AE%A1%E7%AE%97%E8%AE%B0%E5%BD%95%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">8.1.</span> <span class="nav-text">COUNT(): 计算记录的数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SUM-%E8%AE%A1%E7%AE%97%E6%95%B0%E5%80%BC%E5%88%97%E7%9A%84%E6%80%BB%E5%92%8C"><span class="nav-number">8.2.</span> <span class="nav-text">SUM(): 计算数值列的总和</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AVG-%E8%AE%A1%E7%AE%97%E6%95%B0%E5%80%BC%E5%88%97%E7%9A%84%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="nav-number">8.3.</span> <span class="nav-text">AVG(): 计算数值列的平均值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MIN-%E8%8E%B7%E5%8F%96%E6%9C%80%E5%B0%8F%E5%80%BC"><span class="nav-number">8.4.</span> <span class="nav-text">MIN(): 获取最小值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MAX-%E8%8E%B7%E5%8F%96%E6%9C%80%E5%A4%A7%E5%80%BC"><span class="nav-number">8.5.</span> <span class="nav-text">MAX(): 获取最大值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-CONCAT-%E8%BF%9E%E6%8E%A5%E5%A4%9A%E4%B8%AA%E8%A1%8C%E7%9A%84%E5%80%BC"><span class="nav-number">8.6.</span> <span class="nav-text">GROUP_CONCAT(): 连接多个行的值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-GROUP-BY-%E5%AD%90%E5%8F%A5%E7%BB%93%E5%90%88%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0"><span class="nav-number">8.7.</span> <span class="nav-text">使用 GROUP BY 子句结合聚集函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E6%8C%89%E9%A1%BE%E5%AE%A2%E5%88%86%E7%BB%84%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E9%A1%BE%E5%AE%A2%E7%9A%84%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F"><span class="nav-number">8.7.1.</span> <span class="nav-text">例子：按顾客分组，计算每个顾客的订单数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E6%8C%89%E4%BA%A7%E5%93%81%E5%88%86%E7%BB%84%EF%BC%8C%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E4%BA%A7%E5%93%81%E7%9A%84%E6%80%BB%E9%94%80%E5%94%AE%E6%95%B0%E9%87%8F"><span class="nav-number">8.7.2.</span> <span class="nav-text">例子：按产品分组，计算每个产品的总销售数量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HAVING-%E5%AD%90%E5%8F%A5%EF%BC%9A%E5%AF%B9%E5%88%86%E7%BB%84%E5%90%8E%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E7%AD%9B%E9%80%89"><span class="nav-number">8.8.</span> <span class="nav-text">HAVING 子句：对分组后的数据进行筛选</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E7%AD%9B%E9%80%89%E5%87%BA%E9%94%80%E5%94%AE%E6%80%BB%E9%A2%9D%E8%B6%85%E8%BF%87-500-%E7%9A%84%E4%BA%A7%E5%93%81"><span class="nav-number">8.8.1.</span> <span class="nav-text">例子：筛选出销售总额超过 500 的产品</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="nav-number">8.9.</span> <span class="nav-text">常见的聚集函数总结：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%9A%E4%BD%BF%E7%94%A8-WITH-ROLLUP-%E6%89%A9%E5%B1%95-GROUP-BY"><span class="nav-number">8.9.1.</span> <span class="nav-text">进阶：使用 WITH ROLLUP 扩展 GROUP BY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%8B%E5%AD%90%EF%BC%9A%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E9%A1%BE%E5%AE%A2%E7%9A%84%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F%EF%BC%8C%E5%90%8C%E6%97%B6%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E9%A1%BE%E5%AE%A2%E7%9A%84%E6%80%BB%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F"><span class="nav-number">8.9.2.</span> <span class="nav-text">例子：统计每个顾客的订单数量，同时显示所有顾客的总订单数量</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HAVING-%E5%92%8C-WHERE%E5%8C%BA%E5%88%AB%EF%BC%9A"><span class="nav-number">8.10.</span> <span class="nav-text">HAVING 和 WHERE区别：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-BY-%E5%92%8C-ORDER-BY-%E5%8C%BA%E5%88%AB"><span class="nav-number">8.11.</span> <span class="nav-text">GROUP BY 和 ORDER BY 区别</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#11-22-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">9.</span> <span class="nav-text">11&#x2F;22 子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88Subquery%EF%BC%89%EF%BC%9F"><span class="nav-number">9.1.</span> <span class="nav-text">什么是子查询（Subquery）？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%9A%E5%9C%A8-WHERE-%E8%AF%AD%E5%8F%A5%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="nav-number">9.2.</span> <span class="nav-text">基本子查询：在 WHERE 语句中使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E6%9B%BF%E4%BB%A3-JOIN"><span class="nav-number">9.3.</span> <span class="nav-text">子查询替代 JOIN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HAVING-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">9.4.</span> <span class="nav-text">HAVING 子查询</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#EXISTS-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">9.5.</span> <span class="nav-text">EXISTS 子查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#12-13-22-%E8%81%94%E7%BB%93-JOIN"><span class="nav-number">10.</span> <span class="nav-text">12&amp;13&#x2F;22 联结 JOIN</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%9B%E5%BB%BA-JOIN%EF%BC%88%E8%81%94%E7%BB%93%EF%BC%89%EF%BC%9F"><span class="nav-number">10.1.</span> <span class="nav-text">为什么要创建 JOIN（联结）？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JOIN-%E4%BC%9A%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E8%A1%A8%E5%90%97%EF%BC%9F"><span class="nav-number">10.2.</span> <span class="nav-text">JOIN 会创建新的表吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA-JOIN%EF%BC%88%E8%81%94%E7%BB%93%EF%BC%89%EF%BC%9F"><span class="nav-number">10.3.</span> <span class="nav-text">如何创建 JOIN（联结）？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E6%9F%A5%E8%AF%A2%E8%AE%A2%E5%8D%95%E7%9A%84%E5%AE%A2%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="nav-number">10.3.1.</span> <span class="nav-text">示例：查询订单的客户信息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JOIN-%E6%98%AF-A-%E8%A1%A8%E5%BC%95%E7%94%A8-B-%E8%A1%A8%E7%9A%84%E4%BF%A1%E6%81%AF%E5%90%97%EF%BC%9F"><span class="nav-number">10.4.</span> <span class="nav-text">JOIN 是 A 表引用 B 表的信息吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JOIN-%E4%BC%9A%E4%BA%A7%E7%94%9F-C-%E8%A1%A8%E5%90%97%EF%BC%9F"><span class="nav-number">10.5.</span> <span class="nav-text">JOIN 会产生 C 表吗？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%EF%BC%9A%E5%88%9B%E5%BB%BA%E2%80%9C%E6%96%B0%E8%A1%A8%E2%80%9D%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%9C"><span class="nav-number">10.5.1.</span> <span class="nav-text">方法：创建“新表”存储结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-JOIN%EF%BC%8C%E5%A4%96%E9%94%AE%E4%B8%8D%E5%A4%9F%E7%94%A8%E5%90%97%EF%BC%9F"><span class="nav-number">10.6.</span> <span class="nav-text">为什么需要 JOIN，外键不够用吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E8%81%94%E7%BB%93%EF%BC%88Self-Join%EF%BC%89"><span class="nav-number">10.7.</span> <span class="nav-text">自联结（Self-Join）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E7%84%B6%E8%81%94%E7%BB%93%EF%BC%88Natural-Join%EF%BC%89"><span class="nav-number">10.8.</span> <span class="nav-text">自然联结（Natural Join）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E8%81%94%E7%BB%93%EF%BC%88Outer-Join%EF%BC%89"><span class="nav-number">10.9.</span> <span class="nav-text">外联结（Outer Join）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84-JOIN-%E7%B1%BB%E5%9E%8B"><span class="nav-number">10.10.</span> <span class="nav-text">常见的 JOIN 类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#INNER-JOIN%EF%BC%88%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">10.10.1.</span> <span class="nav-text">INNER JOIN（内连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LEFT-JOIN%EF%BC%88%E5%B7%A6%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">10.10.2.</span> <span class="nav-text">LEFT JOIN（左连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RIGHT-JOIN%EF%BC%88%E5%8F%B3%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">10.10.3.</span> <span class="nav-text">RIGHT JOIN（右连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FULL-JOIN%EF%BC%88%E5%85%A8%E8%BF%9E%E6%8E%A5%EF%BC%89"><span class="nav-number">10.10.4.</span> <span class="nav-text">FULL JOIN（全连接）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E8%BF%9E%E6%8E%A5%EF%BC%88SELF-JOIN%EF%BC%89"><span class="nav-number">10.10.5.</span> <span class="nav-text">自连接（SELF JOIN）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5%EF%BC%88CROSS-JOIN%EF%BC%89"><span class="nav-number">10.10.6.</span> <span class="nav-text">交叉连接（CROSS JOIN）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%A6%E8%81%9A%E9%9B%86%E5%87%BD%E6%95%B0%E7%9A%84%E8%81%94%E7%BB%93%EF%BC%88JOIN-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%EF%BC%89"><span class="nav-number">10.11.</span> <span class="nav-text">带聚集函数的联结（JOIN + 聚合函数）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E5%AE%A2%E6%88%B7%E7%9A%84%E8%AE%A2%E5%8D%95%E6%80%BB%E9%87%91%E9%A2%9D"><span class="nav-number">10.11.1.</span> <span class="nav-text">示例 1：计算每个客户的订单总金额</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-2%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E4%BE%9B%E5%BA%94%E5%95%86%EF%BC%88Vendor%EF%BC%89%E7%9A%84%E4%BA%A7%E5%93%81%E6%95%B0%E9%87%8F"><span class="nav-number">10.11.2.</span> <span class="nav-text">示例 2：计算每个供应商（Vendor）的产品数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-3%EF%BC%9A%E8%AE%A1%E7%AE%97%E6%AF%8F%E4%B8%AA%E5%AE%A2%E6%88%B7%E4%B8%8B%E7%9A%84%E8%AE%A2%E5%8D%95%E6%95%B0%E9%87%8F"><span class="nav-number">10.11.3.</span> <span class="nav-text">示例 3：计算每个客户下的订单数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-4%EF%BC%9A%E6%8C%89%E4%BE%9B%E5%BA%94%E5%95%86%E7%BB%9F%E8%AE%A1%E4%BA%A7%E5%93%81%E7%9A%84%E5%B9%B3%E5%9D%87%E4%BB%B7%E6%A0%BC"><span class="nav-number">10.11.4.</span> <span class="nav-text">示例 4：按供应商统计产品的平均价格</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#14-22-%E7%BB%84%E5%90%88%E6%9F%A5%E8%AF%A2-UNION"><span class="nav-number">11.</span> <span class="nav-text">14&#x2F;22 组合查询 UNION</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="nav-number">11.1.</span> <span class="nav-text">基本查询语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%EF%BC%88Subquery%EF%BC%89"><span class="nav-number">11.2.</span> <span class="nav-text">子查询（Subquery）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%EF%BC%88JOIN%EF%BC%89"><span class="nav-number">11.3.</span> <span class="nav-text">多表查询（JOIN）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-INTERSECT-%E5%92%8C-EXCEPT%EF%BC%88MySQL-%E4%B8%8D%E6%94%AF%E6%8C%81%EF%BC%8C%E5%8F%AF%E7%94%A8-JOIN-%E5%92%8C-NOT-IN-%E6%9B%BF%E4%BB%A3%EF%BC%89"><span class="nav-number">11.4.</span> <span class="nav-text">使用 INTERSECT 和 EXCEPT（MySQL 不支持，可用 JOIN 和 NOT IN 替代）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E8%BF%87%E6%BB%A4%EF%BC%88AND%E3%80%81OR%EF%BC%89"><span class="nav-number">11.5.</span> <span class="nav-text">组合过滤（AND、OR）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GROUP-BY-%E5%92%8C-HAVING"><span class="nav-number">11.6.</span> <span class="nav-text">GROUP BY 和 HAVING</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WITH%EF%BC%88%E5%85%AC%E7%94%A8%E8%A1%A8%E8%A1%A8%E8%BE%BE%E5%BC%8F%EF%BC%8CCTE%EF%BC%89"><span class="nav-number">11.7.</span> <span class="nav-text">WITH（公用表表达式，CTE）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2%EF%BC%88Query-Optimization%EF%BC%89"><span class="nav-number">11.8.</span> <span class="nav-text">优化查询（Query Optimization）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF"><span class="nav-number">11.8.1.</span> <span class="nav-text">优化查询的关键技术</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%EF%BC%88Index%EF%BC%89"><span class="nav-number">11.8.1.1.</span> <span class="nav-text">使用索引（Index）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D-SELECT-%EF%BC%8C%E5%8F%AA%E6%9F%A5%E8%AF%A2%E9%9C%80%E8%A6%81%E7%9A%84%E5%88%97"><span class="nav-number">11.8.1.2.</span> <span class="nav-text">*避免 SELECT ，只查询需要的列</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-EXPLAIN-%E5%88%86%E6%9E%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">11.8.1.3.</span> <span class="nav-text">使用 EXPLAIN 分析查询</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D-OR%EF%BC%8C%E4%BD%BF%E7%94%A8-UNION-ALL-%E6%88%96-IN"><span class="nav-number">11.8.1.4.</span> <span class="nav-text">避免 OR，使用 UNION ALL 或 IN</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D-LIKE-xxx-%EF%BC%8C%E6%94%B9%E7%94%A8-FULLTEXT-%E6%88%96%E7%B4%A2%E5%BC%95"><span class="nav-number">11.8.1.5.</span> <span class="nav-text">避免 LIKE &#39;%xxx%&#39;，改用 FULLTEXT 或索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D-HAVING-%E8%BF%87%E6%BB%A4%EF%BC%8C%E6%94%B9%E7%94%A8-WHERE"><span class="nav-number">11.8.1.6.</span> <span class="nav-text">避免 HAVING 过滤，改用 WHERE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%90%E5%88%B6%E6%95%B0%E6%8D%AE%E6%89%AB%E6%8F%8F%E9%87%8F%EF%BC%88%E5%88%86%E9%A1%B5%E4%BC%98%E5%8C%96%EF%BC%89"><span class="nav-number">11.8.1.7.</span> <span class="nav-text">限制数据扫描量（分页优化）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#A-B-%E6%B5%8B%E8%AF%95%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%E7%A4%BA%E4%BE%8B"><span class="nav-number">11.8.2.</span> <span class="nav-text">A&#x2F;B 测试查询优化示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2-A-B-%E7%BB%84%E7%9A%84%E8%BD%AC%E5%8C%96%E7%8E%87"><span class="nav-number">11.8.2.1.</span> <span class="nav-text">查询 A&#x2F;B 组的转化率</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E7%94%A8%E6%88%B7%E7%95%99%E5%AD%98"><span class="nav-number">11.8.2.2.</span> <span class="nav-text">分析用户留存</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#15-22-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE-INSERT"><span class="nav-number">12.</span> <span class="nav-text">15&#x2F;22 插入数据 INSERT</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E6%8F%92%E5%85%A5-INSERT-INTO"><span class="nav-number">12.1.</span> <span class="nav-text">基本数据插入 (INSERT INTO)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%8D%95%E8%A1%8C%E6%95%B0%E6%8D%AE"><span class="nav-number">12.1.1.</span> <span class="nav-text">插入单行数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E5%A4%9A%E8%A1%8C%E6%95%B0%E6%8D%AE"><span class="nav-number">12.1.2.</span> <span class="nav-text">插入多行数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5"><span class="nav-number">12.1.3.</span> <span class="nav-text">插入部分字段</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E4%B8%80%E4%B8%AA%E8%A1%A8%E5%A4%8D%E5%88%B6%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AA%E8%A1%A8-INSERT-INTO-SELECT"><span class="nav-number">12.2.</span> <span class="nav-text">从一个表复制到另一个表 (INSERT INTO ... SELECT)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E6%89%80%E6%9C%89%E5%AD%97%E6%AE%B5"><span class="nav-number">12.2.1.</span> <span class="nav-text">复制所有字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E9%83%A8%E5%88%86%E5%AD%97%E6%AE%B5"><span class="nav-number">12.2.2.</span> <span class="nav-text">复制部分字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E6%97%B6%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="nav-number">12.2.3.</span> <span class="nav-text">复制时修改数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#REPLACE-INTO%EF%BC%88%E6%8F%92%E5%85%A5%E6%88%96%E6%9B%B4%E6%96%B0%EF%BC%89"><span class="nav-number">12.3.</span> <span class="nav-text">REPLACE INTO（插入或更新）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#INSERT-ON-DUPLICATE-KEY-UPDATE%EF%BC%88%E5%86%B2%E7%AA%81%E6%97%B6%E6%9B%B4%E6%96%B0%EF%BC%89"><span class="nav-number">12.4.</span> <span class="nav-text">INSERT ... ON DUPLICATE KEY UPDATE（冲突时更新）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#16-22-%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4-UPDATE-DELETE"><span class="nav-number">13.</span> <span class="nav-text">16&#x2F;22 更新删除 UPDATE &amp; DELETE</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#UPDATE-%E8%AF%AD%E5%8F%A5%EF%BC%88%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">13.1.</span> <span class="nav-text">UPDATE 语句（更新数据）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="nav-number">13.1.1.</span> <span class="nav-text">更新单个字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E5%A4%9A%E4%B8%AA%E5%AD%97%E6%AE%B5"><span class="nav-number">13.1.2.</span> <span class="nav-text">更新多个字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E6%9B%B4%E6%96%B0%EF%BC%88%E9%81%BF%E5%85%8D%E8%AF%AF%E6%9B%B4%E6%96%B0%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">13.1.3.</span> <span class="nav-text">条件更新（避免误更新所有数据）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-CASE-WHEN-%E8%BF%9B%E8%A1%8C%E6%89%B9%E9%87%8F%E6%9B%B4%E6%96%B0"><span class="nav-number">13.1.4.</span> <span class="nav-text">使用 CASE WHEN 进行批量更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88-JOIN-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">13.1.5.</span> <span class="nav-text">结合 JOIN 更新数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DELETE-%E8%AF%AD%E5%8F%A5%EF%BC%88%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%EF%BC%89"><span class="nav-number">13.2.</span> <span class="nav-text">DELETE 语句（删除数据）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E8%A1%8C"><span class="nav-number">13.2.1.</span> <span class="nav-text">删除指定行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%E7%9A%84%E5%A4%9A%E8%A1%8C"><span class="nav-number">13.2.2.</span> <span class="nav-text">删除符合条件的多行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%EF%BC%88%E6%B8%85%E7%A9%BA%E8%A1%A8%EF%BC%89"><span class="nav-number">13.2.3.</span> <span class="nav-text">删除所有数据（清空表）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E5%90%88-JOIN-%E5%88%A0%E9%99%A4"><span class="nav-number">13.2.4.</span> <span class="nav-text">结合 JOIN 删除</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DELETE-vs-TRUNCATE"><span class="nav-number">13.3.</span> <span class="nav-text">DELETE vs TRUNCATE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%98%B2%E6%AD%A2%E8%AF%AF%E6%93%8D%E4%BD%9C"><span class="nav-number">13.4.</span> <span class="nav-text">防止误操作</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#17-22-%E6%93%8D%E7%BA%B5%E8%A1%A8-CREATE-ALTER-DROP-RENAME"><span class="nav-number">14.</span> <span class="nav-text">17&#x2F;22 操纵表 CREATE ALTER DROP RENAME</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#CREATE-%E8%AF%AD%E5%8F%A5%EF%BC%88%E5%88%9B%E5%BB%BA%E8%A1%A8-%E6%95%B0%E6%8D%AE%E5%BA%93-%E7%B4%A2%E5%BC%95%E7%AD%89%EF%BC%89"><span class="nav-number">14.1.</span> <span class="nav-text">CREATE 语句（创建表&#x2F;数据库&#x2F;索引等）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ALTER-%E8%AF%AD%E5%8F%A5%EF%BC%88%E4%BF%AE%E6%94%B9%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89"><span class="nav-number">14.2.</span> <span class="nav-text">ALTER 语句（修改表结构）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DROP-%E8%AF%AD%E5%8F%A5%EF%BC%88%E5%88%A0%E9%99%A4%E8%A1%A8-%E6%95%B0%E6%8D%AE%E5%BA%93-%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="nav-number">14.3.</span> <span class="nav-text">DROP 语句（删除表&#x2F;数据库&#x2F;索引）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#18-22-%E8%A7%86%E5%9B%BE"><span class="nav-number">15.</span> <span class="nav-text">18&#x2F;22 视图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE%EF%BC%9F"><span class="nav-number">15.1.</span> <span class="nav-text">为什么使用视图？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE-CREATE-VIEW"><span class="nav-number">15.2.</span> <span class="nav-text">创建视图 (CREATE VIEW)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E8%A7%86%E5%9B%BE"><span class="nav-number">15.2.1.</span> <span class="nav-text">基本视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="nav-number">15.3.</span> <span class="nav-text">使用视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%A7%86%E5%9B%BE"><span class="nav-number">15.3.1.</span> <span class="nav-text">查询视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E4%B8%8E-JOIN"><span class="nav-number">15.3.2.</span> <span class="nav-text">视图与 JOIN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE-ALTER-VIEW"><span class="nav-number">15.4.</span> <span class="nav-text">修改视图 (ALTER VIEW)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE%E5%86%85%E5%AE%B9"><span class="nav-number">15.4.1.</span> <span class="nav-text">修改视图内容</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE-DROP-VIEW"><span class="nav-number">15.5.</span> <span class="nav-text">删除视图 (DROP VIEW)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE-vs-%E8%A1%A8"><span class="nav-number">15.6.</span> <span class="nav-text">视图 vs. 表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%98%AF%E5%90%A6%E5%8F%AF%E6%9B%B4%E6%96%B0%EF%BC%9F"><span class="nav-number">15.7.</span> <span class="nav-text">视图是否可更新？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="nav-number">15.7.1.</span> <span class="nav-text">可更新视图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E5%8F%AF%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE"><span class="nav-number">15.7.2.</span> <span class="nav-text">不可更新视图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#A-B-%E6%B5%8B%E8%AF%95%EF%BC%88AB-Test%EF%BC%89-%E8%A7%86%E5%9B%BE%EF%BC%88VIEW%EF%BC%89"><span class="nav-number">15.8.</span> <span class="nav-text">A&#x2F;B 测试（AB Test） + 视图（VIEW）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E4%B8%80%E5%AE%9E%E9%AA%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2"><span class="nav-number">15.8.1.</span> <span class="nav-text">统一实验数据查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E6%8A%A4%E6%95%8F%E6%84%9F%E6%95%B0%E6%8D%AE%EF%BC%88%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="nav-number">15.8.2.</span> <span class="nav-text">保护敏感数据（权限控制）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%AE%9E%E9%AA%8C%E7%BB%9F%E8%AE%A1%E6%8C%87%E6%A0%87"><span class="nav-number">15.8.3.</span> <span class="nav-text">计算实验统计指标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E9%80%9F%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%EF%BC%88%E9%A2%84%E8%BF%87%E6%BB%A4%E9%AB%98%E8%B4%A8%E9%87%8F%E7%94%A8%E6%88%B7%EF%BC%89"><span class="nav-number">15.8.4.</span> <span class="nav-text">加速数据分析（预过滤高质量用户）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E7%9B%91%E6%8E%A7-A-B-%E6%B5%8B%E8%AF%95%E8%BF%9B%E5%B1%95"><span class="nav-number">15.8.5.</span> <span class="nav-text">实时监控 A&#x2F;B 测试进展</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#19-22-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">16.</span> <span class="nav-text">19&#x2F;22 存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="nav-number">16.1.</span> <span class="nav-text">什么是存储过程？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="nav-number">16.2.</span> <span class="nav-text">为什么要使用存储过程？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="nav-number">16.3.</span> <span class="nav-text">如何创建存储过程？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">16.3.1.</span> <span class="nav-text">** 语法**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">16.3.2.</span> <span class="nav-text">示例：创建存储过程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%EF%BC%9F"><span class="nav-number">16.4.</span> <span class="nav-text">如何执行存储过程？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">16.5.</span> <span class="nav-text">复杂存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">16.6.</span> <span class="nav-text">删除存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-vs-%E8%A7%86%E5%9B%BE"><span class="nav-number">16.7.</span> <span class="nav-text">存储过程 vs 视图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#20-22-%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="nav-number">17.</span> <span class="nav-text">20&#x2F;22 事务处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%EF%BC%9F"><span class="nav-number">17.1.</span> <span class="nav-text">什么是事务处理？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ACID-%E5%B1%9E%E6%80%A7%EF%BC%9A"><span class="nav-number">17.1.1.</span> <span class="nav-text">ACID 属性：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%EF%BC%9F"><span class="nav-number">17.2.</span> <span class="nav-text">为什么需要事务处理？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%EF%BC%9F"><span class="nav-number">17.3.</span> <span class="nav-text">如何管理事务处理？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="nav-number">17.4.</span> <span class="nav-text">事务管理的基本语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-number">17.5.</span> <span class="nav-text">事务隔离级别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86-vs-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">17.6.</span> <span class="nav-text">事务处理 vs 存储过程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#21-22-%E6%B8%B8%E6%A0%87"><span class="nav-number">18.</span> <span class="nav-text">21&#x2F;22 游标</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B8%B8%E6%A0%87%EF%BC%88Cursor%EF%BC%89%EF%BC%9F"><span class="nav-number">18.1.</span> <span class="nav-text">什么是游标（Cursor）？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87%E5%92%8C%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2%EF%BC%88%E8%81%9A%E9%9B%86%E6%95%B0%E6%8D%AE%EF%BC%89%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">18.2.</span> <span class="nav-text">游标和普通查询（聚集数据）的区别</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87%E7%9A%84%E6%A0%B8%E5%BF%83%E8%AF%AD%E5%8F%A5"><span class="nav-number">18.3.</span> <span class="nav-text">游标的核心语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87%E7%9A%84%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-number">18.4.</span> <span class="nav-text">游标的使用示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="nav-number">18.5.</span> <span class="nav-text">使用游标更新数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">18.6.</span> <span class="nav-text">使用游标删除数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%B8%E6%A0%87-vs-%E6%99%AE%E9%80%9A%E6%9F%A5%E8%AF%A2"><span class="nav-number">18.7.</span> <span class="nav-text">游标 vs 普通查询</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#22-22-SQL%E7%89%B9%E6%80%A7"><span class="nav-number">19.</span> <span class="nav-text">22&#x2F;22 SQL特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A6%E6%9D%9F"><span class="nav-number">19.1.</span> <span class="nav-text">约束</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">19.2.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="nav-number">19.3.</span> <span class="nav-text">触发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E5%85%A8"><span class="nav-number">19.4.</span> <span class="nav-text">数据库安全</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hakuxc在存档"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Hakuxc在存档</p>
  <div class="site-description" itemprop="description">求名利无了时 千金难买好人生</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://satoujotaro.github.io/2025/02/20/%E3%80%90%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E3%80%91%E3%80%8ASQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Hakuxc在存档">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hakuxc">
      <meta itemprop="description" content="求名利无了时 千金难买好人生">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="【读书笔记】《SQL必知必会》 | Hakuxc">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【读书笔记】《SQL必知必会》
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-02-20 18:10:49" itemprop="dateCreated datePublished" datetime="2025-02-20T18:10:49+08:00">2025-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-02-23 20:51:01" itemprop="dateModified" datetime="2025-02-23T20:51:01+08:00">2025-02-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9C%A8%E8%AF%86%E5%AD%97/" itemprop="url" rel="index"><span itemprop="name">在识字</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>关于我从24年开始拖拖拉拉的喊“我要学SQL”最后只完成了喊如今箭在弦上不得不发挑战一天速成而据说这本又经典又简单于是又抱着应该一天就能学会的妄想翻开了书<br>24年请教学长的建议：<img src="/images/SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A1.png" alt="数据分析需要什么"></p>
</blockquote>
<h1 id="1-22-基本概念"><a href="#1-22-基本概念" class="headerlink" title="1&#x2F;22 基本概念"></a>1&#x2F;22 基本概念</h1><blockquote>
<p>一些基本的数据库概念</p>
</blockquote>
<ul>
<li>数据库 数据库管理系统</li>
<li>表 表名 模式</li>
<li>列 数据类型</li>
<li>行 记录</li>
<li>主键 外键</li>
</ul>
<hr>
<ul>
<li>标准 SQL(ANSI SQL)</li>
<li>PL&#x2F;SQL(Oracle)</li>
<li>Transact-SQL(SQL-Server)</li>
</ul>
<hr>
<blockquote>
<p>附录A创设了一个玩具经销商使用的订单录入系统（5张表）+插入数据</p>
</blockquote>
<ul>
<li>供应商 Vendors</li>
<li>产品 Products</li>
<li>顾客 Customers</li>
<li>订单 Orders</li>
<li>订单物品 OrderItems</li>
<li>还有工资、记账、发货追踪信息等，这里不创了</li>
</ul>
<h1 id="2-22-选择-SELECT"><a href="#2-22-选择-SELECT" class="headerlink" title="2&#x2F;22 选择 SELECT"></a>2&#x2F;22 选择 SELECT</h1><h2 id="常用关键字"><a href="#常用关键字" class="headerlink" title="常用关键字"></a>常用关键字</h2><p><strong>1. 数据查询相关</strong></p>
<ul>
<li><strong><code>SELECT</code></strong>：用于查询数据。</li>
<li><strong><code>FROM</code></strong>：指定查询的表。</li>
<li><strong><code>WHERE</code></strong>：用于指定查询条件。</li>
<li><strong><code>AND</code></strong>、<strong><code>OR</code></strong>：用于组合多个条件。</li>
<li><strong><code>ORDER BY</code></strong>：用于排序查询结果。</li>
<li><strong><code>GROUP BY</code></strong>：用于按某些字段分组数据。</li>
<li><strong><code>HAVING</code></strong>：用于过滤分组后的数据。</li>
<li><strong><code>LIMIT</code></strong>：限制查询返回的记录数量。<br><strong>2. 数据操作</strong></li>
<li><strong><code>INSERT INTO</code></strong>：向表中插入数据。</li>
<li><strong><code>UPDATE</code></strong>：更新表中的现有数据。</li>
<li><strong><code>DELETE</code></strong>：删除表中的数据。</li>
<li><strong><code>REPLACE</code></strong>：如果记录已存在，则替换记录。</li>
<li><strong><code>TRUNCATE</code></strong>：删除表中的所有数据（不删除表结构）。<br><strong>3. 数据定义</strong></li>
<li><strong><code>CREATE</code></strong>：创建数据库、表、索引等。</li>
<li><strong><code>DROP</code></strong>：删除数据库、表、索引等。</li>
<li><strong><code>ALTER</code></strong>：修改数据库、表的结构（如添加、删除列）。</li>
<li><strong><code>RENAME</code></strong>：重命名表或列。</li>
<li><strong><code>DESCRIBE</code></strong>：显示表的结构。<br><strong>4. 数据控制</strong></li>
<li><strong><code>GRANT</code></strong>：授予用户权限。</li>
<li><strong><code>REVOKE</code></strong>：撤销用户权限。</li>
<li><strong><code>COMMIT</code></strong>：提交事务（使操作永久生效）。</li>
<li><strong><code>ROLLBACK</code></strong>：回滚事务（撤销尚未提交的更改）。<br><strong>5. 数据类型</strong></li>
<li><strong><code>INT</code></strong>：整数类型。</li>
<li><strong><code>VARCHAR</code></strong>、<strong><code>CHAR</code></strong>：字符类型。</li>
<li><strong><code>TEXT</code></strong>：长文本类型。</li>
<li><strong><code>DATE</code></strong>、<strong><code>DATETIME</code></strong>：日期和时间类型。</li>
<li><strong><code>DECIMAL</code></strong>、<strong><code>FLOAT</code></strong>、<strong><code>DOUBLE</code></strong>：数值类型。<br><strong>6. 约束相关</strong></li>
<li><strong><code>PRIMARY KEY</code></strong>：主键，确保列中数据唯一且不可为空。</li>
<li><strong><code>FOREIGN KEY</code></strong>：外键，用于引用其他表的主键。</li>
<li><strong><code>UNIQUE</code></strong>：确保某列的值是唯一的。</li>
<li><strong><code>NOT NULL</code></strong>：确保某列的值不能为空。</li>
<li><strong><code>DEFAULT</code></strong>：设置默认值。</li>
<li><strong><code>CHECK</code></strong>：对列的值进行约束（例如限定值范围）。</li>
<li><strong><code>INDEX</code></strong>：为表的某些列创建索引，提高查询效率。<br><strong>7. 事务控制</strong></li>
<li><strong><code>BEGIN</code></strong>：开始一个事务。</li>
<li><strong><code>SAVEPOINT</code></strong>：设置事务的保存点。</li>
<li><strong><code>COMMIT</code></strong>：提交事务。</li>
<li><strong><code>ROLLBACK</code></strong>：回滚事务。</li>
<li><strong><code>SET TRANSACTION</code></strong>：设置事务的隔离级别。<br><strong>8. 其他常用关键字</strong></li>
<li><strong><code>JOIN</code></strong>：用于连接两个或多个表。</li>
<li><strong><code>INNER JOIN</code></strong>、<strong><code>LEFT JOIN</code></strong>、<strong><code>RIGHT JOIN</code></strong>、<strong><code>FULL JOIN</code></strong>：不同类型的连接。</li>
<li><strong><code>ON</code></strong>：指定连接条件。</li>
<li><strong><code>IS NULL</code></strong>：用于检查列是否为 <code>NULL</code>。</li>
<li><strong><code>IN</code></strong>：指定多个可能的值。</li>
<li><strong><code>BETWEEN</code></strong>：用于指定一个范围。</li>
<li><strong><code>LIKE</code></strong>：用于模糊查询。</li>
<li><strong><code>DISTINCT</code></strong>：去除查询结果中的重复记录。</li>
</ul>
<p><strong>常见 SQL 关键字汇总</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>, <span class="keyword">FROM</span>, <span class="keyword">WHERE</span>, <span class="keyword">AND</span>, <span class="keyword">OR</span>, <span class="keyword">ORDER</span> <span class="keyword">BY</span>, <span class="keyword">GROUP</span> <span class="keyword">BY</span>, <span class="keyword">HAVING</span>, LIMIT</span><br><span class="line"><span class="keyword">INSERT INTO</span>, <span class="keyword">UPDATE</span>, <span class="keyword">DELETE</span>, REPLACE, <span class="keyword">TRUNCATE</span></span><br><span class="line"><span class="keyword">CREATE</span>, <span class="keyword">DROP</span>, <span class="keyword">ALTER</span>, RENAME, <span class="keyword">DESCRIBE</span></span><br><span class="line"><span class="keyword">GRANT</span>, <span class="keyword">REVOKE</span>, <span class="keyword">COMMIT</span>, <span class="keyword">ROLLBACK</span></span><br><span class="line"><span class="keyword">PRIMARY KEY</span>, <span class="keyword">FOREIGN KEY</span>, <span class="keyword">UNIQUE</span>, <span class="keyword">NOT NULL</span>, <span class="keyword">DEFAULT</span>, <span class="keyword">CHECK</span>, INDEX</span><br><span class="line"><span class="keyword">BEGIN</span>, <span class="keyword">SAVEPOINT</span>, <span class="keyword">COMMIT</span>, <span class="keyword">ROLLBACK</span>, <span class="keyword">SET</span> TRANSACTION</span><br><span class="line"><span class="keyword">JOIN</span>, <span class="keyword">INNER</span> <span class="keyword">JOIN</span>, <span class="keyword">LEFT</span> <span class="keyword">JOIN</span>, <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span>, <span class="keyword">FULL</span> <span class="keyword">JOIN</span>, <span class="keyword">ON</span></span><br><span class="line"><span class="keyword">IS</span> <span class="keyword">NULL</span>, <span class="keyword">IN</span>, <span class="keyword">BETWEEN</span>, <span class="keyword">LIKE</span>, <span class="keyword">DISTINCT</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="SELECT-语句"><a href="#SELECT-语句" class="headerlink" title="SELECT 语句"></a>SELECT 语句</h2><p><code>SELECT</code> 语句是 SQL 中最常用的语句之一，用于从数据库中 <strong>查询数据</strong>。它可以帮助你获取表中的数据，并进行过滤、排序、分组等操作。</p>
<h3 id="查询所有数据"><a href="#查询所有数据" class="headerlink" title="查询所有数据"></a><strong>查询所有数据</strong></h3><p>使用 <code>SELECT *</code> 来查询某个表的所有数据。</p>
<h4 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h4 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h4><p>假设你有一个名为 <code>Customers</code> 的表，查询所有数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>*</code></strong>: 表示查询所有列。</li>
<li>结果会显示 <code>Customers</code> 表中的所有字段和所有记录。</li>
</ul>
<hr>
<h3 id="查询指定列的数据"><a href="#查询指定列的数据" class="headerlink" title="查询指定列的数据"></a><strong>查询指定列的数据</strong></h3><p>你可以选择查询某些特定的列，而不是所有的列。</p>
<h4 id="语法：-1"><a href="#语法：-1" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h4><p>查询 <code>Customers</code> 表中的 <code>cust_name</code> 和 <code>cust_city</code> 两列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_city <span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure>
<ul>
<li>这将返回顾客的名字和城市，而不是表中的所有列。</li>
</ul>
<hr>
<h3 id="使用-WHERE-子句进行条件查询"><a href="#使用-WHERE-子句进行条件查询" class="headerlink" title="使用 WHERE 子句进行条件查询"></a><strong>使用 <code>WHERE</code> 子句进行条件查询</strong></h3><p><code>WHERE</code> 子句用于指定查询条件，以过滤数据。</p>
<h4 id="语法：-2"><a href="#语法：-2" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="keyword">condition</span>;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-2"><a href="#示例：-2" class="headerlink" title="示例："></a>示例：</h4><p>查询 <code>Customers</code> 表中城市为 “Detroit” 的所有顾客：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_city <span class="operator">=</span> <span class="string">&#x27;Detroit&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>这只会返回 <code>cust_city</code> 为 “Detroit” 的顾客记录。</li>
</ul>
<hr>
<h3 id="使用-AND-和-OR-连接多个条件"><a href="#使用-AND-和-OR-连接多个条件" class="headerlink" title="使用 AND 和 OR 连接多个条件"></a><strong>使用 <code>AND</code> 和 <code>OR</code> 连接多个条件</strong></h3><p>你可以用 <code>AND</code> 和 <code>OR</code> 来组合多个条件。</p>
<h4 id="语法：-3"><a href="#语法：-3" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> condition1 <span class="keyword">AND</span><span class="operator">/</span><span class="keyword">OR</span> condition2;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-3"><a href="#示例：-3" class="headerlink" title="示例："></a>示例：</h4><p>查询 <code>Customers</code> 表中，城市是 “Detroit” 且州是 “MI” 的顾客：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_city <span class="operator">=</span> <span class="string">&#x27;Detroit&#x27;</span> <span class="keyword">AND</span> cust_state <span class="operator">=</span> <span class="string">&#x27;MI&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>这将返回城市为 “Detroit” 且州为 “MI” 的所有顾客。</li>
</ul>
<hr>
<h3 id="使用-ORDER-BY-排序结果"><a href="#使用-ORDER-BY-排序结果" class="headerlink" title="使用 ORDER BY 排序结果"></a><strong>使用 <code>ORDER BY</code> 排序结果</strong></h3><p><code>ORDER BY</code> 子句用于对查询结果进行排序。</p>
<h4 id="语法：-4"><a href="#语法：-4" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">ORDER</span> <span class="keyword">BY</span> column_name [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>];</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>ASC</code></strong>：升序（默认）</li>
<li><strong><code>DESC</code></strong>：降序</li>
</ul>
<h4 id="示例：-4"><a href="#示例：-4" class="headerlink" title="示例："></a>示例：</h4><p>查询所有顾客，并按 <code>cust_name</code> 升序排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<p>查询所有顾客，并按 <code>cust_name</code> 降序排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-LIMIT-限制返回结果的数量"><a href="#使用-LIMIT-限制返回结果的数量" class="headerlink" title="使用 LIMIT 限制返回结果的数量"></a><strong>使用 <code>LIMIT</code> 限制返回结果的数量</strong></h3><p><code>LIMIT</code> 子句用于限制查询结果返回的行数。</p>
<h4 id="语法：-5"><a href="#语法：-5" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name LIMIT number;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-5"><a href="#示例：-5" class="headerlink" title="示例："></a>示例：</h4><p>查询 <code>Customers</code> 表中的前 3 行数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers LIMIT <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-DISTINCT-去除重复记录"><a href="#使用-DISTINCT-去除重复记录" class="headerlink" title="使用 DISTINCT 去除重复记录"></a><strong>使用 <code>DISTINCT</code> 去除重复记录</strong></h3><p><code>DISTINCT</code> 用于查询结果中去除重复的记录。</p>
<h4 id="语法：-6"><a href="#语法：-6" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column1, column2, ... <span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-6"><a href="#示例：-6" class="headerlink" title="示例："></a>示例：</h4><p>查询所有不同的城市：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> cust_city <span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure>
<ul>
<li>这将返回 <code>Customers</code> 表中所有不重复的城市。</li>
</ul>
<hr>
<h3 id="使用-LIKE-进行模糊匹配"><a href="#使用-LIKE-进行模糊匹配" class="headerlink" title="使用 LIKE 进行模糊匹配"></a><strong>使用 <code>LIKE</code> 进行模糊匹配</strong></h3><p><code>LIKE</code> 用于在查询中进行模糊匹配，常与通配符结合使用：</p>
<ul>
<li><strong><code>%</code></strong>: 代表零个或多个字符。</li>
<li><strong><code>_</code></strong>: 代表单个字符。</li>
</ul>
<h4 id="语法：-7"><a href="#语法：-7" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column_name <span class="keyword">LIKE</span> <span class="keyword">pattern</span>;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-7"><a href="#示例：-7" class="headerlink" title="示例："></a>示例：</h4><p>查询所有顾客名称以 “Fun” 开头的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;Fun%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>查询所有顾客名称中包含 “Toy” 的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;%Toy%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-IN-来匹配多个值"><a href="#使用-IN-来匹配多个值" class="headerlink" title="使用 IN 来匹配多个值"></a><strong>使用 <code>IN</code> 来匹配多个值</strong></h3><p><code>IN</code> 用于在查询中匹配多个值。</p>
<h4 id="语法：-8"><a href="#语法：-8" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column_name <span class="keyword">IN</span> (value1, value2, ...);</span><br></pre></td></tr></table></figure>

<h4 id="示例：-8"><a href="#示例：-8" class="headerlink" title="示例："></a>示例：</h4><p>查询所有来自 “Detroit” 或 “Phoenix” 的顾客：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_city <span class="keyword">IN</span> (<span class="string">&#x27;Detroit&#x27;</span>, <span class="string">&#x27;Phoenix&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-BETWEEN-查询范围"><a href="#使用-BETWEEN-查询范围" class="headerlink" title="使用 BETWEEN 查询范围"></a><strong>使用 <code>BETWEEN</code> 查询范围</strong></h3><p><code>BETWEEN</code> 用于查询一个范围内的数据，通常用于数值、日期等类型。</p>
<h4 id="语法：-9"><a href="#语法：-9" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, ... <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> column_name <span class="keyword">BETWEEN</span> value1 <span class="keyword">AND</span> value2;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-9"><a href="#示例：-9" class="headerlink" title="示例："></a>示例：</h4><p>查询 <code>Orders</code> 表中 <code>order_date</code> 在 2022 年 1 月 1 日和 2022 年 12 月 31 日之间的所有订单：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2022-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2022-12-31&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-GROUP-BY-和聚合函数"><a href="#使用-GROUP-BY-和聚合函数" class="headerlink" title="使用 GROUP BY 和聚合函数"></a><strong>使用 <code>GROUP BY</code> 和聚合函数</strong></h3><p><code>GROUP BY</code> 用于按指定列分组，通常与聚合函数（如 <code>COUNT</code>、<code>SUM</code>、<code>AVG</code> 等）一起使用。</p>
<h4 id="语法：-10"><a href="#语法：-10" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-10"><a href="#示例：-10" class="headerlink" title="示例："></a>示例：</h4><p>查询每个城市的顾客数量：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> Customers <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_city;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-HAVING-对分组结果进行筛选"><a href="#使用-HAVING-对分组结果进行筛选" class="headerlink" title="使用 HAVING 对分组结果进行筛选"></a><strong>使用 <code>HAVING</code> 对分组结果进行筛选</strong></h3><p><code>HAVING</code> 用于过滤 <code>GROUP BY</code> 分组后的结果。它的作用与 <code>WHERE</code> 类似，但 <code>WHERE</code> 不能用于过滤分组结果。</p>
<h4 id="语法：-11"><a href="#语法：-11" class="headerlink" title="语法："></a>语法：</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> table_name <span class="keyword">GROUP</span> <span class="keyword">BY</span> column1 <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h4 id="示例：-11"><a href="#示例：-11" class="headerlink" title="示例："></a>示例：</h4><p>查询顾客数量大于 1 的城市：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_city, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> Customers <span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_city <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="必会"><a href="#必会" class="headerlink" title="必会"></a>必会</h3><p><img src="/images/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A2.png" alt="SELECT语句必会"></p>
<h1 id="3-22-排序-ORDER-BY"><a href="#3-22-排序-ORDER-BY" class="headerlink" title="3&#x2F;22 排序 ORDER BY"></a>3&#x2F;22 排序 ORDER BY</h1><p><code>ORDER BY</code> 语句用于 <strong>排序查询结果</strong>，排序逻辑如下：</p>
<hr>
<h2 id="ORDER-BY-的基本用法"><a href="#ORDER-BY-的基本用法" class="headerlink" title="ORDER BY 的基本用法"></a><strong><code>ORDER BY</code> 的基本用法</strong></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name;</span><br></pre></td></tr></table></figure>
<p><strong>默认是</strong> <strong><code>ASC</code>（升序）</strong>，从 <strong>A-Z</strong> 或 <strong>小到大</strong> 排序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><code>DESC</code> 表示 <strong>降序</strong>，从 <strong>Z-A</strong> 或 <strong>大到小</strong> 排序。</p>
<hr>
<h2 id="按多个列排序"><a href="#按多个列排序" class="headerlink" title="按多个列排序"></a><strong>按多个列排序</strong></h2><p>如果两条记录的 <code>cust_name</code> 相同，可以再按 <code>cust_id</code> 进行排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_name <span class="keyword">ASC</span>, cust_id <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li>先按 <code>cust_name</code> <strong>升序</strong></li>
<li>如果 <code>cust_name</code> 相同，再按 <code>cust_id</code> <strong>降序</strong></li>
</ol>
<p><strong>示例</strong>：</p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>cust_id</th>
</tr>
</thead>
<tbody><tr>
<td>Alice</td>
<td>1003</td>
</tr>
<tr>
<td>Alice</td>
<td>1001</td>
</tr>
<tr>
<td>Bob</td>
<td>1002</td>
</tr>
<tr>
<td>Charlie</td>
<td>1004</td>
</tr>
</tbody></table>
<hr>
<h2 id="按列位置排序"><a href="#按列位置排序" class="headerlink" title="按列位置排序"></a><strong>按列位置排序</strong></h2><p>有时候，你可以使用列的 <strong>索引（位置）</strong> 进行排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, cust_name <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p><strong><code>ORDER BY 2</code> 表示按照第 2 列（<code>cust_name</code>）排序</strong>。</p>
<hr>
<h2 id="NULL-值的排序逻辑"><a href="#NULL-值的排序逻辑" class="headerlink" title="NULL 值的排序逻辑"></a><strong><code>NULL</code> 值的排序逻辑</strong></h2><ul>
<li><strong>默认（MySQL）：<code>NULL</code> 值在 <code>ASC</code> 排序时最前面，在 <code>DESC</code> 排序时最后面</strong></li>
<li>可以用 <code>IS NULL</code> 或 <code>IS NOT NULL</code> 来控制 <code>NULL</code> 值的顺序：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">ORDER</span> <span class="keyword">BY</span> cust_email <span class="keyword">IS</span> <span class="keyword">NULL</span>, cust_email;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li><code>cust_email IS NULL</code> → <strong><code>NULL</code> 的值排在后面</strong></li>
<li>之后再按 <code>cust_email</code> <strong>升序排序</strong></li>
</ol>
<hr>
<h2 id="ORDER-BY-和-LIMIT-结合"><a href="#ORDER-BY-和-LIMIT-结合" class="headerlink" title="ORDER BY 和 LIMIT 结合"></a><strong><code>ORDER BY</code> 和 <code>LIMIT</code> 结合</strong></h2><p>如果你要找 <strong>最大&#x2F;最小</strong> 的记录，可以结合 <code>ORDER BY</code> 和 <code>LIMIT</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">DESC</span> LIMIT <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><strong>找最近的订单</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Orders <span class="keyword">ORDER</span> <span class="keyword">BY</span> order_date <span class="keyword">ASC</span> LIMIT <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p><strong>找最早的订单</strong></p>
<hr>
<h2 id="必会-1"><a href="#必会-1" class="headerlink" title="必会"></a><strong>必会</strong></h2><table>
<thead>
<tr>
<th><code>ORDER BY</code> 语法</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>ORDER BY col</code></td>
<td>按 <strong>默认升序</strong> 排序</td>
</tr>
<tr>
<td><code>ORDER BY col ASC</code></td>
<td>按 <strong>升序（小到大、A-Z）</strong> 排序</td>
</tr>
<tr>
<td><code>ORDER BY col DESC</code></td>
<td>按 <strong>降序（大到小、Z-A）</strong> 排序</td>
</tr>
<tr>
<td><code>ORDER BY col1, col2</code></td>
<td>先按 <code>col1</code> 排序，再按 <code>col2</code> 排序</td>
</tr>
<tr>
<td><code>ORDER BY 2</code></td>
<td>按 <strong>第 2 列</strong> 排序</td>
</tr>
<tr>
<td><code>ORDER BY col IS NULL, col</code></td>
<td>先排 <code>NULL</code>，然后按 <code>col</code> 排序</td>
</tr>
<tr>
<td><code>ORDER BY col DESC LIMIT 1</code></td>
<td>找 <strong>最大值</strong> 的记录</td>
</tr>
<tr>
<td><code>ORDER BY col ASC LIMIT 1</code></td>
<td>找 <strong>最小值</strong> 的记录</td>
</tr>
</tbody></table>
<hr>
<h2 id="数据库对文本数据排序时，是否区分大小写？"><a href="#数据库对文本数据排序时，是否区分大小写？" class="headerlink" title="数据库对文本数据排序时，是否区分大小写？"></a><strong>数据库对文本数据排序时，是否区分大小写？</strong></h2><p><strong>1. 为什么要关注大小写排序？</strong><br>当你对 <code>VARCHAR</code> 或 <code>CHAR</code> 类型的文本数据执行 <code>ORDER BY</code> 时，<strong>默认排序方式取决于数据库的排序规则（collation）</strong>。</p>
<p>示例数据：</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>apple</td>
</tr>
<tr>
<td>Zebra</td>
</tr>
<tr>
<td>banana</td>
</tr>
<tr>
<td>Apple</td>
</tr>
</tbody></table>
<p>如果数据库 <strong>区分大小写（case-sensitive）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> name;</span><br></pre></td></tr></table></figure>
<p>可能会得到：</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>Apple</td>
</tr>
<tr>
<td>Zebra</td>
</tr>
<tr>
<td>apple</td>
</tr>
<tr>
<td>banana</td>
</tr>
</tbody></table>
<p><strong>大写字母排在小写字母前面</strong>，因为 <code>A</code>（ASCII 65）比 <code>a</code>（ASCII 97）小。</p>
<p>如果数据库 <strong>不区分大小写（case-insensitive）</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>
<p>可能会得到：</p>
<table>
<thead>
<tr>
<th>name</th>
</tr>
</thead>
<tbody><tr>
<td>Apple</td>
</tr>
<tr>
<td>apple</td>
</tr>
<tr>
<td>banana</td>
</tr>
<tr>
<td>Zebra</td>
</tr>
</tbody></table>
<p><strong>忽略大小写，把 Apple 和 apple 视为相同的排序级别</strong>。</p>
<hr>
<p><strong>2. 你的数据库是如何排序的？</strong><br>你可以运行以下 SQL 语句来查看当前的字符集和排序规则：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;collation_database&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>或者：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE TABLE</span> Customers;</span><br></pre></td></tr></table></figure>
<p>你会在 <code>CREATE TABLE</code> 语句中看到类似：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `Customers` (</span><br><span class="line">  `cust_name` <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure>
<p>其中 <code>utf8mb4_0900_ai_ci</code>：</p>
<ul>
<li><strong><code>ai</code>（accent-insensitive）</strong>：忽略重音（é 和 e 视为相同）。</li>
<li><strong><code>ci</code>（case-insensitive）</strong>：忽略大小写（Apple 和 apple 视为相同）。</li>
</ul>
<hr>
<p><strong>3. 如何手动控制排序？</strong><br>如果数据库默认 <strong>区分大小写</strong>，但你希望 <strong>不区分大小写</strong> 排序，可以这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>
<p>如果数据库默认 <strong>不区分大小写</strong>，但你希望 <strong>区分大小写</strong> 排序：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> name <span class="keyword">COLLATE</span> utf8mb4_bin;</span><br></pre></td></tr></table></figure>

<p>如果你<strong>想确保所有文本都按小写或大写排序</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">LOWER</span>(name);</span><br></pre></td></tr></table></figure>
<p>或：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> my_table <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="built_in">UPPER</span>(name);</span><br></pre></td></tr></table></figure>
<p>这样 <strong>数据库无论是否区分大小写，都会按统一大小写进行排序</strong>。</p>
<hr>
<p><strong>4. 除了 <code>ORDER BY</code>，还能怎么做？</strong><br>如果 <code>ORDER BY</code> 无法满足你的需求，你可以：</p>
<ol>
<li><strong>检查数据库的排序规则</strong>（<code>COLLATION</code>）。</li>
<li><strong>调整列的 <code>COLLATE</code> 选项</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> my_table MODIFY name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8mb4_bin;</span><br></pre></td></tr></table></figure>
<ul>
<li>这样 <code>ORDER BY</code> 会<strong>区分大小写</strong>排序。</li>
</ul>
</li>
<li><strong>让 DBA（数据库管理员）更改数据库默认排序规则</strong>（如果你没有权限）。</li>
</ol>
<hr>
<p><strong>5. 总结</strong></p>
<table>
<thead>
<tr>
<th>问题</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td><strong>默认排序是否区分大小写？</strong></td>
<td><code>SHOW VARIABLES LIKE &#39;collation_database&#39;;</code></td>
</tr>
<tr>
<td><strong>如何不区分大小写排序？</strong></td>
<td><code>ORDER BY name COLLATE utf8_general_ci;</code></td>
</tr>
<tr>
<td><strong>如何区分大小写排序？</strong></td>
<td><code>ORDER BY name COLLATE utf8mb4_bin;</code></td>
</tr>
<tr>
<td><strong>如何统一大小写排序？</strong></td>
<td><code>ORDER BY LOWER(name);</code> 或 <code>ORDER BY UPPER(name);</code></td>
</tr>
<tr>
<td><strong>如何修改表的排序规则？</strong></td>
<td><code>ALTER TABLE my_table MODIFY name VARCHAR(50) COLLATE utf8mb4_bin;</code></td>
</tr>
</tbody></table>
<h1 id="4-5-22-过滤-WHERE"><a href="#4-5-22-过滤-WHERE" class="headerlink" title="4&amp;5&#x2F;22 过滤 WHERE"></a>4&amp;5&#x2F;22 过滤 WHERE</h1><h2 id="使用-WHERE-过滤数据"><a href="#使用-WHERE-过滤数据" class="headerlink" title="使用 WHERE 过滤数据"></a><strong>使用 <code>WHERE</code> 过滤数据</strong></h2><p><code>WHERE</code> 语句用于筛选符合条件的行。<br>条件操作符规定如下：<img src="/images/sql%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A3.png" alt="操作符"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个查询会返回 <code>Customers</code> 表中 <strong><code>cust_country</code> 是 <code>&#39;USA&#39;</code></strong> 的所有记录。</li>
</ul>
<h2 id="过滤多个条件-AND-OR"><a href="#过滤多个条件-AND-OR" class="headerlink" title="过滤多个条件 (AND &#x2F; OR)"></a><strong>过滤多个条件 (<code>AND</code> &#x2F; <code>OR</code>)</strong></h2><p>你可以使用 <code>AND</code> 和 <code>OR</code> 结合多个条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> cust_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>只返回 <strong>国家是 <code>USA</code> 且州是 <code>CA</code>（加利福尼亚州）</strong> 的顾客。</li>
</ul>
<p>使用 <code>OR</code> 代表 <strong>满足任意条件即可</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> </span><br><span class="line"><span class="keyword">OR</span> cust_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>这个查询会返回 <strong>国家是 <code>USA</code> 或者州是 <code>CA</code> 的顾客</strong>（只要满足一个条件就行）。</li>
</ul>
<h2 id="使用-IN-过滤多个值"><a href="#使用-IN-过滤多个值" class="headerlink" title="使用 IN 过滤多个值"></a><strong>使用 <code>IN</code> 过滤多个值</strong></h2><p>如果你要查找某个字段<strong>匹配多个可能的值</strong>，可以用 <code>IN</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">&#x27;CA&#x27;</span>, <span class="string">&#x27;NY&#x27;</span>, <span class="string">&#x27;TX&#x27;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>返回 <strong><code>cust_state</code> 是 <code>&#39;CA&#39;</code>、<code>&#39;NY&#39;</code> 或 <code>&#39;TX&#39;</code></strong> 的所有客户。</li>
</ul>
<p><strong>等价于</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_state <span class="operator">=</span> <span class="string">&#x27;CA&#x27;</span> </span><br><span class="line"><span class="keyword">OR</span> cust_state <span class="operator">=</span> <span class="string">&#x27;NY&#x27;</span> </span><br><span class="line"><span class="keyword">OR</span> cust_state <span class="operator">=</span> <span class="string">&#x27;TX&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>但 <code>IN</code> 更简洁、更高效！</strong></p>
<h2 id="使用-BETWEEN-过滤范围"><a href="#使用-BETWEEN-过滤范围" class="headerlink" title="使用 BETWEEN 过滤范围"></a><strong>使用 <code>BETWEEN</code> 过滤范围</strong></h2><p><code>BETWEEN</code> 用于筛选某个范围内的数值或日期：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Orders </span><br><span class="line"><span class="keyword">WHERE</span> order_date <span class="keyword">BETWEEN</span> <span class="string">&#x27;2023-01-01&#x27;</span> <span class="keyword">AND</span> <span class="string">&#x27;2023-12-31&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回 <strong>订单日期在 2023 年内（包括 1 月 1 日和 12 月 31 日）</strong> 的所有订单。</li>
</ul>
<p>如果是数值范围：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products </span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="keyword">BETWEEN</span> <span class="number">10</span> <span class="keyword">AND</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回 <strong>价格在 10 到 50 之间的产品</strong>。</li>
</ul>
<h2 id="使用-LIKE-进行模糊匹配-1"><a href="#使用-LIKE-进行模糊匹配-1" class="headerlink" title="使用 LIKE 进行模糊匹配"></a><strong>使用 <code>LIKE</code> 进行模糊匹配</strong></h2><p><code>LIKE</code> 主要用于<strong>文本搜索</strong>，结合 <strong>通配符</strong>：</p>
<ul>
<li><code>%</code> 代表 <strong>0 个或多个字符</strong></li>
<li><code>_</code> 代表 <strong>任意 1 个字符</strong></li>
</ul>
<h3 id="常见-LIKE-语法"><a href="#常见-LIKE-语法" class="headerlink" title="常见 LIKE 语法"></a><strong>常见 <code>LIKE</code> 语法</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;F%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 <strong>所有以 <code>&quot;F&quot;</code> 开头</strong> 的客户（如 <code>Fun4All</code>）。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;%Toys&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 <strong>所有以 <code>&quot;Toys&quot;</code> 结尾</strong> 的客户（如 <code>Village Toys</code>）。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;%Store%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 <strong>名字中包含 <code>&quot;Store&quot;</code></strong> 的客户（如 <code>The Toy Store</code>）。</li>
</ul>
<h2 id="处理-NULL-值"><a href="#处理-NULL-值" class="headerlink" title="处理 NULL 值"></a><strong>处理 <code>NULL</code> 值</strong></h2><p>在 SQL 中，<code>NULL</code> 代表<strong>未知值</strong>，不能直接用 <code>=</code> 比较：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 <strong>没有填写 <code>cust_email</code>（为空）</strong> 的顾客。</li>
</ul>
<p>如果要查找<strong>非空的值</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NOT NULL</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>查找 <strong>有邮箱信息的顾客</strong>。</li>
</ul>
<h2 id="结合-ORDER-BY-进行排序"><a href="#结合-ORDER-BY-进行排序" class="headerlink" title="结合 ORDER BY 进行排序"></a><strong>结合 <code>ORDER BY</code> 进行排序</strong></h2><p>可以先<strong>过滤数据</strong>，然后<strong>排序</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products </span><br><span class="line"><span class="keyword">WHERE</span> prod_price <span class="operator">&gt;</span> <span class="number">20</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_price <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>先筛选 <strong>价格大于 20 的商品</strong>，然后按 <strong><code>prod_price</code> 降序排列</strong>。</li>
</ul>
<h2 id="结合-LIMIT-限制结果"><a href="#结合-LIMIT-限制结果" class="headerlink" title="结合 LIMIT 限制结果"></a><strong>结合 <code>LIMIT</code> 限制结果</strong></h2><p>如果你只想查看前几条记录，可以加 <code>LIMIT</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> cust_country <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span> </span><br><span class="line">LIMIT <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>返回 <strong>前 5 个来自 <code>USA</code> 的客户</strong>。</li>
</ul>
<table>
<thead>
<tr>
<th><strong>SQL 语句</strong></th>
<th><strong>功能</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>WHERE</code></td>
<td>按条件筛选数据</td>
</tr>
<tr>
<td><code>AND</code> &#x2F; <code>OR</code></td>
<td>组合多个条件</td>
</tr>
<tr>
<td><code>IN</code></td>
<td>匹配多个值</td>
</tr>
<tr>
<td><code>BETWEEN</code></td>
<td>过滤数值或日期范围</td>
</tr>
<tr>
<td><code>LIKE</code></td>
<td>模糊搜索</td>
</tr>
<tr>
<td><code>IS NULL</code> &#x2F; <code>IS NOT NULL</code></td>
<td>处理 <code>NULL</code> 值</td>
</tr>
<tr>
<td><code>ORDER BY</code></td>
<td>排序结果</td>
</tr>
<tr>
<td><code>LIMIT</code></td>
<td>限制返回的行数</td>
</tr>
</tbody></table>
<h1 id="6-22-通配符-谓词"><a href="#6-22-通配符-谓词" class="headerlink" title="6&#x2F;22 通配符&amp;谓词"></a>6&#x2F;22 通配符&amp;谓词</h1><p>通配符（Wildcard）和谓词（Predicate）在 SQL 里是不同的概念，虽然它们都可以用于查询时的筛选和匹配数据。</p>
<p><strong>通配符（Wildcard）</strong> 用于 <strong>模糊匹配</strong>，通常与 <code>LIKE</code> 结合使用。<br><strong>谓词（Predicate）</strong> 是 <strong>SQL 中的条件表达式</strong>，用于<strong>逻辑判断</strong>，决定哪些行符合查询条件。<br><strong>通配符是 <code>LIKE</code> 谓词的一部分，而谓词是更广泛的 SQL 逻辑条件。</strong></p>
<hr>
<h2 id="通配符（Wildcard）"><a href="#通配符（Wildcard）" class="headerlink" title="通配符（Wildcard）"></a><strong>通配符（Wildcard）</strong></h2><p><strong>通配符</strong>（Wildcard）用于<strong>模糊匹配文本</strong>，通常与 <code>LIKE</code> 结合使用。SQL 主要使用这两个通配符：</p>
<ol>
<li><strong><code>%</code>（百分号）：匹配 0 个或多个字符</strong></li>
<li><strong><code>_</code>（下划线）：匹配任意单个字符</strong></li>
</ol>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a><strong>示例</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找以 &quot;A&quot; 开头的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;A%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找名称中包含 &quot;Toy&quot; 的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;%Toy%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找名称为 5 个字符，并且第一个字符是 &quot;J&quot; 的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;J____&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>通配符适用于 <code>LIKE</code>，用于文本模式匹配，不适用于 <code>=</code>、<code>&gt;</code>、<code>&lt;</code> 等比较运算符。</strong></p>
<hr>
<h2 id="谓词（Predicate）"><a href="#谓词（Predicate）" class="headerlink" title="谓词（Predicate）"></a><strong>谓词（Predicate）</strong></h2><p><strong>谓词</strong>（Predicate）是 <strong>SQL 语句中的一个条件表达式</strong>，用于<strong>对数据进行逻辑判断</strong>，决定哪些行应该被选中。例如：</p>
<ul>
<li><code>=</code>（等于）</li>
<li><code>&gt;</code> &#x2F; <code>&lt;</code>（大于&#x2F;小于）</li>
<li><code>IN</code>（是否属于某个集合）</li>
<li><code>BETWEEN</code>（是否在某个范围内）</li>
<li><code>IS NULL</code>（是否为空）</li>
<li><code>LIKE</code>（是否匹配模式）</li>
</ul>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a><strong>示例</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 `=` 作为谓词：查找 `cust_name` 为 &quot;Fun4All&quot; 的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="operator">=</span> <span class="string">&#x27;Fun4All&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 `&gt;` 作为谓词：查找价格大于 50 的产品</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_price <span class="operator">&gt;</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--使用 `IN` 作为谓词：查找州是 CA、NY、TX 的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_state <span class="keyword">IN</span> (<span class="string">&#x27;CA&#x27;</span>, <span class="string">&#x27;NY&#x27;</span>, <span class="string">&#x27;TX&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--  使用 `BETWEEN` 作为谓词：查找价格在 10-50 之间的产品</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_price <span class="keyword">BETWEEN</span> <span class="number">10</span> <span class="keyword">AND</span> <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5️⃣ 使用 `IS NULL` 作为谓词：查找没有填写 Email 的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_email <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>
<p><strong>谓词是 SQL 语句中的逻辑条件，决定一行数据是否符合查询条件。</strong></p>
<hr>
<h2 id="通配符-vs-谓词-的关键区别"><a href="#通配符-vs-谓词-的关键区别" class="headerlink" title="通配符 vs 谓词 的关键区别"></a><strong>通配符 vs 谓词 的关键区别</strong></h2><table>
<thead>
<tr>
<th><strong>对比项</strong></th>
<th><strong>通配符（Wildcard）</strong></th>
<th><strong>谓词（Predicate）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>作用</strong></td>
<td>用于<strong>模式匹配</strong>文本</td>
<td>用于<strong>逻辑判断</strong></td>
</tr>
<tr>
<td><strong>常见运算符</strong></td>
<td><code>LIKE</code>（必须配合 <code>%</code> 或 <code>_</code>）</td>
<td><code>=</code>、<code>&gt;</code>、<code>&lt;</code>、<code>IN</code>、<code>BETWEEN</code>、<code>IS NULL</code> 等</td>
</tr>
<tr>
<td><strong>适用数据类型</strong></td>
<td>主要用于 <strong>字符串（TEXT）</strong></td>
<td>适用于<strong>所有数据类型</strong>（数值、日期、文本等）</td>
</tr>
<tr>
<td><strong>示例</strong></td>
<td><code>LIKE &#39;A%&#39;</code>（匹配以 A 开头的名字）</td>
<td><code>cust_state = &#39;CA&#39;</code>（找出加州的客户）</td>
</tr>
</tbody></table>
<hr>
<h2 id="结合通配符和谓词"><a href="#结合通配符和谓词" class="headerlink" title="结合通配符和谓词"></a><strong>结合通配符和谓词</strong></h2><p>在 SQL 中，通配符通常与 <code>LIKE</code> 这个谓词一起使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;A%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>而谓词还可以与其他运算符搭配：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_price <span class="operator">&gt;</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<p>所以：</p>
<ul>
<li><code>LIKE</code> 是一个 <strong>谓词</strong></li>
<li><code>%</code> 是 <code>LIKE</code> 谓词中使用的 <strong>通配符</strong></li>
<li><code>=</code>、<code>&gt;</code>、<code>&lt;</code>、<code>BETWEEN</code>、<code>IN</code> 等是其他 <strong>谓词</strong></li>
</ul>
<hr>
<h2 id="方括号通配符"><a href="#方括号通配符" class="headerlink" title="方括号通配符"></a>方括号通配符</h2><p><strong>方括号（<code>[]</code>）通配符</strong> 在某些数据库（如 <strong>SQL Server</strong>）中用于 <strong>匹配特定范围或集合内的字符</strong>，但 <strong>MySQL 不支持方括号通配符</strong>。</p>
<p><strong>方括号（<code>[]</code>）通配符的作用</strong><br><strong>匹配一组字符</strong>（任意一个）：  </p>
<ul>
<li><code>[abc]</code>：匹配 <code>a</code>、<code>b</code> 或 <code>c</code>（任意一个字符）<br><strong>匹配一个字符的范围</strong>：  </li>
<li><code>[A-Z]</code>：匹配 <code>A</code> 到 <code>Z</code> 之间的<strong>任何一个</strong>字符  </li>
<li><code>[0-9]</code>：匹配 <code>0</code> 到 <code>9</code> 之间的<strong>任何一个</strong>数字<br><strong>匹配排除的字符</strong>（<code>^</code> 放在 <code>[]</code> 内）：  </li>
<li><code>[^abc]</code>：<strong>不匹配</strong> <code>a</code>、<code>b</code> 或 <code>c</code>（排除这些字符）<br><strong>方括号（<code>[]</code>）通配符的示例</strong><br><strong>在 SQL Server（支持 <code>[]</code> 语法）中可以这样使用：</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查找以 A、B 或 C 开头的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;[ABC]%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找产品名称第一个字母是 A-Z 之间的产品</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name <span class="keyword">LIKE</span> <span class="string">&#x27;[A-Z]%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找第一个字符是数字（0-9）的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;[0-9]%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查找不以 A、B、C 开头的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name <span class="keyword">LIKE</span> <span class="string">&#x27;[^ABC]%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>MySQL 如何实现相同功能？</strong><br>💡 <strong>MySQL 不支持 <code>[]</code> 语法，但可以用 <code>REGEXP</code>（正则表达式）代替！</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 等价于 LIKE &#x27;[ABC]%&#x27;，匹配以 A、B 或 C 开头的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name REGEXP <span class="string">&#x27;^[ABC]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于 LIKE &#x27;[A-Z]%&#x27;，匹配第一个字母是 A-Z 的产品</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Products <span class="keyword">WHERE</span> prod_name REGEXP <span class="string">&#x27;^[A-Z]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于 LIKE &#x27;[0-9]%&#x27;，匹配第一个字符是数字的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name REGEXP <span class="string">&#x27;^[0-9]&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 等价于 LIKE &#x27;[^ABC]%&#x27;，匹配不以 A、B、C 开头的客户</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers <span class="keyword">WHERE</span> cust_name REGEXP <span class="string">&#x27;^[^ABC]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><code>REGEXP</code> 使用 <strong>正则表达式</strong>，<code>^</code> 表示<strong>开头</strong>，<code>[ABC]</code> 表示<strong>匹配 A、B 或 C</strong>。</p>
<table>
<thead>
<tr>
<th><strong>数据库</strong></th>
<th><strong>支持 <code>[]</code> 语法？</strong></th>
<th><strong>替代方案</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>SQL Server</strong></td>
<td>支持</td>
<td><code>LIKE &#39;[ABC]%&#39;</code></td>
</tr>
<tr>
<td><strong>MySQL</strong></td>
<td>❌ 不支持</td>
<td><code>REGEXP &#39;^[ABC]&#39;</code></td>
</tr>
<tr>
<td><strong>PostgreSQL</strong></td>
<td>❌ 不支持</td>
<td><code>SIMILAR TO &#39;[ABC]%&#39;</code> 或 <code>REGEXP</code></td>
</tr>
</tbody></table>
<p>**** 在 <strong>SQL Server</strong> 里 <code>LIKE &#39;[A-Z]%&#39;</code> 可以用 <strong>方括号通配符</strong>，但 <strong>MySQL 不支持</strong>，要改用 <strong><code>REGEXP</code></strong> 来实现类似功能。</p>
<h1 id="7-22-计算字段"><a href="#7-22-计算字段" class="headerlink" title="7&#x2F;22 计算字段"></a>7&#x2F;22 计算字段</h1><h2 id="计算字段（Calculated-Fields）是什么？"><a href="#计算字段（Calculated-Fields）是什么？" class="headerlink" title="计算字段（Calculated Fields）是什么？"></a><strong>计算字段（Calculated Fields）是什么？</strong></h2><p><strong>计算字段</strong>（也叫<strong>派生列</strong>）是 <strong>SQL 查询中动态计算的值</strong>，它并不直接存储在数据库表里，而是基于表中现有的字段进行计算，<strong>在查询时生成</strong>。</p>
<hr>
<h2 id="计算字段的常见用法"><a href="#计算字段的常见用法" class="headerlink" title="计算字段的常见用法"></a><strong>计算字段的常见用法</strong></h2><p>计算字段通常使用 <strong>算术运算符（<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>）或 SQL 函数（<code>CONCAT()</code>、<code>ROUND()</code>、<code>DATE_FORMAT()</code> 等）</strong> 来计算新的值。</p>
<hr>
<h2 id="计算字段的示例"><a href="#计算字段的示例" class="headerlink" title="计算字段的示例"></a><strong>计算字段的示例</strong></h2><h3 id="基本算术运算"><a href="#基本算术运算" class="headerlink" title="** 基本算术运算**"></a>** 基本算术运算**</h3><p>💡 <strong>示例：计算商品总价（单价 × 数量）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, quantity, item_price, quantity <span class="operator">*</span> item_price <span class="keyword">AS</span> total_price</span><br><span class="line"><span class="keyword">FROM</span> OrderItems;</span><br></pre></td></tr></table></figure>
<p><code>quantity * item_price</code> <strong>计算总价</strong>，并用 <code>AS total_price</code> <strong>起别名</strong>。</p>
<p><strong>查询结果示例</strong></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>quantity</th>
<th>item_price</th>
<th>total_price</th>
</tr>
</thead>
<tbody><tr>
<td>P001</td>
<td>2</td>
<td>10.00</td>
<td>20.00</td>
</tr>
<tr>
<td>P002</td>
<td>5</td>
<td>15.00</td>
<td>75.00</td>
</tr>
</tbody></table>
<hr>
<h3 id="连接字符串"><a href="#连接字符串" class="headerlink" title="连接字符串"></a><strong>连接字符串</strong></h3><p>💡 <strong>示例：把顾客的名字和国家拼接成一个字段</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_name, cust_country, CONCAT(cust_name, <span class="string">&#x27; (&#x27;</span>, cust_country, <span class="string">&#x27;)&#x27;</span>) <span class="keyword">AS</span> full_info</span><br><span class="line"><span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure>
<p><code>CONCAT()</code> <strong>拼接字符串</strong>，生成 <code>full_info</code> 字段。</p>
<p><strong>查询结果示例</strong></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>cust_country</th>
<th>full_info</th>
</tr>
</thead>
<tbody><tr>
<td>John Doe</td>
<td>USA</td>
<td>John Doe (USA)</td>
</tr>
<tr>
<td>Alice Lee</td>
<td>Canada</td>
<td>Alice Lee (Canada)</td>
</tr>
</tbody></table>
<hr>
<h3 id="处理日期数据"><a href="#处理日期数据" class="headerlink" title="处理日期数据"></a><strong>处理日期数据</strong></h3><p>💡 <strong>示例：获取订单年份</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, order_date, <span class="keyword">YEAR</span>(order_date) <span class="keyword">AS</span> order_year</span><br><span class="line"><span class="keyword">FROM</span> Orders;</span><br></pre></td></tr></table></figure>
<p><code>YEAR(order_date)</code> 提取 <strong>订单的年份</strong>。</p>
<p><strong>查询结果示例</strong></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>order_date</th>
<th>order_year</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>2024-02-20 10:30:00</td>
<td>2024</td>
</tr>
<tr>
<td>1002</td>
<td>2023-11-15 15:45:00</td>
<td>2023</td>
</tr>
</tbody></table>
<hr>
<h3 id="处理小数"><a href="#处理小数" class="headerlink" title="** 处理小数**"></a>** 处理小数**</h3><p>💡 <strong>示例：四舍五入商品价格</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, prod_price, ROUND(prod_price, <span class="number">1</span>) <span class="keyword">AS</span> rounded_price</span><br><span class="line"><span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure>
<p><code>ROUND(prod_price, 1)</code> 保留 <strong>一位小数</strong>。</p>
<p><strong>查询结果示例</strong></p>
<table>
<thead>
<tr>
<th>prod_id</th>
<th>prod_price</th>
<th>rounded_price</th>
</tr>
</thead>
<tbody><tr>
<td>P001</td>
<td>12.345</td>
<td>12.3</td>
</tr>
<tr>
<td>P002</td>
<td>19.876</td>
<td>19.9</td>
</tr>
</tbody></table>
<hr>
<h2 id="计算字段-vs-数据表字段"><a href="#计算字段-vs-数据表字段" class="headerlink" title="计算字段 vs 数据表字段"></a><strong>计算字段 vs 数据表字段</strong></h2><table>
<thead>
<tr>
<th><strong>比较</strong></th>
<th><strong>数据表字段（普通列）</strong></th>
<th><strong>计算字段（查询生成）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>是否存储</strong></td>
<td>存储在表里</td>
<td>❌ 只在查询时计算</td>
</tr>
<tr>
<td><strong>是否更新</strong></td>
<td>手动更新</td>
<td>每次查询自动计算</td>
</tr>
<tr>
<td><strong>示例</strong></td>
<td><code>price</code> 列</td>
<td><code>quantity * price</code></td>
</tr>
</tbody></table>
<p><strong>计算字段是基于表中现有数据动态生成的</strong>，不会修改数据库内容。<br>主要用于 <strong>计算数值、拼接字符串、格式化日期等</strong>，提高数据分析能力。<br><strong>用 <code>AS 别名</code> 让计算字段更易读</strong>（如 <code>AS total_price</code>）。  </p>
<h2 id="计算字段如何永久存储？"><a href="#计算字段如何永久存储？" class="headerlink" title="计算字段如何永久存储？"></a><strong>计算字段如何永久存储？</strong></h2><p>计算字段是 <strong>查询时动态计算的</strong>，如果想让它 <strong>永久存在</strong>，有以下 <strong>3 种方法</strong>：</p>
<h3 id="方法-1：在表中新增列，并手动更新"><a href="#方法-1：在表中新增列，并手动更新" class="headerlink" title="方法 1：在表中新增列，并手动更新"></a><strong>方法 1：在表中新增列，并手动更新</strong></h3><p>如果计算结果不常变，可以在表中 <strong>新增列</strong>，然后用 <code>UPDATE</code> 语句手动填充计算值。</p>
<p>💡 <strong>在 <code>OrderItems</code> 表中增加 <code>total_price</code>（总价）列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> OrderItems <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> total_price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>💡 <strong>用 <code>UPDATE</code> 填充总价</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> OrderItems</span><br><span class="line"><span class="keyword">SET</span> total_price <span class="operator">=</span> quantity <span class="operator">*</span> item_price;</span><br></pre></td></tr></table></figure>
<p><strong>好处</strong>：数据不会因为查询变动，但如果价格或数量变化，需要重新 <code>UPDATE</code>。</p>
<h3 id="方法-2：使用-GENERATED-COLUMN（生成列）"><a href="#方法-2：使用-GENERATED-COLUMN（生成列）" class="headerlink" title="方法 2：使用 GENERATED COLUMN（生成列）"></a><strong>方法 2：使用 <code>GENERATED COLUMN</code>（生成列）</strong></h3><p>如果计算逻辑固定，可以使用 <strong>生成列（虚拟列）</strong>，让 MySQL 自动计算。</p>
<p>💡 <strong>创建 <code>total_price</code> 为 <code>quantity * item_price</code> 的生成列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> OrderItems <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> total_price <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) </span><br><span class="line">GENERATED ALWAYS <span class="keyword">AS</span> (quantity <span class="operator">*</span> item_price) STORED;</span><br></pre></td></tr></table></figure>
<p><strong>特点</strong>：</p>
<ul>
<li><code>STORED</code>（存储列）：计算结果 <strong>存入表</strong>，像普通字段一样使用，提高查询效率。</li>
<li><code>VIRTUAL</code>（虚拟列，默认值）：不占用存储空间，每次查询时动态计算。</li>
</ul>
<p>💡 <strong>区别</strong></p>
<table>
<thead>
<tr>
<th>方式</th>
<th>是否存储</th>
<th>何时计算</th>
<th>适用场景</th>
</tr>
</thead>
<tbody><tr>
<td><code>STORED</code></td>
<td>存储</td>
<td><strong>插入&#x2F;更新时计算</strong></td>
<td>需要频繁查询计算值</td>
</tr>
<tr>
<td><code>VIRTUAL</code></td>
<td>❌ 不存储</td>
<td><strong>查询时计算</strong></td>
<td>计算值变化较少</td>
</tr>
</tbody></table>
<h3 id="方法-3：创建新表存储计算字段"><a href="#方法-3：创建新表存储计算字段" class="headerlink" title="方法 3：创建新表存储计算字段"></a><strong>方法 3：创建新表存储计算字段</strong></h3><p>如果计算字段来源于多个表，可以 <strong>创建一个新表</strong> 来存储计算结果。</p>
<p>💡 <strong>创建 <code>OrderSummary</code> 表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> OrderSummary <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> order_num, quantity <span class="operator">*</span> item_price <span class="keyword">AS</span> total_price</span><br><span class="line"><span class="keyword">FROM</span> OrderItems;</span><br></pre></td></tr></table></figure>
<p><strong>优点</strong>：加快查询速度，避免重复计算。<br><strong>缺点</strong>：数据可能会过时，<strong>需要定期刷新</strong>。</p>
<p>💡 <strong>定期刷新数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> OrderSummary;</span><br><span class="line"><span class="keyword">INSERT INTO</span> OrderSummary</span><br><span class="line"><span class="keyword">SELECT</span> order_num, quantity <span class="operator">*</span> item_price <span class="keyword">AS</span> total_price</span><br><span class="line"><span class="keyword">FROM</span> OrderItems;</span><br></pre></td></tr></table></figure>

<hr>
<table>
<thead>
<tr>
<th>方法</th>
<th>适用场景</th>
<th>是否存储</th>
<th>何时计算</th>
</tr>
</thead>
<tbody><tr>
<td><strong>手动 <code>UPDATE</code></strong></td>
<td><strong>数据变化不频繁</strong></td>
<td>是</td>
<td>需要手动更新</td>
</tr>
<tr>
<td><strong><code>GENERATED COLUMN</code></strong></td>
<td><strong>计算逻辑简单</strong></td>
<td>是（<code>STORED</code>） &#x2F; ❌ 否（<code>VIRTUAL</code>）</td>
<td>自动计算</td>
</tr>
<tr>
<td><strong>新表存储</strong></td>
<td><strong>跨表计算、大量数据</strong></td>
<td>是</td>
<td>需要手动更新</td>
</tr>
</tbody></table>
<p><strong>如果计算值经常变更，建议使用 <code>GENERATED COLUMN</code> 或创建新表来存储计算结果！</strong> </p>
<h1 id="8-22-函数"><a href="#8-22-函数" class="headerlink" title="8&#x2F;22 函数"></a>8&#x2F;22 函数</h1><h2 id="文本函数（Text-Functions）"><a href="#文本函数（Text-Functions）" class="headerlink" title="文本函数（Text Functions）"></a><strong>文本函数（Text Functions）</strong></h2><p><strong>作用：</strong> 处理字符串，如去除空格、大小写转换、拼接等。</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>TRIM(str)</code></td>
<td>去除首尾空格</td>
<td><code>SELECT TRIM(&#39;  Hello  &#39;);</code> → <code>&quot;Hello&quot;</code></td>
</tr>
<tr>
<td><code>LENGTH(str)</code></td>
<td>返回字节长度（UTF-8 可能占 2-4 字节）</td>
<td><code>SELECT LENGTH(&#39;你好&#39;);</code> → <code>6</code></td>
</tr>
<tr>
<td><code>CHAR_LENGTH(str)</code></td>
<td>返回字符个数</td>
<td><code>SELECT CHAR_LENGTH(&#39;你好&#39;);</code> → <code>2</code></td>
</tr>
<tr>
<td><code>UPPER(str)</code> &#x2F; <code>LOWER(str)</code></td>
<td>转换大小写</td>
<td><code>SELECT UPPER(&#39;hello&#39;);</code> → <code>&quot;HELLO&quot;</code></td>
</tr>
<tr>
<td><code>SUBSTRING(str, start, length)</code></td>
<td>截取子字符串</td>
<td><code>SELECT SUBSTRING(&#39;abcdef&#39;, 2, 3);</code> → <code>&quot;bcd&quot;</code></td>
</tr>
<tr>
<td><code>CONCAT(str1, str2, ...)</code></td>
<td>连接字符串</td>
<td><code>SELECT CONCAT(&#39;Hello&#39;, &#39; &#39;, &#39;World&#39;);</code> → <code>&quot;Hello World&quot;</code></td>
</tr>
<tr>
<td><code>REPLACE(str, from, to)</code></td>
<td>替换字符串</td>
<td><code>SELECT REPLACE(&#39;hello world&#39;, &#39;world&#39;, &#39;MySQL&#39;);</code> → <code>&quot;hello MySQL&quot;</code></td>
</tr>
</tbody></table>
<p><strong>示例</strong>：<strong>去除空格 + 拼接字符串</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(<span class="built_in">TRIM</span>(<span class="string">&#x27;  MySQL &#x27;</span>), <span class="string">&#x27; Rocks!&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p> 结果：<code>&quot;MySQL Rocks!&quot;</code></p>
<hr>
<h2 id="数值函数（Numeric-Functions）"><a href="#数值函数（Numeric-Functions）" class="headerlink" title="数值函数（Numeric Functions）"></a><strong>数值函数（Numeric Functions）</strong></h2><p><strong>作用：</strong> 进行数学运算，如取绝对值、四舍五入等。</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>ABS(x)</code></td>
<td>绝对值</td>
<td><code>SELECT ABS(-10);</code> → <code>10</code></td>
</tr>
<tr>
<td><code>ROUND(x, d)</code></td>
<td>四舍五入到 d 位小数</td>
<td><code>SELECT ROUND(3.14159, 2);</code> → <code>3.14</code></td>
</tr>
<tr>
<td><code>CEIL(x)</code> &#x2F; <code>FLOOR(x)</code></td>
<td>向上&#x2F;向下取整</td>
<td><code>SELECT CEIL(3.1);</code> → <code>4</code> &#x2F; <code>SELECT FLOOR(3.9);</code> → <code>3</code></td>
</tr>
<tr>
<td><code>RAND()</code></td>
<td>生成 0~1 之间的随机数</td>
<td><code>SELECT RAND();</code></td>
</tr>
<tr>
<td><code>MOD(x, y)</code></td>
<td>取余数</td>
<td><code>SELECT MOD(10, 3);</code> → <code>1</code></td>
</tr>
<tr>
<td><code>POW(x, y)</code> 或 <code>POWER(x, y)</code></td>
<td>求 x 的 y 次方</td>
<td><code>SELECT POW(2, 3);</code> → <code>8</code></td>
</tr>
</tbody></table>
<p><strong>示例</strong>：<strong>计算折扣价格</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, ROUND(prod_price <span class="operator">*</span> <span class="number">0.9</span>, <span class="number">2</span>) <span class="keyword">AS</span> discount_price </span><br><span class="line"><span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure>
<p> 计算 <code>prod_price</code> 的 90% 并四舍五入到 2 位小数。</p>
<hr>
<h2 id="日期和时间函数（Date-and-Time-Functions）"><a href="#日期和时间函数（Date-and-Time-Functions）" class="headerlink" title="日期和时间函数（Date and Time Functions）"></a><strong>日期和时间函数（Date and Time Functions）</strong></h2><p><strong>作用：</strong> 处理日期和时间，计算时间间隔等。</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>NOW()</code></td>
<td>获取当前时间</td>
<td><code>SELECT NOW();</code></td>
</tr>
<tr>
<td><code>CURDATE()</code> &#x2F; <code>CURTIME()</code></td>
<td>获取当前日期&#x2F;时间</td>
<td><code>SELECT CURDATE();</code> → <code>2025-02-23</code></td>
</tr>
<tr>
<td><code>YEAR(date)</code> &#x2F; <code>MONTH(date)</code> &#x2F; <code>DAY(date)</code></td>
<td>获取年份、月份、日期</td>
<td><code>SELECT YEAR(&#39;2024-12-25&#39;);</code> → <code>2024</code></td>
</tr>
<tr>
<td><code>DATE_FORMAT(date, format)</code></td>
<td>按指定格式输出日期</td>
<td><code>SELECT DATE_FORMAT(NOW(), &#39;%Y-%m-%d %H:%i:%s&#39;);</code></td>
</tr>
<tr>
<td><code>TIMESTAMPDIFF(unit, date1, date2)</code></td>
<td>计算时间差</td>
<td><code>SELECT TIMESTAMPDIFF(DAY, &#39;2024-01-01&#39;, &#39;2025-01-01&#39;);</code> → <code>366</code></td>
</tr>
<tr>
<td><code>ADDDATE(date, INTERVAL n DAY)</code></td>
<td>增加日期</td>
<td><code>SELECT ADDDATE(&#39;2024-01-01&#39;, INTERVAL 10 DAY);</code> → <code>2024-01-11</code></td>
</tr>
</tbody></table>
<p><strong>示例</strong>：<strong>计算订单提交后的 7 天发货日期</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num, order_date, ADDDATE(order_date, <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>) <span class="keyword">AS</span> ship_date </span><br><span class="line"><span class="keyword">FROM</span> Orders;</span><br></pre></td></tr></table></figure>
<p> 计算订单日期加 7 天的发货日期。</p>
<hr>
<h2 id="格式化函数（Formatting-Functions）"><a href="#格式化函数（Formatting-Functions）" class="headerlink" title="格式化函数（Formatting Functions）"></a><strong>格式化函数（Formatting Functions）</strong></h2><p><strong>作用：</strong> 让数据更易读，如格式化数字、金额等。</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>FORMAT(x, d)</code></td>
<td>数字格式化（四舍五入）</td>
<td><code>SELECT FORMAT(1234567.891, 2);</code> → <code>&quot;1,234,567.89&quot;</code></td>
</tr>
<tr>
<td><code>LPAD(str, len, padstr)</code> &#x2F; <code>RPAD(str, len, padstr)</code></td>
<td>左&#x2F;右填充</td>
<td><code>SELECT LPAD(&#39;123&#39;, 5, &#39;0&#39;);</code> → <code>&quot;00123&quot;</code></td>
</tr>
<tr>
<td><code>DATE_FORMAT(date, format)</code></td>
<td>格式化日期</td>
<td><code>SELECT DATE_FORMAT(NOW(), &#39;%W, %M %d, %Y&#39;);</code></td>
</tr>
</tbody></table>
<p><strong>示例</strong>：<strong>格式化金额</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, FORMAT(prod_price, <span class="number">2</span>) <span class="keyword">AS</span> formatted_price </span><br><span class="line"><span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure>
<p> 让价格带有千分位和两位小数，如 <code>&quot;1,234.56&quot;</code>。</p>
<hr>
<h2 id="系统函数（System-Functions）"><a href="#系统函数（System-Functions）" class="headerlink" title="系统函数（System Functions）"></a><strong>系统函数（System Functions）</strong></h2><p><strong>作用：</strong> 获取数据库信息，如当前用户、数据库名等。</p>
<table>
<thead>
<tr>
<th><strong>函数</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>USER()</code></td>
<td>获取当前用户</td>
<td><code>SELECT USER();</code></td>
</tr>
<tr>
<td><code>DATABASE()</code></td>
<td>获取当前数据库名</td>
<td><code>SELECT DATABASE();</code></td>
</tr>
<tr>
<td><code>VERSION()</code></td>
<td>获取 MySQL 版本</td>
<td><code>SELECT VERSION();</code></td>
</tr>
<tr>
<td><code>@@GLOBAL.variable_name</code></td>
<td>查看全局变量</td>
<td><code>SELECT @@GLOBAL.time_zone;</code></td>
</tr>
<tr>
<td><code>@@SESSION.variable_name</code></td>
<td>查看当前会话变量</td>
<td><code>SELECT @@SESSION.autocommit;</code></td>
</tr>
</tbody></table>
<p><strong>示例</strong>：<strong>获取当前用户和数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>(), DATABASE();</span><br></pre></td></tr></table></figure>
<p> 可能返回：<code>&quot;root@localhost&quot;, &quot;toy_store&quot;</code></p>
<hr>
<p><strong>MySQL 常用函数：</strong></p>
<ol>
<li><strong>📄 文本函数</strong>（<code>CONCAT</code>、<code>LENGTH</code>、<code>TRIM</code>、<code>UPPER</code>、<code>REPLACE</code>）</li>
<li><strong>🔢 数值函数</strong>（<code>ABS</code>、<code>ROUND</code>、<code>MOD</code>、<code>POW</code>）</li>
<li><strong>📆 日期时间函数</strong>（<code>NOW</code>、<code>YEAR</code>、<code>DATE_FORMAT</code>、<code>ADDDATE</code>）</li>
<li><strong>🎨 格式化函数</strong>（<code>FORMAT</code>、<code>LPAD</code>、<code>DATE_FORMAT</code>）</li>
<li><strong>💻 系统函数</strong>（<code>USER</code>、<code>DATABASE</code>、<code>VERSION</code>）</li>
</ol>
<h2 id="一些其他"><a href="#一些其他" class="headerlink" title="一些其他"></a>一些其他</h2><h3 id="SOUNDEX-函数"><a href="#SOUNDEX-函数" class="headerlink" title="SOUNDEX() 函数"></a><strong>SOUNDEX() 函数</strong></h3><h4 id="SOUNDEX-在-MySQL-中的用法"><a href="#SOUNDEX-在-MySQL-中的用法" class="headerlink" title="SOUNDEX() 在 MySQL 中的用法"></a><strong>SOUNDEX() 在 MySQL 中的用法</strong></h4><p><code>SOUNDEX()</code> 是一个通用的 <strong>音码（Soundex）</strong> 函数，MySQL <strong>支持</strong> 这个函数。它用于将<strong>单词转换为其发音编码</strong>，以便能够对<strong>发音相似但拼写不同</strong>的单词进行比较。  </p>
<p><code>SOUNDEX(str)</code> 会返回一个 4 字符的字符串：</p>
<ul>
<li>第一个字符是 <strong>字符串的首字母</strong>。</li>
<li>其余字符是 <strong>数字（0-9）</strong>，基于发音相似性编码。</li>
</ul>
<p><strong>示例 1：简单演示</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SOUNDEX(<span class="string">&#x27;hello&#x27;</span>), SOUNDEX(<span class="string">&#x27;hallo&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>可能的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------------+</span><br><span class="line">| SOUNDEX(&#x27;hello&#x27;) | SOUNDEX(&#x27;hallo&#x27;) |</span><br><span class="line">+---------------+---------------+</span><br><span class="line">| H400          | H400          |</span><br><span class="line">+---------------+---------------+</span><br></pre></td></tr></table></figure>
<p><strong>解释</strong>：  </p>
<ul>
<li>“hello” 和 “hallo” 的 SOUNDEX 代码相同，说明它们的发音相似。</li>
</ul>
<p><strong>示例 2：不同单词的 SOUNDEX</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SOUNDEX(<span class="string">&#x27;cat&#x27;</span>), SOUNDEX(<span class="string">&#x27;kat&#x27;</span>), SOUNDEX(<span class="string">&#x27;cot&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>可能的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| SOUNDEX(&#x27;cat&#x27;) | SOUNDEX(&#x27;kat&#x27;) | SOUNDEX(&#x27;cot&#x27;) |</span><br><span class="line">+-------------+-------------+-------------+</span><br><span class="line">| C300        | K300        | C300        |</span><br><span class="line">+-------------+-------------+-------------+</span><br></pre></td></tr></table></figure>
<p><strong>解释</strong>：  </p>
<ul>
<li>“cat” 和 “cot” 的代码一样（C300），因为它们的发音相似。  </li>
<li>“kat” 的代码是 K300，表明它和 “cat” 不完全一样。</li>
</ul>
<hr>
<h4 id="SOUNDEX-的应用"><a href="#SOUNDEX-的应用" class="headerlink" title="SOUNDEX() 的应用"></a><strong>SOUNDEX() 的应用</strong></h4><p>** 查找发音相似的名字**<br>如果数据库中存储了一堆名字，我们可以使用 <code>SOUNDEX()</code> 来查找拼写不同但发音相似的名字。例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> Customers </span><br><span class="line"><span class="keyword">WHERE</span> SOUNDEX(name) <span class="operator">=</span> SOUNDEX(<span class="string">&#x27;Jon&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这可以匹配 “Jon”, “John”, “Jhon” 这些发音类似的名字。</p>
<p><strong>处理用户输入错误</strong><br>如果用户输入了拼写错误的查询，比如 <code>&quot;recieve&quot;</code> 而不是 <code>&quot;receive&quot;</code>，可以用 <code>SOUNDEX()</code> 来找到正确的单词。</p>
<hr>
<h4 id="SOUNDEX-的局限性"><a href="#SOUNDEX-的局限性" class="headerlink" title="SOUNDEX() 的局限性"></a><strong>SOUNDEX() 的局限性</strong></h4><p><strong>优点</strong>：</p>
<ul>
<li>能够匹配发音相似的单词，不受拼写错误影响。</li>
</ul>
<p>❌ <strong>缺点</strong>：</p>
<ul>
<li>仅适用于 <strong>英语</strong>，对于 <strong>中文、日语等非拉丁语系</strong> 不适用。</li>
<li>可能会有<strong>误匹配</strong>，比如 <code>&quot;Robert&quot;</code> 和 <code>&quot;Rupert&quot;</code> 可能会返回相同的 SOUNDEX 值。</li>
</ul>
<h1 id="9-10-22-聚集-分组函数"><a href="#9-10-22-聚集-分组函数" class="headerlink" title="9&amp;10&#x2F;22 聚集&#x2F;分组函数"></a>9&amp;10&#x2F;22 聚集&#x2F;分组函数</h1><p>聚集函数（<strong>Aggregate Functions</strong>）在 SQL 中非常重要，它们对一组数据进行计算并返回单一的值。常见的聚集函数包括 <code>COUNT()</code>, <code>SUM()</code>, <code>AVG()</code>, <code>MIN()</code>, <code>MAX()</code> 等。它们通常与 <code>GROUP BY</code> 子句一起使用，用于按某些条件分组数据并进行汇总计算。</p>
<h2 id="COUNT-计算记录的数量"><a href="#COUNT-计算记录的数量" class="headerlink" title="COUNT(): 计算记录的数量"></a><strong><code>COUNT()</code></strong>: 计算记录的数量</h2><ul>
<li><p><strong>功能</strong>：返回某列（或所有列）中非 <code>NULL</code> 值的数量。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">COUNT</span>([<span class="keyword">DISTINCT</span>] column_name)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>DISTINCT</code>：可选参数，去重计数。</li>
</ul>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算 Customers 表中所有非空 cust_id 的数量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(cust_id) <span class="keyword">FROM</span> Customers;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 计算不同国家的数量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cust_country) <span class="keyword">FROM</span> Customers;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="SUM-计算数值列的总和"><a href="#SUM-计算数值列的总和" class="headerlink" title="SUM(): 计算数值列的总和"></a><strong><code>SUM()</code></strong>: 计算数值列的总和</h2><ul>
<li><p><strong>功能</strong>：返回一列数值型数据的总和。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">SUM</span>(column_name)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算 Products 表中所有产品的价格总和</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(prod_price) <span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="AVG-计算数值列的平均值"><a href="#AVG-计算数值列的平均值" class="headerlink" title="AVG(): 计算数值列的平均值"></a><strong><code>AVG()</code></strong>: 计算数值列的平均值</h2><ul>
<li><p><strong>功能</strong>：返回数值列的平均值。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVG</span>(column_name)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 计算 Products 表中所有产品价格的平均值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(prod_price) <span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="MIN-获取最小值"><a href="#MIN-获取最小值" class="headerlink" title="MIN(): 获取最小值"></a><strong><code>MIN()</code></strong>: 获取最小值</h2><ul>
<li><p><strong>功能</strong>：返回一列中的最小值。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MIN</span>(column_name)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取 Orders 表中最早的订单日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(order_date) <span class="keyword">FROM</span> Orders;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="MAX-获取最大值"><a href="#MAX-获取最大值" class="headerlink" title="MAX(): 获取最大值"></a><strong><code>MAX()</code></strong>: 获取最大值</h2><ul>
<li><p><strong>功能</strong>：返回一列中的最大值。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MAX</span>(column_name)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取 Products 表中最高的产品价格</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(prod_price) <span class="keyword">FROM</span> Products;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="GROUP-CONCAT-连接多个行的值"><a href="#GROUP-CONCAT-连接多个行的值" class="headerlink" title="GROUP_CONCAT(): 连接多个行的值"></a><strong><code>GROUP_CONCAT()</code></strong>: 连接多个行的值</h2><ul>
<li><p><strong>功能</strong>：将多个行的值连接成一个字符串，并按指定的分隔符进行分隔。</p>
</li>
<li><p><strong>语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT(column_name [SEPARATOR <span class="string">&#x27;separator&#x27;</span>])</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>例子</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取每个供应商的所有产品名，产品名之间用逗号分隔</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, GROUP_CONCAT(prod_name SEPARATOR <span class="string">&#x27;, &#x27;</span>) <span class="keyword">FROM</span> Products <span class="keyword">GROUP</span> <span class="keyword">BY</span> vend_id;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="使用-GROUP-BY-子句结合聚集函数"><a href="#使用-GROUP-BY-子句结合聚集函数" class="headerlink" title="使用 GROUP BY 子句结合聚集函数"></a>使用 <code>GROUP BY</code> 子句结合聚集函数</h2><p>聚集函数通常与 <code>GROUP BY</code> 子句一起使用，<code>GROUP BY</code> 会把数据分成不同的组，然后你可以对每组数据应用聚集函数。</p>
<h3 id="例子：按顾客分组，计算每个顾客的订单数量"><a href="#例子：按顾客分组，计算每个顾客的订单数量" class="headerlink" title="例子：按顾客分组，计算每个顾客的订单数量"></a><strong>例子：按顾客分组，计算每个顾客的订单数量</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="built_in">COUNT</span>(order_num) <span class="keyword">AS</span> order_count</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id;</span><br></pre></td></tr></table></figure>

<h3 id="例子：按产品分组，计算每个产品的总销售数量"><a href="#例子：按产品分组，计算每个产品的总销售数量" class="headerlink" title="例子：按产品分组，计算每个产品的总销售数量"></a><strong>例子：按产品分组，计算每个产品的总销售数量</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, <span class="built_in">SUM</span>(quantity) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_id;</span><br></pre></td></tr></table></figure>

<h2 id="HAVING-子句：对分组后的数据进行筛选"><a href="#HAVING-子句：对分组后的数据进行筛选" class="headerlink" title="HAVING 子句：对分组后的数据进行筛选"></a><strong><code>HAVING</code> 子句：对分组后的数据进行筛选</strong></h2><ul>
<li><strong>功能</strong>：<code>HAVING</code> 子句与 <code>GROUP BY</code> 一起使用，用于对分组结果进行过滤。<code>HAVING</code> 子句一般在聚集函数的结果上进行筛选，而 <code>WHERE</code> 子句用于行级别的筛选。</li>
</ul>
<h3 id="例子：筛选出销售总额超过-500-的产品"><a href="#例子：筛选出销售总额超过-500-的产品" class="headerlink" title="例子：筛选出销售总额超过 500 的产品"></a><strong>例子：筛选出销售总额超过 500 的产品</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_id, <span class="built_in">SUM</span>(quantity <span class="operator">*</span> item_price) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> OrderItems</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> prod_id</span><br><span class="line"><span class="keyword">HAVING</span> total_sales <span class="operator">&gt;</span> <span class="number">500</span>;</span><br></pre></td></tr></table></figure>

<h2 id="常见的聚集函数总结："><a href="#常见的聚集函数总结：" class="headerlink" title="常见的聚集函数总结："></a>常见的聚集函数总结：</h2><table>
<thead>
<tr>
<th>聚集函数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>COUNT()</code></td>
<td>计算行数（非空）</td>
</tr>
<tr>
<td><code>SUM()</code></td>
<td>计算数值列的总和</td>
</tr>
<tr>
<td><code>AVG()</code></td>
<td>计算数值列的平均值</td>
</tr>
<tr>
<td><code>MIN()</code></td>
<td>计算数值列的最小值</td>
</tr>
<tr>
<td><code>MAX()</code></td>
<td>计算数值列的最大值</td>
</tr>
<tr>
<td><code>GROUP_CONCAT()</code></td>
<td>连接多个行的值（在 MySQL 中可用）</td>
</tr>
</tbody></table>
<h3 id="进阶：使用-WITH-ROLLUP-扩展-GROUP-BY"><a href="#进阶：使用-WITH-ROLLUP-扩展-GROUP-BY" class="headerlink" title="进阶：使用 WITH ROLLUP 扩展 GROUP BY"></a>进阶：使用 <code>WITH ROLLUP</code> 扩展 <code>GROUP BY</code></h3><ul>
<li><strong>功能</strong>：<code>WITH ROLLUP</code> 可以在 <code>GROUP BY</code> 后生成额外的汇总行，显示每个分组和整体的汇总信息。</li>
</ul>
<h3 id="例子：统计每个顾客的订单数量，同时显示所有顾客的总订单数量"><a href="#例子：统计每个顾客的订单数量，同时显示所有顾客的总订单数量" class="headerlink" title="例子：统计每个顾客的订单数量，同时显示所有顾客的总订单数量"></a><strong>例子：统计每个顾客的订单数量，同时显示所有顾客的总订单数量</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="built_in">COUNT</span>(order_num) <span class="keyword">AS</span> order_count</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id <span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>结果</strong>：这个查询会显示每个顾客的订单数量，还会额外显示一个总行，表示所有顾客的订单总数。</li>
</ul>
<hr>
<h2 id="HAVING-和-WHERE区别："><a href="#HAVING-和-WHERE区别：" class="headerlink" title="HAVING 和 WHERE区别："></a><strong><code>HAVING</code> 和 <code>WHERE</code>区别</strong>：</h2><table>
<thead>
<tr>
<th>关键点</th>
<th><code>WHERE</code></th>
<th><code>HAVING</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>作用对象</strong></td>
<td>过滤<strong>行数据</strong>（表的原始数据）</td>
<td>过滤<strong>分组后的数据</strong>（<code>GROUP BY</code> 之后的结果）</td>
</tr>
<tr>
<td><strong>执行顺序</strong></td>
<td>在 <code>GROUP BY</code> 之前执行（先过滤数据再分组）</td>
<td>在 <code>GROUP BY</code> 之后执行（先分组再过滤）</td>
</tr>
<tr>
<td><strong>能否使用聚合函数</strong></td>
<td>❌ 不能使用聚合函数</td>
<td>可以使用聚合函数（如 <code>SUM()</code>, <code>COUNT()</code>）</td>
</tr>
</tbody></table>
<p><strong>🛠 WHERE 先筛选，后分组</strong><br> 适用于<strong>在分组前</strong>筛选行数据<br><strong>示例：查询价格高于 10 的商品，并按类别分组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> category, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> product_count</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> price <span class="operator">&gt;</span> <span class="number">10</span>   <span class="comment">-- 先筛选价格大于10的商品</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category;</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序</strong>：</p>
<ol>
<li>先从 <code>Products</code> 表中筛选 <code>price &gt; 10</code> 的商品</li>
<li>然后对符合条件的商品按照 <code>category</code> 进行分组</li>
<li>统计每个分类的产品数量</li>
</ol>
<p><strong>🛠 HAVING 先分组，后筛选</strong><br> 适用于<strong>在分组后</strong>筛选分组数据<br><strong>示例：查询</strong>所有商品<strong>按类别分组，<strong>只保留</strong>商品数量大于 3 的类别</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> category, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> product_count</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">3</span>;   <span class="comment">-- 先分组，再筛选</span></span><br></pre></td></tr></table></figure>
<p> <strong>执行顺序</strong>：</p>
<ol>
<li>先按照 <code>category</code> 进行分组</li>
<li>计算每个 <code>category</code> 的产品数量</li>
<li>过滤出 <code>COUNT(*) &gt; 3</code> 的类别</li>
</ol>
<p><strong>🛠WHERE + HAVING 结合使用</strong><br>有时候需要同时使用 <code>WHERE</code> 和 <code>HAVING</code>，<strong>先用 <code>WHERE</code> 过滤行数据，再用 <code>HAVING</code> 过滤分组数据</strong>。<br><strong>示例：查询价格高于 10 的商品，并按类别分组，仅显示商品数量大于 3 的类别</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> category, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> product_count</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">WHERE</span> price <span class="operator">&gt;</span> <span class="number">10</span>        <span class="comment">-- 先筛选，去掉低价产品</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">3</span>;    <span class="comment">-- 再筛选分组结果</span></span><br></pre></td></tr></table></figure>
<p> <strong>执行顺序</strong>：</p>
<ol>
<li><code>WHERE price &gt; 10</code> 先筛选商品，去掉低价产品</li>
<li><code>GROUP BY category</code> 按类别分组</li>
<li><code>HAVING COUNT(*) &gt; 3</code> 过滤出商品数量大于 3 的类别</li>
</ol>
<hr>
<p><strong>⏳ 结论</strong></p>
<table>
<thead>
<tr>
<th><strong>使用场景</strong></th>
<th><strong>WHERE</strong></th>
<th><strong>HAVING</strong></th>
</tr>
</thead>
<tbody><tr>
<td>直接筛选行数据</td>
<td>是</td>
<td>❌ 否</td>
</tr>
<tr>
<td>过滤分组后的数据</td>
<td>❌ 否</td>
<td>是</td>
</tr>
<tr>
<td>适用于普通列</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>适用于聚合函数</td>
<td>❌ 否</td>
<td>是</td>
</tr>
</tbody></table>
<ul>
<li><strong>WHERE 过滤原始数据</strong>，<code>GROUP BY</code> <strong>之前</strong>执行</li>
<li><strong>HAVING 过滤分组数据</strong>，<code>GROUP BY</code> <strong>之后</strong>执行</li>
</ul>
<hr>
<h2 id="GROUP-BY-和-ORDER-BY-区别"><a href="#GROUP-BY-和-ORDER-BY-区别" class="headerlink" title="GROUP BY 和 ORDER BY 区别"></a><strong><code>GROUP BY</code> 和 <code>ORDER BY</code> 区别</strong></h2><table>
<thead>
<tr>
<th>关键点</th>
<th><code>GROUP BY</code></th>
<th><code>ORDER BY</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>作用</strong></td>
<td><strong>分组数据</strong>，对结果进行<strong>聚合计算</strong></td>
<td><strong>排序数据</strong>，调整查询结果的顺序</td>
</tr>
<tr>
<td><strong>影响的数据</strong></td>
<td>影响查询结果的<strong>行数</strong>（减少行数）</td>
<td>仅改变行的排列顺序，不影响行数</td>
</tr>
<tr>
<td><strong>是否可用聚合函数</strong></td>
<td>必须结合聚合函数（<code>COUNT()</code>、<code>SUM()</code>等）</td>
<td>❌ 不要求使用聚合函数</td>
</tr>
<tr>
<td><strong>执行顺序</strong></td>
<td>先执行 <code>GROUP BY</code>（在 <code>WHERE</code> 之后）</td>
<td>最后执行 <code>ORDER BY</code>（在 <code>HAVING</code> 之后）</td>
</tr>
<tr>
<td><strong>常见用途</strong></td>
<td>统计、汇总数据（如计算每个分类的产品数量）</td>
<td>对查询结果按某列排序（如按价格从低到高排序）</td>
</tr>
</tbody></table>
<hr>
<p><strong>🛠 <code>GROUP BY</code> 示例</strong><br> <strong>统计每个产品类别的总销量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> category, <span class="built_in">SUM</span>(sales) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category;</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序</strong>：</p>
<ol>
<li><strong>先按 <code>category</code> 进行分组</strong></li>
<li><strong>对每个分组计算 <code>SUM(sales)</code></strong></li>
<li><strong>查询结果只有 <code>category</code> 和 <code>total_sales</code>，不会有原始行数据</strong></li>
</ol>
<p><strong>示例结果</strong></p>
<table>
<thead>
<tr>
<th>category</th>
<th>total_sales</th>
</tr>
</thead>
<tbody><tr>
<td>Toys</td>
<td>5000</td>
</tr>
<tr>
<td>Books</td>
<td>3200</td>
</tr>
<tr>
<td>Electronics</td>
<td>1200</td>
</tr>
</tbody></table>
<hr>
<p><strong>🛠 <code>ORDER BY</code> 示例</strong><br> <strong>查询所有产品，并按价格从高到低排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name, price</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> price <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序</strong>：</p>
<ol>
<li><strong>不分组，直接返回 <code>prod_name</code> 和 <code>price</code></strong></li>
<li><strong>按照 <code>price</code> 从高到低排序</strong></li>
</ol>
<p><strong>示例结果</strong></p>
<table>
<thead>
<tr>
<th>prod_name</th>
<th>price</th>
</tr>
</thead>
<tbody><tr>
<td>Laptop</td>
<td>1200</td>
</tr>
<tr>
<td>Tablet</td>
<td>500</td>
</tr>
<tr>
<td>Book</td>
<td>20</td>
</tr>
</tbody></table>
<hr>
<p><strong>🛠<code>GROUP BY</code> + <code>ORDER BY</code> 结合使用</strong><br> <strong>统计每个产品类别的总销量，并按销量降序排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> category, <span class="built_in">SUM</span>(sales) <span class="keyword">AS</span> total_sales</span><br><span class="line"><span class="keyword">FROM</span> Products</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> category</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> total_sales <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序</strong>：</p>
<ol>
<li><strong><code>GROUP BY category</code></strong>：先按 <code>category</code> 进行分组</li>
<li><strong><code>SUM(sales)</code></strong>：计算每个分类的总销量</li>
<li><strong><code>ORDER BY total_sales DESC</code></strong>：按 <code>total_sales</code> 由高到低排序</li>
</ol>
<p><strong>示例结果</strong></p>
<table>
<thead>
<tr>
<th>category</th>
<th>total_sales</th>
</tr>
</thead>
<tbody><tr>
<td>Toys</td>
<td>5000</td>
</tr>
<tr>
<td>Books</td>
<td>3200</td>
</tr>
<tr>
<td>Electronics</td>
<td>1200</td>
</tr>
</tbody></table>
<hr>
<p><strong>⏳ 总结</strong></p>
<table>
<thead>
<tr>
<th><strong>使用场景</strong></th>
<th><strong>GROUP BY</strong></th>
<th><strong>ORDER BY</strong></th>
</tr>
</thead>
<tbody><tr>
<td>统计数据</td>
<td>需要</td>
<td>❌ 不需要</td>
</tr>
<tr>
<td>改变数据行数</td>
<td>会减少行数（聚合）</td>
<td>❌ 不影响行数</td>
</tr>
<tr>
<td>排序数据</td>
<td>❌ 不能排序</td>
<td>可以排序</td>
</tr>
<tr>
<td>结合聚合函数</td>
<td>必须结合</td>
<td>❌ 不需要</td>
</tr>
</tbody></table>
<ul>
<li><strong><code>GROUP BY</code> 是用来分组和统计数据</strong>（通常和聚合函数 <code>SUM()</code>、<code>COUNT()</code> 搭配）。</li>
<li><strong><code>ORDER BY</code> 是用来排序数据</strong>（不会影响行数）。</li>
</ul>
<h1 id="11-22-子查询"><a href="#11-22-子查询" class="headerlink" title="11&#x2F;22 子查询"></a>11&#x2F;22 子查询</h1><h2 id="什么是子查询（Subquery）？"><a href="#什么是子查询（Subquery）？" class="headerlink" title="什么是子查询（Subquery）？"></a><strong>什么是子查询（Subquery）？</strong></h2><p>子查询（Subquery）是在<strong>另一个 SQL 查询中嵌套的查询</strong>，用于获取数据并作为外部查询（主查询）的条件或结果。</p>
<p>子查询通常用于：</p>
<ol>
<li><strong>筛选数据</strong>（<code>WHERE</code>、<code>HAVING</code>）</li>
<li><strong>计算聚合值</strong>（<code>SELECT</code>）</li>
<li><strong>检查数据是否存在</strong>（<code>EXISTS</code>）</li>
<li><strong>与 <code>IN</code>、<code>NOT IN</code> 结合使用</strong></li>
</ol>
<hr>
<h2 id="基本子查询：在-WHERE-语句中使用"><a href="#基本子查询：在-WHERE-语句中使用" class="headerlink" title="基本子查询：在 WHERE 语句中使用"></a><strong>基本子查询：在 <code>WHERE</code> 语句中使用</strong></h2><p> <strong>获取下单客户的详细信息</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">WHERE</span> cust_id <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> cust_id <span class="keyword">FROM</span> Orders</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>执行顺序</strong>：</p>
<ol>
<li><strong>子查询</strong>：先从 <code>Orders</code> 表中找出所有下过订单的 <code>cust_id</code></li>
<li><strong>外部查询</strong>：查找这些客户的完整信息</li>
</ol>
<p><strong>示例结果</strong></p>
<table>
<thead>
<tr>
<th>cust_id</th>
<th>cust_name</th>
<th>cust_address</th>
</tr>
</thead>
<tbody><tr>
<td>1001</td>
<td>Tom</td>
<td>123 Main St</td>
</tr>
<tr>
<td>1002</td>
<td>Alice</td>
<td>456 Oak Ave</td>
</tr>
</tbody></table>
<hr>
<h2 id="子查询替代-JOIN"><a href="#子查询替代-JOIN" class="headerlink" title="子查询替代 JOIN"></a><strong>子查询替代 <code>JOIN</code></strong></h2><p> <strong>查询订单金额大于 100 的订单编号</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WHERE</span> order_num <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> OrderItems</span><br><span class="line">    <span class="keyword">WHERE</span> quantity <span class="operator">*</span> item_price <span class="operator">&gt;</span> <span class="number">100</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>子查询计算</strong>：先计算每个 <code>order_num</code> 的总金额<br><strong>主查询过滤</strong>：只选出符合条件的 <code>order_num</code></p>
<hr>
<h2 id="HAVING-子查询"><a href="#HAVING-子查询" class="headerlink" title="HAVING 子查询"></a><strong><code>HAVING</code> 子查询</strong></h2><p> <strong>查询总订单金额超过 500 的客户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cust_id, <span class="built_in">SUM</span>(quantity <span class="operator">*</span> item_price) <span class="keyword">AS</span> total_spent</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">JOIN</span> OrderItems <span class="keyword">USING</span> (order_num)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> cust_id</span><br><span class="line"><span class="keyword">HAVING</span> total_spent <span class="operator">&gt;</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(quantity <span class="operator">*</span> item_price) <span class="keyword">FROM</span> OrderItems</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>子查询</strong>：计算 <code>OrderItems</code> 的平均订单金额<br><strong>外部查询</strong>：筛选订单金额大于平均值的客户</p>
<hr>
<h2 id="EXISTS-子查询"><a href="#EXISTS-子查询" class="headerlink" title="EXISTS 子查询"></a><strong><code>EXISTS</code> 子查询</strong></h2><p> <strong>查询至少有订单的客户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Customers C</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> Orders O <span class="keyword">WHERE</span> O.cust_id <span class="operator">=</span> C.cust_id</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>EXISTS</code> 只关心<strong>是否有数据</strong>，比 <code>IN</code> 更高效</p>
<hr>
<table>
<thead>
<tr>
<th>用法</th>
<th>适用场景</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td><code>WHERE</code> 子查询</td>
<td>过滤数据</td>
<td>订单总额 &gt; 100</td>
</tr>
<tr>
<td><code>JOIN</code> 替代子查询</td>
<td>查询多表数据</td>
<td>订单详情</td>
</tr>
<tr>
<td><code>HAVING</code> 子查询</td>
<td>过滤聚合结果</td>
<td>总支出 &gt; 平均值</td>
</tr>
<tr>
<td><code>EXISTS</code> 子查询</td>
<td>判断是否存在</td>
<td>订单是否存在</td>
</tr>
</tbody></table>
<h1 id="12-13-22-联结-JOIN"><a href="#12-13-22-联结-JOIN" class="headerlink" title="12&amp;13&#x2F;22 联结 JOIN"></a>12&amp;13&#x2F;22 联结 JOIN</h1><h2 id="为什么要创建-JOIN（联结）？"><a href="#为什么要创建-JOIN（联结）？" class="headerlink" title="为什么要创建 JOIN（联结）？"></a><strong>为什么要创建 JOIN（联结）？</strong></h2><p>在实际开发中，<strong>数据通常分布在多个表中</strong>，<strong>JOIN 的意义在于让数据“关联”起来</strong>，组合出有用的信息。  </p>
<p>💡 <strong>例如：</strong></p>
<ul>
<li><code>Orders</code> 表 <strong>存订单信息</strong></li>
<li><code>Customers</code> 表 <strong>存客户信息</strong></li>
<li><code>Products</code> 表 <strong>存商品信息</strong></li>
</ul>
<p><strong>如果我想知道</strong>：</p>
<ul>
<li><strong>某个订单属于哪个客户？</strong></li>
<li><strong>某个客户买了什么商品？</strong></li>
<li><strong>哪些商品卖得最多？</strong></li>
</ul>
<p><strong>就需要 JOIN，把这些表关联在一起！</strong></p>
<hr>
<h2 id="JOIN-会创建新的表吗？"><a href="#JOIN-会创建新的表吗？" class="headerlink" title="JOIN 会创建新的表吗？"></a><strong>JOIN 会创建新的表吗？</strong></h2><p><strong>JOIN 不会创建新的物理表</strong>，<strong>而是创建一个“临时结果集”</strong>（可以理解为<strong>虚拟表</strong>）。<br>❌ <strong>不会影响原始数据表</strong>，查询结束后，<strong>临时结果集就消失了</strong>。  </p>
<hr>
<h2 id="如何创建-JOIN（联结）？"><a href="#如何创建-JOIN（联结）？" class="headerlink" title="如何创建 JOIN（联结）？"></a><strong>如何创建 JOIN（联结）？</strong></h2><p><strong>SQL 的 <code>JOIN</code> 语句按照某个字段，把两张表连接起来！</strong></p>
<h3 id="示例：查询订单的客户信息"><a href="#示例：查询订单的客户信息" class="headerlink" title="示例：查询订单的客户信息"></a><strong>示例：查询订单的客户信息</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p> <strong>执行逻辑</strong>：</p>
<ol>
<li><code>Orders</code> <strong>表里的 <code>cust_id</code></strong>，<strong>与 <code>Customers</code> 表的 <code>cust_id</code> 进行匹配</strong></li>
<li>找到匹配项后，<strong>把数据合并成一个新的结果集</strong></li>
<li>结果只是<strong>临时的，不会影响数据库中的表</strong></li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>10001</td>
<td>Village Toys</td>
</tr>
<tr>
<td>10002</td>
<td>Kids Place</td>
</tr>
</tbody></table>
<hr>
<h2 id="JOIN-是-A-表引用-B-表的信息吗？"><a href="#JOIN-是-A-表引用-B-表的信息吗？" class="headerlink" title="JOIN 是 A 表引用 B 表的信息吗？"></a><strong>JOIN 是 A 表引用 B 表的信息吗？</strong></h2><p><strong>是的，但不是修改表，而是“临时关联”</strong>。<br><strong>A 表</strong> 里的 <code>cust_id</code> <strong>引用</strong> B 表里的 <code>cust_id</code>，但不会改动原表。<br>查询时，数据库会<strong>临时生成结果集</strong>，但这个结果<strong>不会永久存储</strong>。  </p>
<hr>
<h2 id="JOIN-会产生-C-表吗？"><a href="#JOIN-会产生-C-表吗？" class="headerlink" title="JOIN 会产生 C 表吗？"></a><strong>JOIN 会产生 C 表吗？</strong></h2><p><strong>JOIN 不会创建真实的 <code>C</code> 表</strong>，它生成的是<strong>临时结果集</strong>（可以看作“虚拟表”）。<br>❌ 这个结果集不会永久存储，查询结束后就消失。  </p>
<p>💡 <strong>如果想永久存储 JOIN 的结果</strong>，可以：</p>
<h3 id="方法：创建“新表”存储结果"><a href="#方法：创建“新表”存储结果" class="headerlink" title="方法：创建“新表”存储结果"></a><strong>方法：创建“新表”存储结果</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> OrderDetails <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p>这样 <code>OrderDetails</code> <strong>表就永久存储了 JOIN 的结果</strong>。</p>
<hr>
<h2 id="为什么需要-JOIN，外键不够用吗？"><a href="#为什么需要-JOIN，外键不够用吗？" class="headerlink" title="为什么需要 JOIN，外键不够用吗？"></a><strong>为什么需要 JOIN，外键不够用吗？</strong></h2><p><strong>外键</strong>（Foreign Key）只是<strong>建立表与表之间的关系</strong>，但是<strong>外键不能查询数据</strong>，所以我们还是需要 <code>JOIN</code> 来<strong>获取数据</strong>。  </p>
<p><strong>外键的作用</strong>：保证数据一致性，<strong>防止“无效数据”插入</strong><br><strong>JOIN 的作用</strong>：把多个表的<strong>数据关联起来，查询有用的信息</strong>  </p>
<hr>
<h2 id="自联结（Self-Join）"><a href="#自联结（Self-Join）" class="headerlink" title="自联结（Self-Join）"></a><strong>自联结（Self-Join）</strong></h2><p><strong>✔ 概念</strong>：<br><strong>表与自己进行联结</strong>，用于<strong>在同一个表中查找相关数据</strong>。  </p>
<p><strong>什么时候用？</strong>  </p>
<ul>
<li><strong>某个表存储层级数据（如员工管理）</strong>  </li>
<li><strong>找出“自己和自己有关的”数据</strong>（如查找同一家公司的合作伙伴）</li>
</ul>
<p><strong>示例：查找员工的上级</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e1.emp_name <span class="keyword">AS</span> Employee, e2.emp_name <span class="keyword">AS</span> Manager</span><br><span class="line"><span class="keyword">FROM</span> Employees e1</span><br><span class="line"><span class="keyword">JOIN</span> Employees e2 <span class="keyword">ON</span> e1.manager_id <span class="operator">=</span> e2.emp_id;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li><code>e1</code> 代表 <strong>员工</strong></li>
<li><code>e2</code> 代表 <strong>上级</strong></li>
<li>通过 <code>e1.manager_id = e2.emp_id</code> 让它们匹配</li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>Employee</th>
<th>Manager</th>
</tr>
</thead>
<tbody><tr>
<td>小张</td>
<td>王总</td>
</tr>
<tr>
<td>小李</td>
<td>王总</td>
</tr>
<tr>
<td>王总</td>
<td>CEO</td>
</tr>
</tbody></table>
<hr>
<h2 id="自然联结（Natural-Join）"><a href="#自然联结（Natural-Join）" class="headerlink" title="自然联结（Natural Join）"></a><strong>自然联结（Natural Join）</strong></h2><p><strong>✔ 概念</strong>：<br><strong>自动匹配相同的列名</strong>，并执行 <code>JOIN</code>。  </p>
<p><strong>特点</strong>：<br><strong>不需要指定 <code>ON</code> 条件</strong>，数据库会<strong>自动匹配相同的列</strong>。<br>❌ <strong>但如果匹配错了字段，可能会导致错误！</strong>  </p>
<p><strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> Customers;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li><strong>数据库会自动查找</strong> <code>Orders</code> 和 <code>Customers</code> 之间<strong>相同的列</strong></li>
<li><strong>执行 <code>JOIN</code></strong></li>
<li><strong>如果表中有多个相同的列名，可能会出错！</strong></li>
</ol>
<p>❌ <strong>所以 Natural Join 用得少，一般建议写明 <code>ON</code> 条件</strong>。</p>
<hr>
<h2 id="外联结（Outer-Join）"><a href="#外联结（Outer-Join）" class="headerlink" title="外联结（Outer Join）"></a><strong>外联结（Outer Join）</strong></h2><p><strong>✔ 概念</strong>：<br><strong>即使某一张表没有匹配的数据，也会保留另一张表的数据！</strong>  </p>
<ul>
<li><strong>左外联结（LEFT JOIN）</strong>：保留左表所有数据，即使右表没有匹配项。  </li>
<li><strong>右外联结（RIGHT JOIN）</strong>：保留右表所有数据，即使左表没有匹配项。  </li>
<li><strong>全外联结（FULL OUTER JOIN）</strong>：保留两张表所有数据（MySQL <strong>不支持</strong> 直接使用 <code>FULL OUTER JOIN</code>，需要 <code>UNION</code> 实现）。</li>
</ul>
<p><strong>示例 1：LEFT JOIN（左外联结）</strong><br><strong>查询所有客户，即使他们没有订单</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customers.cust_name, Orders.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders <span class="keyword">ON</span> Customers.cust_id <span class="operator">=</span> Orders.cust_id;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li><strong>显示所有 <code>Customers</code></strong></li>
<li><strong>即使某些客户没有下单，也会显示</strong></li>
<li><strong>如果 <code>Orders</code> 没有匹配数据，<code>order_num</code> 结果是 <code>NULL</code></strong></li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>Village Toys</td>
<td>10001</td>
</tr>
<tr>
<td>Kids Place</td>
<td>10002</td>
</tr>
<tr>
<td>Fun4All</td>
<td>NULL</td>
</tr>
</tbody></table>
<hr>
<p><strong>示例 2：RIGHT JOIN（右外联结）</strong><br><strong>查询所有订单，即使客户信息丢失</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p><strong>逻辑</strong>：</p>
<ol>
<li><strong>显示所有 <code>Orders</code></strong></li>
<li><strong>即使某些订单没有匹配到 <code>Customers</code></strong></li>
<li><strong>如果 <code>Customers</code> 没有匹配数据，<code>cust_name</code> 结果是 <code>NULL</code></strong></li>
</ol>
<hr>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>自联结（Self-Join）</strong></td>
<td><strong>表和自己联结</strong>，查找层级关系，如员工与经理</td>
</tr>
<tr>
<td><strong>自然联结（Natural Join）</strong></td>
<td><strong>自动匹配相同的列名</strong>，但可能匹配错字段</td>
</tr>
<tr>
<td><strong>左外联结（LEFT JOIN）</strong></td>
<td><strong>即使右表没有数据，左表的数据也保留</strong></td>
</tr>
<tr>
<td><strong>右外联结（RIGHT JOIN）</strong></td>
<td><strong>即使左表没有数据，右表的数据也保留</strong></td>
</tr>
<tr>
<td><strong>全外联结（FULL OUTER JOIN）</strong></td>
<td><strong>保留两张表所有数据（MySQL 不支持，需用 <code>UNION</code>）</strong></td>
</tr>
</tbody></table>
<h2 id="常见的-JOIN-类型"><a href="#常见的-JOIN-类型" class="headerlink" title="常见的 JOIN 类型"></a><strong>常见的 JOIN 类型</strong></h2><h3 id="INNER-JOIN（内连接）"><a href="#INNER-JOIN（内连接）" class="headerlink" title="INNER JOIN（内连接）"></a><strong>INNER JOIN（内连接）</strong></h3><p>🔹 <strong>仅返回</strong> 两个表中 <strong>都匹配的数据</strong>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>10001</td>
<td>Village Toys</td>
</tr>
<tr>
<td>10002</td>
<td>Kids Place</td>
</tr>
</tbody></table>
<p>💡 <strong>特点</strong>：<br>✅ 只有 <code>Orders</code> 和 <code>Customers</code> <strong>都存在匹配的 <code>cust_id</code></strong> 时，才会出现在结果里。<br>✅ <strong>没有匹配的数据</strong> 不会出现。  </p>
<hr>
<h3 id="LEFT-JOIN（左连接）"><a href="#LEFT-JOIN（左连接）" class="headerlink" title="LEFT JOIN（左连接）"></a><strong>LEFT JOIN（左连接）</strong></h3><p>🔹 <strong>返回左表的所有数据</strong>，如果右表没有匹配，则 <code>NULL</code>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>10001</td>
<td>Village Toys</td>
</tr>
<tr>
<td>10002</td>
<td>Kids Place</td>
</tr>
<tr>
<td>10003</td>
<td>NULL</td>
</tr>
</tbody></table>
<p>💡 <strong>特点</strong>：<br>✅ <strong><code>Orders</code> 表的数据全部保留</strong><br>✅ <code>Customers</code> <strong>没有匹配的数据就返回 <code>NULL</code></strong>  </p>
<hr>
<h3 id="RIGHT-JOIN（右连接）"><a href="#RIGHT-JOIN（右连接）" class="headerlink" title="RIGHT JOIN（右连接）"></a><strong>RIGHT JOIN（右连接）</strong></h3><p>🔹 <strong>返回右表的所有数据</strong>，如果左表没有匹配，则 <code>NULL</code>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong></p>
<table>
<thead>
<tr>
<th>order_num</th>
<th>cust_name</th>
</tr>
</thead>
<tbody><tr>
<td>10001</td>
<td>Village Toys</td>
</tr>
<tr>
<td>10002</td>
<td>Kids Place</td>
</tr>
<tr>
<td>NULL</td>
<td>Fun4All</td>
</tr>
</tbody></table>
<p>💡 <strong>特点</strong>：<br>✅ <strong><code>Customers</code> 表的数据全部保留</strong><br>✅ <code>Orders</code> <strong>没有匹配的数据就返回 <code>NULL</code></strong>  </p>
<hr>
<h3 id="FULL-JOIN（全连接）"><a href="#FULL-JOIN（全连接）" class="headerlink" title="FULL JOIN（全连接）"></a><strong>FULL JOIN（全连接）</strong></h3><p>🔹 <strong>返回左右两表的所有数据</strong>（但 MySQL 不支持 <code>FULL JOIN</code>，可用 <code>UNION</code> 代替）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> Orders.order_num, Customers.cust_name</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Customers <span class="keyword">ON</span> Orders.cust_id <span class="operator">=</span> Customers.cust_id;</span><br></pre></td></tr></table></figure>
<p>💡 <strong>特点</strong>：<br>✅ <strong>左表、右表的数据都会保留</strong><br>✅ <strong>没有匹配的部分用 <code>NULL</code> 填充</strong>  </p>
<hr>
<h3 id="自连接（SELF-JOIN）"><a href="#自连接（SELF-JOIN）" class="headerlink" title="自连接（SELF JOIN）"></a><strong>自连接（SELF JOIN）</strong></h3><p>🔹 <strong>表和自己连接</strong>，用于对比表中的数据  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.cust_name <span class="keyword">AS</span> customer1, B.cust_name <span class="keyword">AS</span> customer2</span><br><span class="line"><span class="keyword">FROM</span> Customers A, Customers B</span><br><span class="line"><span class="keyword">WHERE</span> A.cust_id <span class="operator">&lt;&gt;</span> B.cust_id;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong></p>
<table>
<thead>
<tr>
<th>customer1</th>
<th>customer2</th>
</tr>
</thead>
<tbody><tr>
<td>Village Toys</td>
<td>Kids Place</td>
</tr>
<tr>
<td>Village Toys</td>
<td>Fun4All</td>
</tr>
</tbody></table>
<p>💡 <strong>特点</strong>：<br>✅ <strong>用于查找相似数据、对比数据</strong><br>✅ <strong>通过 <code>A</code> 和 <code>B</code> 让同一个表像两个表一样使用</strong>  </p>
<hr>
<h3 id="交叉连接（CROSS-JOIN）"><a href="#交叉连接（CROSS-JOIN）" class="headerlink" title="交叉连接（CROSS JOIN）"></a><strong>交叉连接（CROSS JOIN）</strong></h3><p>🔹 <strong>每一行匹配另一张表的所有行</strong>（笛卡尔积）  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Customers.cust_name, Orders.order_num</span><br><span class="line"><span class="keyword">FROM</span> Customers</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> Orders;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>order_num</th>
</tr>
</thead>
<tbody><tr>
<td>Village Toys</td>
<td>10001</td>
</tr>
<tr>
<td>Village Toys</td>
<td>10002</td>
</tr>
<tr>
<td>Kids Place</td>
<td>10001</td>
</tr>
<tr>
<td>Kids Place</td>
<td>10002</td>
</tr>
</tbody></table>
<p>💡 <strong>特点</strong>：<br>✅ <strong>所有可能的组合都会出现</strong><br>✅ <strong>通常不会直接用，而是配合 <code>ON</code> 进行过滤</strong>  </p>
<hr>
<table>
<thead>
<tr>
<th>JOIN 类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>INNER JOIN</code></td>
<td><strong>匹配的行</strong>（左右表都有匹配时才返回） ✅</td>
</tr>
<tr>
<td><code>LEFT JOIN</code></td>
<td><strong>左表全部 + 右表匹配的</strong>（右表没匹配返回 NULL） ✅</td>
</tr>
<tr>
<td><code>RIGHT JOIN</code></td>
<td><strong>右表全部 + 左表匹配的</strong>（左表没匹配返回 NULL） ✅</td>
</tr>
<tr>
<td><code>FULL JOIN</code></td>
<td><strong>两表全部数据</strong>（不支持，用 <code>UNION</code> 实现） ✅</td>
</tr>
<tr>
<td><code>SELF JOIN</code></td>
<td><strong>自己和自己 JOIN</strong>（用于对比） ✅</td>
</tr>
<tr>
<td><code>CROSS JOIN</code></td>
<td><strong>所有可能的组合（笛卡尔积）</strong> 🚀</td>
</tr>
</tbody></table>
<h2 id="带聚集函数的联结（JOIN-聚合函数）"><a href="#带聚集函数的联结（JOIN-聚合函数）" class="headerlink" title="带聚集函数的联结（JOIN + 聚合函数）"></a><strong>带聚集函数的联结（JOIN + 聚合函数）</strong></h2><p>🚀 <strong>在联结（JOIN）查询的基础上，结合聚合函数（SUM、AVG、COUNT 等）来进行统计分析。</strong>  </p>
<ul>
<li><code>JOIN</code> 负责<strong>连接多张表</strong>  </li>
<li><strong>聚合函数</strong> 负责<strong>统计数据</strong></li>
</ul>
<h3 id="示例-1：计算每个客户的订单总金额"><a href="#示例-1：计算每个客户的订单总金额" class="headerlink" title="示例 1：计算每个客户的订单总金额"></a><strong>示例 1：计算每个客户的订单总金额</strong></h3><p><strong>需求</strong>：查询每个客户的 <code>cust_name</code> 及其订单总金额（<code>total_price</code>）。<br>💡 <strong>使用 <code>SUM()</code> 聚合每个客户的订单金额</strong>  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.cust_name, <span class="built_in">SUM</span>(oi.total_price) <span class="keyword">AS</span> total_spent</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">JOIN</span> Orders o <span class="keyword">ON</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line"><span class="keyword">JOIN</span> OrderItems oi <span class="keyword">ON</span> o.order_num <span class="operator">=</span> oi.order_num</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.cust_name;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>逻辑</strong>：</p>
<ol>
<li><strong><code>Customers</code> 表</strong> 提供 <code>cust_name</code></li>
<li><strong><code>Orders</code> 表</strong> 提供 <code>order_num</code>（订单编号）</li>
<li><strong><code>OrderItems</code> 表</strong> 提供 <code>total_price</code>（订单明细的金额）</li>
<li><strong><code>SUM(oi.total_price)</code></strong> 计算每个客户的订单总金额</li>
<li><strong><code>GROUP BY c.cust_name</code></strong> 确保按客户进行分组统计</li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>total_spent</th>
</tr>
</thead>
<tbody><tr>
<td>Village Toys</td>
<td>500.00</td>
</tr>
<tr>
<td>Kids Place</td>
<td>300.00</td>
</tr>
<tr>
<td>Fun4All</td>
<td>150.00</td>
</tr>
</tbody></table>
<hr>
<h3 id="示例-2：计算每个供应商（Vendor）的产品数量"><a href="#示例-2：计算每个供应商（Vendor）的产品数量" class="headerlink" title="示例 2：计算每个供应商（Vendor）的产品数量"></a><strong>示例 2：计算每个供应商（Vendor）的产品数量</strong></h3><p><strong>需求</strong>：查询每个供应商的 <code>vend_name</code> 及其提供的产品数量<br>💡 <strong>使用 <code>COUNT()</code> 统计产品数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> v.vend_name, <span class="built_in">COUNT</span>(p.prod_id) <span class="keyword">AS</span> product_count</span><br><span class="line"><span class="keyword">FROM</span> Vendors v</span><br><span class="line"><span class="keyword">JOIN</span> Products p <span class="keyword">ON</span> v.vend_id <span class="operator">=</span> p.vend_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> v.vend_name;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>逻辑</strong>：</p>
<ol>
<li><strong><code>Vendors</code> 表</strong> 提供 <code>vend_name</code></li>
<li><strong><code>Products</code> 表</strong> 提供 <code>prod_id</code></li>
<li><strong><code>COUNT(p.prod_id)</code></strong> 计算该供应商提供的产品数量</li>
<li><strong><code>GROUP BY v.vend_name</code></strong> 按供应商分组</li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>vend_name</th>
<th>product_count</th>
</tr>
</thead>
<tbody><tr>
<td>Bear Emporium</td>
<td>5</td>
</tr>
<tr>
<td>Doll House Inc.</td>
<td>3</td>
</tr>
</tbody></table>
<hr>
<h3 id="示例-3：计算每个客户下的订单数量"><a href="#示例-3：计算每个客户下的订单数量" class="headerlink" title="示例 3：计算每个客户下的订单数量"></a><strong>示例 3：计算每个客户下的订单数量</strong></h3><p><strong>需求</strong>：查询 <code>cust_name</code> 及其下的订单数量<br>💡 <strong>使用 <code>COUNT()</code> 统计订单数量</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c.cust_name, <span class="built_in">COUNT</span>(o.order_num) <span class="keyword">AS</span> order_count</span><br><span class="line"><span class="keyword">FROM</span> Customers c</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Orders o <span class="keyword">ON</span> c.cust_id <span class="operator">=</span> o.cust_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c.cust_name;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>逻辑</strong>：</p>
<ol>
<li><strong><code>Customers</code> 表</strong> 提供 <code>cust_name</code></li>
<li><strong><code>Orders</code> 表</strong> 提供 <code>order_num</code></li>
<li><strong><code>COUNT(o.order_num)</code></strong> 统计客户下的订单数</li>
<li><strong><code>LEFT JOIN</code></strong> 确保<strong>即使客户没有订单，也会显示</strong></li>
<li><strong><code>GROUP BY c.cust_name</code></strong> 按客户分组</li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>cust_name</th>
<th>order_count</th>
</tr>
</thead>
<tbody><tr>
<td>Village Toys</td>
<td>2</td>
</tr>
<tr>
<td>Kids Place</td>
<td>1</td>
</tr>
<tr>
<td>Fun4All</td>
<td>0</td>
</tr>
</tbody></table>
<hr>
<h3 id="示例-4：按供应商统计产品的平均价格"><a href="#示例-4：按供应商统计产品的平均价格" class="headerlink" title="示例 4：按供应商统计产品的平均价格"></a><strong>示例 4：按供应商统计产品的平均价格</strong></h3><p><strong>需求</strong>：查询 <code>vend_name</code> 及其提供的产品平均价格<br>💡 <strong>使用 <code>AVG()</code> 计算产品均价</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> v.vend_name, <span class="built_in">AVG</span>(p.prod_price) <span class="keyword">AS</span> avg_price</span><br><span class="line"><span class="keyword">FROM</span> Vendors v</span><br><span class="line"><span class="keyword">JOIN</span> Products p <span class="keyword">ON</span> v.vend_id <span class="operator">=</span> p.vend_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> v.vend_name;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>逻辑</strong>：</p>
<ol>
<li><strong><code>Vendors</code> 表</strong> 提供 <code>vend_name</code></li>
<li><strong><code>Products</code> 表</strong> 提供 <code>prod_price</code></li>
<li><strong><code>AVG(p.prod_price)</code></strong> 计算该供应商产品的平均价格</li>
<li><strong><code>GROUP BY v.vend_name</code></strong> 按供应商分组</li>
</ol>
<p><strong>查询结果</strong></p>
<table>
<thead>
<tr>
<th>vend_name</th>
<th>avg_price</th>
</tr>
</thead>
<tbody><tr>
<td>Bear Emporium</td>
<td>25.50</td>
</tr>
<tr>
<td>Doll House Inc.</td>
<td>30.75</td>
</tr>
</tbody></table>
<hr>
<p>✅ <strong><code>JOIN</code> 负责把多张表连接起来</strong><br>✅ <strong>聚合函数（SUM、COUNT、AVG）负责计算数据</strong><br>✅ <strong><code>GROUP BY</code> 让数据分组统计</strong><br>✅ <strong>使用 <code>LEFT JOIN</code> 可以保证数据完整性（即使没有匹配项）</strong>  </p>
<h1 id="14-22-组合查询-UNION"><a href="#14-22-组合查询-UNION" class="headerlink" title="14&#x2F;22 组合查询 UNION"></a>14&#x2F;22 组合查询 UNION</h1><h2 id="基本查询语句"><a href="#基本查询语句" class="headerlink" title="基本查询语句"></a><strong>基本查询语句</strong></h2><ul>
<li><code>SELECT</code>：基本查询语句</li>
<li><code>WHERE</code>：指定查询条件</li>
<li><code>ORDER BY</code>：排序</li>
<li><code>LIMIT</code>：限制返回行数</li>
</ul>
<hr>
<p>##<strong>联合查询（UNION &#x2F; UNION ALL）</strong></p>
<ul>
<li><code>UNION</code>：合并多个查询结果，去重</li>
<li><code>UNION ALL</code>：合并多个查询结果，不去重</li>
<li><strong>注意</strong>：<ul>
<li>多个查询的列数必须相同</li>
<li>列的数据类型必须兼容</li>
</ul>
</li>
</ul>
<p>   <strong>示例</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;HR&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="子查询（Subquery）"><a href="#子查询（Subquery）" class="headerlink" title="子查询（Subquery）"></a><strong>子查询（Subquery）</strong></h2><ul>
<li><strong>WHERE 语句中的子查询</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department_id <span class="operator">=</span> </span><br><span class="line">(<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span>);</span><br></pre></td></tr></table></figure></li>
<li><strong>SELECT 语句中的子查询</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, (<span class="keyword">SELECT</span> dept_name <span class="keyword">FROM</span> departments <span class="keyword">WHERE</span> id <span class="operator">=</span> employees.department_id) <span class="keyword">AS</span> dept_name</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure></li>
<li><strong>EXISTS 子查询</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="number">1</span> <span class="keyword">FROM</span> departments d <span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.id);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="多表查询（JOIN）"><a href="#多表查询（JOIN）" class="headerlink" title="多表查询（JOIN）"></a><strong>多表查询（JOIN）</strong></h2><ul>
<li><code>INNER JOIN</code>（内连接）：匹配两个表中都存在的数据</li>
<li><code>LEFT JOIN</code>（左连接）：以左表为主，匹配右表数据，不匹配的显示 <code>NULL</code></li>
<li><code>RIGHT JOIN</code>（右连接）：以右表为主，匹配左表数据</li>
<li><code>FULL JOIN</code>（MySQL 不支持，可用 <code>UNION</code> 代替）</li>
</ul>
<p>   <strong>示例</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.name, d.name </span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.id;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="使用-INTERSECT-和-EXCEPT（MySQL-不支持，可用-JOIN-和-NOT-IN-替代）"><a href="#使用-INTERSECT-和-EXCEPT（MySQL-不支持，可用-JOIN-和-NOT-IN-替代）" class="headerlink" title="使用 INTERSECT 和 EXCEPT（MySQL 不支持，可用 JOIN 和 NOT IN 替代）"></a><strong>使用 <code>INTERSECT</code> 和 <code>EXCEPT</code>（MySQL 不支持，可用 <code>JOIN</code> 和 <code>NOT IN</code> 替代）</strong></h2><ul>
<li><code>INTERSECT</code>（交集）：MySQL 不支持，可使用 <code>INNER JOIN</code> 实现</li>
<li><code>EXCEPT</code>（差集）：MySQL 不支持，可使用 <code>NOT IN</code> 或 <code>LEFT JOIN</code> 解决</li>
</ul>
<p>   <strong>示例（INTERSECT 替代）</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;HR&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<p>   <strong>示例（EXCEPT 替代）</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;HR&#x27;</span>);</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="组合过滤（AND、OR）"><a href="#组合过滤（AND、OR）" class="headerlink" title="组合过滤（AND、OR）"></a><strong>组合过滤（AND、OR）</strong></h2><ul>
<li><code>AND</code>：多个条件同时满足</li>
<li><code>OR</code>：满足任意一个条件即可</li>
<li><code>NOT</code>：取反</li>
</ul>
<p>   <strong>示例</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees </span><br><span class="line"><span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span> <span class="keyword">AND</span> salary <span class="operator">&gt;</span> <span class="number">5000</span>;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="GROUP-BY-和-HAVING"><a href="#GROUP-BY-和-HAVING" class="headerlink" title="GROUP BY 和 HAVING"></a><strong>GROUP BY 和 HAVING</strong></h2><ul>
<li><code>GROUP BY</code>：对结果进行分组</li>
<li><code>HAVING</code>：对分组后的数据进行筛选（类似 <code>WHERE</code>）</li>
</ul>
<p>   <strong>示例</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> employee_count</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="WITH（公用表表达式，CTE）"><a href="#WITH（公用表表达式，CTE）" class="headerlink" title="WITH（公用表表达式，CTE）"></a><strong>WITH（公用表表达式，CTE）</strong></h2><ul>
<li>提高查询的可读性，避免嵌套查询</li>
</ul>
<p>   <strong>示例</strong>：<br>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> high_salary <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> <span class="number">5000</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> high_salary <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;IT&#x27;</span>;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>学习 MySQL 组合查询，建议掌握：</p>
<ol>
<li><code>UNION</code> &#x2F; <code>UNION ALL</code>（合并查询结果）</li>
<li><code>JOIN</code>（多表查询）</li>
<li>子查询（嵌套查询）</li>
<li>交集 &#x2F; 差集（用 <code>JOIN</code> 或 <code>NOT IN</code> 代替）</li>
<li>逻辑运算符（<code>AND</code>、<code>OR</code>、<code>NOT</code>）</li>
<li><code>GROUP BY</code> + <code>HAVING</code>（分组查询）</li>
<li><code>WITH</code>（公用表表达式）</li>
</ol>
<h2 id="优化查询（Query-Optimization）"><a href="#优化查询（Query-Optimization）" class="headerlink" title="优化查询（Query Optimization）"></a>优化查询（Query Optimization）</h2><p>是指通过调整 SQL 语句的结构、使用索引、减少不必要的计算等方式，提高数据库查询的执行效率。<br>在 A&#x2F;B 测试（AB Test）场景下，通常涉及大规模数据的过滤、分组、计算和统计分析，因此优化查询可以显著提升数据处理速度。  </p>
<hr>
<h3 id="优化查询的关键技术"><a href="#优化查询的关键技术" class="headerlink" title="优化查询的关键技术"></a><strong>优化查询的关键技术</strong></h3><h4 id="使用索引（Index）"><a href="#使用索引（Index）" class="headerlink" title="使用索引（Index）"></a><strong>使用索引（Index）</strong></h4><p>索引可以加快数据检索速度，特别是在 <strong>WHERE、JOIN、GROUP BY、ORDER BY</strong> 中使用的列。<br> <strong>如何检查索引？</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> user_events;</span><br></pre></td></tr></table></figure>
<p> <strong>如何创建索引？</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_id <span class="keyword">ON</span> user_events(user_id);</span><br></pre></td></tr></table></figure>
<p><strong>索引适用于：</strong></p>
<ul>
<li><code>WHERE</code> 查询</li>
<li><code>JOIN</code> 操作</li>
<li><code>ORDER BY</code> 排序</li>
<li><code>GROUP BY</code> 统计</li>
</ul>
<hr>
<h4 id="避免-SELECT-，只查询需要的列"><a href="#避免-SELECT-，只查询需要的列" class="headerlink" title="*避免 SELECT ，只查询需要的列"></a>*<em>避免 SELECT <em>，只查询需要的列</em></em></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐 ❌</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_type <span class="operator">=</span> <span class="string">&#x27;purchase&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐 ✅</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, <span class="type">timestamp</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_type <span class="operator">=</span> <span class="string">&#x27;purchase&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：</p>
<ul>
<li><code>SELECT *</code> 会扫描所有列，增加不必要的数据传输和计算。</li>
</ul>
<hr>
<h4 id="使用-EXPLAIN-分析查询"><a href="#使用-EXPLAIN-分析查询" class="headerlink" title="使用 EXPLAIN 分析查询"></a><strong>使用 EXPLAIN 分析查询</strong></h4><p>在执行查询前，可以使用 <code>EXPLAIN</code> 了解查询执行计划：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> user_id <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_type <span class="operator">=</span> <span class="string">&#x27;purchase&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>关注重点</strong>：</p>
<ul>
<li><code>type</code>: <strong>应尽量是 <code>index</code> 或 <code>ref</code>，避免 <code>ALL</code>（全表扫描）</strong></li>
<li><code>possible_keys</code>: <strong>建议使用索引</strong></li>
<li><code>rows</code>: <strong>越少越好（减少扫描行数）</strong></li>
</ul>
<hr>
<h4 id="避免-OR，使用-UNION-ALL-或-IN"><a href="#避免-OR，使用-UNION-ALL-或-IN" class="headerlink" title="避免 OR，使用 UNION ALL 或 IN"></a><strong>避免 <code>OR</code>，使用 <code>UNION ALL</code> 或 <code>IN</code></strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐 ❌</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_type <span class="operator">=</span> <span class="string">&#x27;click&#x27;</span> <span class="keyword">OR</span> event_type <span class="operator">=</span> <span class="string">&#x27;purchase&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐 ✅</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_type <span class="keyword">IN</span> (<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;purchase&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：</p>
<ul>
<li><code>OR</code> 可能导致索引失效，数据库可能会执行全表扫描。</li>
</ul>
<hr>
<h4 id="避免-LIKE-xxx-，改用-FULLTEXT-或索引"><a href="#避免-LIKE-xxx-，改用-FULLTEXT-或索引" class="headerlink" title="避免 LIKE &#39;%xxx%&#39;，改用 FULLTEXT 或索引"></a><strong>避免 <code>LIKE &#39;%xxx%&#39;</code>，改用 FULLTEXT 或索引</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐 ❌</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> event_name <span class="keyword">LIKE</span> <span class="string">&#x27;%checkout%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐 ✅（使用全文索引）</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> user_events <span class="keyword">ADD</span> FULLTEXT INDEX idx_event_name (event_name);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(event_name) AGAINST (<span class="string">&#x27;checkout&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：</p>
<ul>
<li><code>LIKE &#39;%xxx%&#39;</code> 无法使用索引，而 <code>FULLTEXT</code> 索引可以大幅提升查询速度。</li>
</ul>
<hr>
<h4 id="避免-HAVING-过滤，改用-WHERE"><a href="#避免-HAVING-过滤，改用-WHERE" class="headerlink" title="避免 HAVING 过滤，改用 WHERE"></a><strong>避免 <code>HAVING</code> 过滤，改用 <code>WHERE</code></strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐 ❌</span></span><br><span class="line"><span class="keyword">SELECT</span> event_type, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> user_events</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐 ✅</span></span><br><span class="line"><span class="keyword">SELECT</span> event_type, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> user_events</span><br><span class="line"><span class="keyword">WHERE</span> event_type <span class="keyword">IN</span> (<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;purchase&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> event_type</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：</p>
<ul>
<li><code>HAVING</code> 过滤是在<strong>分组后</strong>执行，效率低</li>
<li><code>WHERE</code> 过滤是在<strong>分组前</strong>执行，减少计算量</li>
</ul>
<hr>
<h4 id="限制数据扫描量（分页优化）"><a href="#限制数据扫描量（分页优化）" class="headerlink" title="限制数据扫描量（分页优化）"></a><strong>限制数据扫描量（分页优化）</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不推荐 ❌</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">timestamp</span> LIMIT <span class="number">100000</span>, <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐 ✅（使用索引 + 子查询）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_events </span><br><span class="line"><span class="keyword">WHERE</span> id <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> user_events <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="type">timestamp</span> LIMIT <span class="number">100000</span>, <span class="number">1</span>)</span><br><span class="line">LIMIT <span class="number">50</span>;</span><br></pre></td></tr></table></figure>
<p><strong>原因</strong>：</p>
<ul>
<li><code>LIMIT 100000, 50</code> 仍然会扫描前 100000 行，计算成本高。</li>
</ul>
<hr>
<h3 id="A-B-测试查询优化示例"><a href="#A-B-测试查询优化示例" class="headerlink" title="A&#x2F;B 测试查询优化示例"></a><strong>A&#x2F;B 测试查询优化示例</strong></h3><h4 id="查询-A-B-组的转化率"><a href="#查询-A-B-组的转化率" class="headerlink" title="查询 A&#x2F;B 组的转化率"></a><strong>查询 A&#x2F;B 组的转化率</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> test_group, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">AS</span> users,</span><br><span class="line">       <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> event_type <span class="operator">=</span> <span class="string">&#x27;purchase&#x27;</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">AS</span> conversion_rate</span><br><span class="line"><span class="keyword">FROM</span> user_events</span><br><span class="line"><span class="keyword">WHERE</span> test_group <span class="keyword">IN</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> test_group;</span><br></pre></td></tr></table></figure>
<p><strong>优化点</strong>：</p>
<ul>
<li><code>test_group</code> 建立索引：<code>CREATE INDEX idx_test_group ON user_events(test_group);</code></li>
<li><code>event_type</code> 使用 <code>CASE WHEN</code> 计算，避免 <code>JOIN</code></li>
</ul>
<hr>
<h4 id="分析用户留存"><a href="#分析用户留存" class="headerlink" title="分析用户留存"></a><strong>分析用户留存</strong></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> test_group, <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">AS</span> total_users,</span><br><span class="line">       <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">CASE</span> <span class="keyword">WHEN</span> DATEDIFF(event_date, first_login) <span class="operator">=</span> <span class="number">1</span> <span class="keyword">THEN</span> user_id <span class="keyword">END</span>) <span class="keyword">AS</span> day_1_retention</span><br><span class="line"><span class="keyword">FROM</span> user_events</span><br><span class="line"><span class="keyword">JOIN</span> user_info <span class="keyword">ON</span> user_events.user_id <span class="operator">=</span> user_info.user_id</span><br><span class="line"><span class="keyword">WHERE</span> test_group <span class="keyword">IN</span> (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> test_group;</span><br></pre></td></tr></table></figure>
<p><strong>优化点</strong>：</p>
<ul>
<li><code>JOIN</code> 语句优化：确保 <code>user_id</code> 建立索引 <code>CREATE INDEX idx_user_id ON user_events(user_id);</code></li>
<li><code>DATEDIFF</code> 计算可能影响索引，可改为 <strong>BETWEEN</strong>：<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event_date <span class="keyword">BETWEEN</span> DATE_ADD(first_login, <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">DAY</span>) <span class="keyword">AND</span> DATE_ADD(first_login, <span class="type">INTERVAL</span> <span class="number">2</span> <span class="keyword">DAY</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<p><strong>关键优化策略</strong>：<br>✅ <strong>索引优化</strong>：WHERE、JOIN、GROUP BY、ORDER BY 列上加索引<br>✅ <strong>减少扫描</strong>：避免 <code>SELECT *</code>，使用 <code>LIMIT</code> + 子查询<br>✅ <strong>避免索引失效</strong>：避免 <code>LIKE &#39;%xxx%&#39;</code>，用 <code>FULLTEXT</code>，避免 <code>OR</code><br>✅ <strong>分组优化</strong>：<code>HAVING</code> 改 <code>WHERE</code>，减少数据量  </p>
<h1 id="15-22-插入数据-INSERT"><a href="#15-22-插入数据-INSERT" class="headerlink" title="15&#x2F;22 插入数据 INSERT"></a>15&#x2F;22 插入数据 INSERT</h1><p>在 MySQL 中，数据插入和从一个表复制到另一个表的插入主要有以下几种方式：</p>
<hr>
<h2 id="基本数据插入-INSERT-INTO"><a href="#基本数据插入-INSERT-INTO" class="headerlink" title="基本数据插入 (INSERT INTO)"></a><strong>基本数据插入 (<code>INSERT INTO</code>)</strong></h2><p>用于将单行或多行数据插入到表中。</p>
<h3 id="插入单行数据"><a href="#插入单行数据" class="headerlink" title="插入单行数据"></a><strong>插入单行数据</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name, age) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">25</span>);</span><br></pre></td></tr></table></figure>

<h3 id="插入多行数据"><a href="#插入多行数据" class="headerlink" title="插入多行数据"></a><strong>插入多行数据</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name, age) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Bob&#x27;</span>, <span class="number">30</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Charlie&#x27;</span>, <span class="number">28</span>);</span><br></pre></td></tr></table></figure>

<h3 id="插入部分字段"><a href="#插入部分字段" class="headerlink" title="插入部分字段"></a><strong>插入部分字段</strong></h3><p>如果某些字段有默认值，可以省略：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (name, age) <span class="keyword">VALUES</span> (<span class="string">&#x27;David&#x27;</span>, <span class="number">22</span>);</span><br></pre></td></tr></table></figure>
<p>省略 <code>id</code>，假设 <code>id</code> 是 <code>AUTO_INCREMENT</code>。</p>
<hr>
<h2 id="从一个表复制到另一个表-INSERT-INTO-SELECT"><a href="#从一个表复制到另一个表-INSERT-INTO-SELECT" class="headerlink" title="从一个表复制到另一个表 (INSERT INTO ... SELECT)"></a><strong>从一个表复制到另一个表 (<code>INSERT INTO ... SELECT</code>)</strong></h2><p>用于将一张表的数据复制到另一张表，适用于 A&#x2F;B 测试场景中的数据备份或数据迁移。</p>
<h3 id="复制所有字段"><a href="#复制所有字段" class="headerlink" title="复制所有字段"></a><strong>复制所有字段</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users_backup <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<p> <strong>注意</strong>：<code>users_backup</code> 的表结构必须与 <code>users</code> <strong>完全一致</strong>。</p>
<h3 id="复制部分字段"><a href="#复制部分字段" class="headerlink" title="复制部分字段"></a><strong>复制部分字段</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users_backup (id, name, age)</span><br><span class="line"><span class="keyword">SELECT</span> id, name, age <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>适用于数据筛选后再复制</strong>。</p>
<h3 id="复制时修改数据"><a href="#复制时修改数据" class="headerlink" title="复制时修改数据"></a><strong>复制时修改数据</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users_backup (id, name, age)</span><br><span class="line"><span class="keyword">SELECT</span> id, CONCAT(name, <span class="string">&#x27; (backup)&#x27;</span>), age <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<p> <strong>可以在 <code>SELECT</code> 中修改数据，如 <code>CONCAT()</code> 拼接文本</strong>。</p>
<hr>
<h2 id="REPLACE-INTO（插入或更新）"><a href="#REPLACE-INTO（插入或更新）" class="headerlink" title="REPLACE INTO（插入或更新）"></a><strong><code>REPLACE INTO</code>（插入或更新）</strong></h2><p>如果主键或唯一索引冲突，<code>REPLACE INTO</code> 先删除旧数据，再插入新数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REPLACE <span class="keyword">INTO</span> users (id, name, age) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">26</span>);</span><br></pre></td></tr></table></figure>
<p> <strong>适用于需要覆盖旧数据的场景，但会有删除+插入的开销</strong>。</p>
<hr>
<h2 id="INSERT-ON-DUPLICATE-KEY-UPDATE（冲突时更新）"><a href="#INSERT-ON-DUPLICATE-KEY-UPDATE（冲突时更新）" class="headerlink" title="INSERT ... ON DUPLICATE KEY UPDATE（冲突时更新）"></a><strong><code>INSERT ... ON DUPLICATE KEY UPDATE</code>（冲突时更新）</strong></h2><p><strong>如果主键冲突，则更新数据，而不是删除再插入。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name, age)</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">26</span>)</span><br><span class="line"><span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> age <span class="operator">=</span> <span class="keyword">VALUES</span>(age);</span><br></pre></td></tr></table></figure>
<p> <strong>适用于 ID 唯一的情况，遇到重复 ID 时只更新 <code>age</code></strong>。</p>
<hr>
<p>🔹 <strong><code>INSERT INTO VALUES</code></strong>：标准插入方式<br>🔹 <strong><code>INSERT INTO SELECT</code></strong>：复制数据到另一个表<br>🔹 <strong><code>REPLACE INTO</code></strong>：有则替换，无则插入<br>🔹 <strong><code>INSERT ... ON DUPLICATE KEY UPDATE</code></strong>：遇到冲突时更新数据  </p>
<p> <strong>在 A&#x2F;B 测试场景下</strong>，可以使用 <code>INSERT INTO ... SELECT</code> 来备份测试数据，或使用 <code>ON DUPLICATE KEY UPDATE</code> 来更新测试用户信息。</p>
<h1 id="16-22-更新删除-UPDATE-DELETE"><a href="#16-22-更新删除-UPDATE-DELETE" class="headerlink" title="16&#x2F;22 更新删除 UPDATE &amp; DELETE"></a>16&#x2F;22 更新删除 UPDATE &amp; DELETE</h1><p>在 MySQL 中，<code>UPDATE</code> 和 <code>DELETE</code> 是用于修改和删除数据的关键语句。在 A&#x2F;B 测试（AB Test）或日常数据库操作中，这两种语句都非常重要，比如更新实验用户的分组、清理无效数据等。  </p>
<hr>
<h2 id="UPDATE-语句（更新数据）"><a href="#UPDATE-语句（更新数据）" class="headerlink" title="UPDATE 语句（更新数据）"></a><strong><code>UPDATE</code> 语句（更新数据）</strong></h2><p>用于修改表中的数据，可基于 <code>WHERE</code> 条件更新指定的行。</p>
<h3 id="更新单个字段"><a href="#更新单个字段" class="headerlink" title="更新单个字段"></a><strong>更新单个字段</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">30</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>id=1</code> 的用户年龄改为 <code>30</code>。</p>
<hr>
<h3 id="更新多个字段"><a href="#更新多个字段" class="headerlink" title="更新多个字段"></a><strong>更新多个字段</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> age <span class="operator">=</span> <span class="number">30</span>, name <span class="operator">=</span> <span class="string">&#x27;Alice Cooper&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：同时修改 <code>age</code> 和 <code>name</code>。</p>
<hr>
<h3 id="条件更新（避免误更新所有数据）"><a href="#条件更新（避免误更新所有数据）" class="headerlink" title="条件更新（避免误更新所有数据）"></a><strong>条件更新（避免误更新所有数据）</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> test_group <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span> <span class="keyword">WHERE</span> test_group <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&gt;</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>test_group=&#39;A&#39;</code> 且 <code>age&gt;25</code> 的用户改为 <code>B</code>。</p>
<p>❌ <strong>危险操作</strong>（没有 <code>WHERE</code> 会更新所有行！）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users <span class="keyword">SET</span> test_group <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>; <span class="comment">-- ⚠️ 误操作，所有用户都会变成 B 组</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="使用-CASE-WHEN-进行批量更新"><a href="#使用-CASE-WHEN-进行批量更新" class="headerlink" title="使用 CASE WHEN 进行批量更新"></a><strong>使用 <code>CASE WHEN</code> 进行批量更新</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users </span><br><span class="line"><span class="keyword">SET</span> test_group <span class="operator">=</span> <span class="keyword">CASE</span> </span><br><span class="line">    <span class="keyword">WHEN</span> age <span class="operator">&lt;</span> <span class="number">25</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line">    <span class="keyword">WHEN</span> age <span class="keyword">BETWEEN</span> <span class="number">25</span> <span class="keyword">AND</span> <span class="number">30</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：根据 <code>age</code> 条件批量更新 <code>test_group</code>。</p>
<hr>
<h3 id="结合-JOIN-更新数据"><a href="#结合-JOIN-更新数据" class="headerlink" title="结合 JOIN 更新数据"></a><strong>结合 <code>JOIN</code> 更新数据</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> test_results t <span class="keyword">ON</span> u.id <span class="operator">=</span> t.user_id</span><br><span class="line"><span class="keyword">SET</span> u.test_group <span class="operator">=</span> <span class="string">&#x27;Completed&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> t.test_result <span class="operator">=</span> <span class="string">&#x27;success&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：如果 <code>test_results</code> 表中的 <code>test_result=&#39;success&#39;</code>，则更新 <code>users</code> 表的 <code>test_group</code>。</p>
<hr>
<h2 id="DELETE-语句（删除数据）"><a href="#DELETE-语句（删除数据）" class="headerlink" title="DELETE 语句（删除数据）"></a><strong><code>DELETE</code> 语句（删除数据）</strong></h2><p>用于删除表中的数据。</p>
<h3 id="删除指定行"><a href="#删除指定行" class="headerlink" title="删除指定行"></a><strong>删除指定行</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>id=1</code> 的用户。</p>
<hr>
<h3 id="删除符合条件的多行"><a href="#删除符合条件的多行" class="headerlink" title="删除符合条件的多行"></a><strong>删除符合条件的多行</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> test_group <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span> <span class="keyword">AND</span> age <span class="operator">&lt;</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>test_group=&#39;B&#39;</code> 且 <code>age&lt;25</code> 的用户。</p>
<hr>
<h3 id="删除所有数据（清空表）"><a href="#删除所有数据（清空表）" class="headerlink" title="删除所有数据（清空表）"></a><strong>删除所有数据（清空表）</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users;  <span class="comment">-- 慎用！</span></span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：清空 <code>users</code> 表中的所有数据，但<strong>不会重置 <code>AUTO_INCREMENT</code> 计数</strong>。</p>
<p>🔹 <strong>推荐使用 <code>TRUNCATE TABLE</code>，更快且自动重置自增 ID：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> users;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="结合-JOIN-删除"><a href="#结合-JOIN-删除" class="headerlink" title="结合 JOIN 删除"></a><strong>结合 <code>JOIN</code> 删除</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> u <span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> test_results t <span class="keyword">ON</span> u.id <span class="operator">=</span> t.user_id</span><br><span class="line"><span class="keyword">WHERE</span> t.test_result <span class="operator">=</span> <span class="string">&#x27;failed&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>test_results</code> 表中 <code>test_result=&#39;failed&#39;</code> 对应的用户。</p>
<hr>
<h2 id="DELETE-vs-TRUNCATE"><a href="#DELETE-vs-TRUNCATE" class="headerlink" title="DELETE vs TRUNCATE"></a><strong><code>DELETE</code> vs <code>TRUNCATE</code></strong></h2><table>
<thead>
<tr>
<th>操作</th>
<th><code>DELETE</code></th>
<th><code>TRUNCATE</code></th>
</tr>
</thead>
<tbody><tr>
<td><strong>删除方式</strong></td>
<td>按条件删除</td>
<td>清空整个表</td>
</tr>
<tr>
<td><strong>影响 <code>AUTO_INCREMENT</code></strong></td>
<td>不影响</td>
<td>重置为 1</td>
</tr>
<tr>
<td><strong>执行速度</strong></td>
<td>较慢（逐行删除）</td>
<td>快（直接清空）</td>
</tr>
<tr>
<td><strong>触发器（Triggers）</strong></td>
<td>触发 <code>DELETE</code> 触发器</td>
<td>不触发</td>
</tr>
</tbody></table>
<hr>
<h2 id="防止误操作"><a href="#防止误操作" class="headerlink" title="防止误操作"></a><strong>防止误操作</strong></h2><p><strong>防止 <code>DELETE</code> 和 <code>UPDATE</code> 误删除或修改所有数据</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SQL_SAFE_UPDATES <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 启用安全模式</span></span><br></pre></td></tr></table></figure>
<p>如果不小心执行 <code>UPDATE users SET test_group = &#39;B&#39;;</code>（无 <code>WHERE</code>），可以用以下方式回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 仅适用于有事务的表（如 InnoDB）</span></span><br></pre></td></tr></table></figure>

<hr>
<p>✅ <strong><code>UPDATE</code></strong></p>
<ul>
<li><strong>修改单个或多个字段</strong></li>
<li><strong>使用 <code>CASE WHEN</code> 进行条件更新</strong></li>
<li><strong>结合 <code>JOIN</code> 更新数据</strong></li>
</ul>
<p>✅ <strong><code>DELETE</code></strong></p>
<ul>
<li><strong>删除单行或多行</strong></li>
<li><strong>使用 <code>JOIN</code> 删除关联数据</strong></li>
<li><strong><code>DELETE</code> vs <code>TRUNCATE</code></strong>：清空表时 <code>TRUNCATE</code> 更快</li>
</ul>
<h1 id="17-22-操纵表-CREATE-ALTER-DROP-RENAME"><a href="#17-22-操纵表-CREATE-ALTER-DROP-RENAME" class="headerlink" title="17&#x2F;22 操纵表 CREATE ALTER DROP RENAME"></a>17&#x2F;22 操纵表 CREATE ALTER DROP RENAME</h1><h2 id="CREATE-语句（创建表-数据库-索引等）"><a href="#CREATE-语句（创建表-数据库-索引等）" class="headerlink" title="CREATE 语句（创建表&#x2F;数据库&#x2F;索引等）"></a><strong><code>CREATE</code> 语句（创建表&#x2F;数据库&#x2F;索引等）</strong></h2><p><strong>(1) 创建数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE ab_test_db;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：创建一个名为 <code>ab_test_db</code> 的数据库。  </p>
<p>如果数据库已经存在，但你不确定，可以用 <code>IF NOT EXISTS</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> ab_test_db;</span><br></pre></td></tr></table></figure>

<p> <strong>切换到该数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE ab_test_db;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>(2) 创建表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    test_group ENUM(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：  </p>
<ul>
<li><code>id</code> 设置为 <strong>主键 (<code>PRIMARY KEY</code>)</strong>，自动递增 (<code>AUTO_INCREMENT</code>)  </li>
<li><code>test_group</code> 只能是 <strong>“A” 或 “B”</strong>（<code>ENUM</code> 类型）  </li>
<li><code>created_at</code> <strong>默认当前时间戳</strong></li>
</ul>
<p> <strong>如果表已存在，但你不确定</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> users (...);</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>(3) 创建索引（优化查询）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_test_group <span class="keyword">ON</span> users(test_group);</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：在 <code>test_group</code> 上创建索引，加速查询。</p>
<hr>
<p><strong>(4) 创建视图（虚拟表）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, test_group <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：创建一个 <code>active_users</code> 视图，方便查询 <strong>年龄大于 18 的用户</strong>。</p>
<hr>
<h2 id="ALTER-语句（修改表结构）"><a href="#ALTER-语句（修改表结构）" class="headerlink" title="ALTER 语句（修改表结构）"></a><strong><code>ALTER</code> 语句（修改表结构）</strong></h2><p><strong>(1) 添加新列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> email <span class="type">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">UNIQUE</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：给 <code>users</code> 表<strong>新增 <code>email</code> 字段</strong>，且<strong>不允许重复</strong>。</p>
<hr>
<p><strong>(2) 修改列的类型</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users MODIFY <span class="keyword">COLUMN</span> age <span class="type">SMALLINT</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>age</code> 的类型从 <code>INT</code> 改成 <code>SMALLINT</code>，节省存储。</p>
<hr>
<p><strong>(3) 重命名列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users CHANGE <span class="keyword">COLUMN</span> name full_name <span class="type">VARCHAR</span>(<span class="number">150</span>);</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>name</code> 字段改名为 <code>full_name</code>，并调整类型。</p>
<hr>
<p><strong>(4) 删除列</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> email;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>email</code> 字段。</p>
<hr>
<p><strong>(5) 修改表名</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users RENAME <span class="keyword">TO</span> experiment_users;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>users</code> 表改名为 <code>experiment_users</code>。</p>
<hr>
<h2 id="DROP-语句（删除表-数据库-索引）"><a href="#DROP-语句（删除表-数据库-索引）" class="headerlink" title="DROP 语句（删除表&#x2F;数据库&#x2F;索引）"></a><strong><code>DROP</code> 语句（删除表&#x2F;数据库&#x2F;索引）</strong></h2><p><strong>(1) 删除表</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> users;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：彻底删除 <code>users</code> 表，数据也会被删除，无法恢复。</p>
<p> <strong>如果表存在才删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> users;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>(2) 删除数据库</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE ab_test_db;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>ab_test_db</code> 数据库（<strong>慎用！</strong>）。</p>
<p> <strong>如果数据库存在才删除</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE IF <span class="keyword">EXISTS</span> ab_test_db;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>(3) 删除索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_test_group <span class="keyword">ON</span> users;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>users</code> 表上的 <code>idx_test_group</code> 索引。</p>
<hr>
<p>✅ <strong><code>CREATE</code></strong> 用于 <strong>创建数据库、表、索引、视图</strong><br>✅ <strong><code>ALTER</code></strong> 用于 <strong>修改表结构</strong>（添加&#x2F;删除&#x2F;修改列）<br>✅ <strong><code>DROP</code></strong> 用于 <strong>删除表、数据库、索引</strong>（<strong>慎用！</strong>）  </p>
<h1 id="18-22-视图"><a href="#18-22-视图" class="headerlink" title="18&#x2F;22 视图"></a>18&#x2F;22 视图</h1><p><strong>MySQL 有视图（VIEW）<strong>的概念。视图（View）是一个</strong>虚拟表</strong>，它基于 SQL 查询的结果集，但<strong>并不实际存储数据</strong>。视图可以像普通表一样查询，但底层数据来自其他表，适用于数据抽象、权限控制和查询优化。  </p>
<hr>
<h2 id="为什么使用视图？"><a href="#为什么使用视图？" class="headerlink" title="为什么使用视图？"></a><strong>为什么使用视图？</strong></h2><p>✅ <strong>简化复杂查询</strong>：定义一次复杂查询，之后可以像查询普通表一样使用视图。<br>✅ <strong>提升安全性</strong>：限制用户只能访问特定字段，避免直接操作原始表。<br>✅ <strong>提高可读性</strong>：将业务逻辑封装在视图中，使查询更清晰。<br>✅ <strong>动态更新</strong>：视图本身不存储数据，查询视图时会自动获取最新数据。  </p>
<hr>
<h2 id="创建视图-CREATE-VIEW"><a href="#创建视图-CREATE-VIEW" class="headerlink" title="创建视图 (CREATE VIEW)"></a><strong>创建视图 (<code>CREATE VIEW</code>)</strong></h2><h3 id="基本视图"><a href="#基本视图" class="headerlink" title="基本视图"></a><strong>基本视图</strong></h3><p>假设有一个 <code>users</code> 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    age <span class="type">INT</span>,</span><br><span class="line">    test_group ENUM(<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>),</span><br><span class="line">    created_at <span class="type">TIMESTAMP</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p> 创建 <code>active_users</code> 视图，筛选 <code>age &gt; 18</code> 的用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name, test_group <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：定义 <code>active_users</code> 视图，包含 <code>users</code> 表中 <strong>年龄大于 18</strong> 的用户。</p>
<hr>
<h2 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a><strong>使用视图</strong></h2><h3 id="查询视图"><a href="#查询视图" class="headerlink" title="查询视图"></a><strong>查询视图</strong></h3><p>视图的查询方式与表相同：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> active_users;</span><br></pre></td></tr></table></figure>
<p> <strong>结果</strong>：返回 <code>users</code> 表中 <strong>age &gt; 18</strong> 的用户，但<strong>不显示 <code>age</code> 字段</strong>。</p>
<hr>
<h3 id="视图与-JOIN"><a href="#视图与-JOIN" class="headerlink" title="视图与 JOIN"></a><strong>视图与 <code>JOIN</code></strong></h3><p>假设有 <code>test_results</code> 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> test_results (</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    score <span class="type">INT</span>,</span><br><span class="line">    test_result ENUM(<span class="string">&#x27;success&#x27;</span>, <span class="string">&#x27;failed&#x27;</span>),</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p> 创建视图，<strong>获取成功测试的用户</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> successful_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, u.name, u.test_group, t.score</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> test_results t <span class="keyword">ON</span> u.id <span class="operator">=</span> t.user_id</span><br><span class="line"><span class="keyword">WHERE</span> t.test_result <span class="operator">=</span> <span class="string">&#x27;success&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：创建 <code>successful_users</code> 视图，包含 <code>test_result=&#39;success&#39;</code> 的用户信息。</p>
<hr>
<h2 id="修改视图-ALTER-VIEW"><a href="#修改视图-ALTER-VIEW" class="headerlink" title="修改视图 (ALTER VIEW)"></a><strong>修改视图 (<code>ALTER VIEW</code>)</strong></h2><h3 id="修改视图内容"><a href="#修改视图内容" class="headerlink" title="修改视图内容"></a><strong>修改视图内容</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;=</span> <span class="number">21</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：将 <code>active_users</code> 视图的年龄限制从 <code>18</code> 改为 <code>21</code>。</p>
<hr>
<h2 id="删除视图-DROP-VIEW"><a href="#删除视图-DROP-VIEW" class="headerlink" title="删除视图 (DROP VIEW)"></a><strong>删除视图 (<code>DROP VIEW</code>)</strong></h2><p>如果不再需要某个视图，可以删除：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> active_users;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：删除 <code>active_users</code> 视图，<strong>不影响原始表</strong>。</p>
<hr>
<h2 id="视图-vs-表"><a href="#视图-vs-表" class="headerlink" title="视图 vs. 表"></a><strong>视图 vs. 表</strong></h2><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>视图（VIEW）</strong></th>
<th><strong>表（TABLE）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>存储数据</strong></td>
<td>❌ 不存储数据</td>
<td>✅ 存储数据</td>
</tr>
<tr>
<td><strong>查询方式</strong></td>
<td>✅ 与表类似</td>
<td>✅ 标准表查询</td>
</tr>
<tr>
<td><strong>数据更新</strong></td>
<td>⚠️ 部分可更新</td>
<td>✅ 可更新</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td>🚀 适合简化查询</td>
<td>⚡ 适合频繁操作</td>
</tr>
</tbody></table>
<hr>
<h2 id="视图是否可更新？"><a href="#视图是否可更新？" class="headerlink" title="视图是否可更新？"></a><strong>视图是否可更新？</strong></h2><p><strong>不是所有视图都可以更新！</strong><br><strong>可更新的条件</strong>：<br>✅ 视图基于<strong>单个表</strong><br>✅ 视图中的列来自<strong>原表的真实列</strong><br>✅ 视图<strong>不包含 <code>DISTINCT</code>、<code>GROUP BY</code>、<code>HAVING</code>、<code>JOIN</code> 等</strong>复杂查询  </p>
<h3 id="可更新视图"><a href="#可更新视图" class="headerlink" title="可更新视图"></a><strong>可更新视图</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> user_names <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<p>可以直接更新：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> user_names <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;Alice Smith&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="不可更新视图"><a href="#不可更新视图" class="headerlink" title="不可更新视图"></a><strong>不可更新视图</strong></h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> avg_age <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> test_group, <span class="built_in">AVG</span>(age) <span class="keyword">AS</span> avg_age <span class="keyword">FROM</span> users <span class="keyword">GROUP</span> <span class="keyword">BY</span> test_group;</span><br></pre></td></tr></table></figure>
<p>❌ 不能 <code>UPDATE</code>，因为 <code>AVG(age)</code> 是计算结果，不是原始列。</p>
<hr>
<p>✅ <strong><code>CREATE VIEW</code></strong> 定义一个查询结果作为虚拟表<br>✅ <strong><code>SELECT FROM VIEW</code></strong> 可以像查询普通表一样<br>✅ <strong><code>ALTER VIEW</code></strong> 修改视图逻辑<br>✅ <strong><code>DROP VIEW</code></strong> 删除视图<br>✅ <strong>可更新视图</strong> 仅支持<strong>简单查询</strong>，不能有 <code>JOIN</code>、<code>GROUP BY</code>  </p>
<h2 id="A-B-测试（AB-Test）-视图（VIEW）"><a href="#A-B-测试（AB-Test）-视图（VIEW）" class="headerlink" title="A&#x2F;B 测试（AB Test） + 视图（VIEW）"></a><strong>A&#x2F;B 测试（AB Test）</strong> + <strong>视图（VIEW）</strong></h2><h3 id="统一实验数据查询"><a href="#统一实验数据查询" class="headerlink" title="统一实验数据查询"></a><strong>统一实验数据查询</strong></h3><p><strong>问题</strong>：<br>在 A&#x2F;B 测试中，我们可能需要<strong>经常查询用户实验分组、实验结果、点击率、转化率等数据</strong>，而这些数据往往存储在多个表中，比如：</p>
<ul>
<li><code>users</code> 表：存储用户信息  </li>
<li><code>experiments</code> 表：存储用户所属实验组（A&#x2F;B）  </li>
<li><code>metrics</code> 表：存储实验结果（点击率、转化率等）</li>
</ul>
<p><strong>解决方案：使用视图整合关键数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ab_test_results <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> u.id, u.name, e.test_group, m.clicks, m.conversions</span><br><span class="line"><span class="keyword">FROM</span> users u</span><br><span class="line"><span class="keyword">JOIN</span> experiments e <span class="keyword">ON</span> u.id <span class="operator">=</span> e.user_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> metrics m <span class="keyword">ON</span> u.id <span class="operator">=</span> m.user_id;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：</p>
<ul>
<li>直接 <code>SELECT * FROM ab_test_results;</code> 就能获得<strong>完整的 A&#x2F;B 测试结果</strong>  </li>
<li>避免每次都手写复杂 <code>JOIN</code> 语句</li>
</ul>
<p> <strong>示例查询</strong>（获取 B 组的平均转化率）：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> test_group, <span class="built_in">AVG</span>(conversions) <span class="keyword">AS</span> avg_conversion </span><br><span class="line"><span class="keyword">FROM</span> ab_test_results </span><br><span class="line"><span class="keyword">WHERE</span> test_group <span class="operator">=</span> <span class="string">&#x27;B&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="保护敏感数据（权限控制）"><a href="#保护敏感数据（权限控制）" class="headerlink" title="保护敏感数据（权限控制）"></a><strong>保护敏感数据（权限控制）</strong></h3><p><strong>问题</strong>：</p>
<ul>
<li>有些团队（如数据分析师）<strong>不需要访问用户的敏感信息（如邮箱、手机号）</strong>，但他们需要实验数据。  </li>
<li>如果直接授予 <code>users</code> 表的访问权限，可能会泄露敏感数据。</li>
</ul>
<p><strong>解决方案：创建只包含必要字段的视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ab_test_public <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> id, test_group, clicks, conversions</span><br><span class="line"><span class="keyword">FROM</span> ab_test_results;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：</p>
<ul>
<li>仅暴露 <code>test_group</code>、<code>clicks</code> 和 <code>conversions</code>，而不暴露 <code>name</code>、<code>email</code> 等敏感信息  </li>
<li>数据分析师可以直接 <code>SELECT * FROM ab_test_public;</code> 进行分析</li>
</ul>
<hr>
<h3 id="计算实验统计指标"><a href="#计算实验统计指标" class="headerlink" title="计算实验统计指标"></a><strong>计算实验统计指标</strong></h3><p><strong>问题</strong>：</p>
<ul>
<li>需要计算 <strong>每个实验组的总点击数、总转化数、转化率</strong>，而 <code>metrics</code> 可能包含大量数据，<strong>每次计算都很慢</strong>。  </li>
<li>想要<strong>优化查询，提高查询性能</strong>。</li>
</ul>
<p><strong>解决方案：创建聚合视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> ab_test_summary <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> test_group, </span><br><span class="line">       <span class="built_in">SUM</span>(clicks) <span class="keyword">AS</span> total_clicks, </span><br><span class="line">       <span class="built_in">SUM</span>(conversions) <span class="keyword">AS</span> total_conversions,</span><br><span class="line">       <span class="built_in">SUM</span>(conversions) <span class="operator">/</span> <span class="built_in">NULLIF</span>(<span class="built_in">SUM</span>(clicks), <span class="number">0</span>) <span class="keyword">AS</span> conversion_rate</span><br><span class="line"><span class="keyword">FROM</span> ab_test_results</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> test_group;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：</p>
<ul>
<li>预先计算 <code>total_clicks</code>、<code>total_conversions</code> 和 <code>conversion_rate</code>，查询时直接使用视图，提高性能  </li>
<li>只需执行 <code>SELECT * FROM ab_test_summary;</code> 即可获取实验指标</li>
</ul>
<hr>
<h3 id="加速数据分析（预过滤高质量用户）"><a href="#加速数据分析（预过滤高质量用户）" class="headerlink" title="加速数据分析（预过滤高质量用户）"></a><strong>加速数据分析（预过滤高质量用户）</strong></h3><p><strong>问题</strong>：</p>
<ul>
<li>在 A&#x2F;B 测试分析时，可能只关注<strong>活跃用户</strong>（如最近 30 天内登录过的用户）。  </li>
<li>如果 <code>users</code> 表很大，每次分析都要加 <code>WHERE last_login &gt;= DATE_SUB(NOW(), INTERVAL 30 DAY)</code>，查询变慢。</li>
</ul>
<p><strong>解决方案：创建活跃用户视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> active_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> last_login <span class="operator">&gt;=</span> DATE_SUB(NOW(), <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>);</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：</p>
<ul>
<li>只需 <code>SELECT * FROM active_users;</code>，避免重复写 <code>WHERE last_login ...</code> 条件，提高查询效率</li>
</ul>
<p> <strong>示例查询</strong>（查询活跃用户中的 A&#x2F;B 组分布）：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.test_group, <span class="built_in">COUNT</span>(<span class="operator">*</span>) </span><br><span class="line"><span class="keyword">FROM</span> active_users a</span><br><span class="line"><span class="keyword">JOIN</span> experiments e <span class="keyword">ON</span> a.id <span class="operator">=</span> e.user_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> e.test_group;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="实时监控-A-B-测试进展"><a href="#实时监控-A-B-测试进展" class="headerlink" title="实时监控 A&#x2F;B 测试进展"></a><strong>实时监控 A&#x2F;B 测试进展</strong></h3><p><strong>问题</strong>：</p>
<ul>
<li>需要<strong>每天自动统计 A&#x2F;B 组的用户增长情况</strong>，但不想存储冗余数据。</li>
</ul>
<p><strong>解决方案：创建动态用户增长视图</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> daily_new_users <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">DATE</span>(created_at) <span class="keyword">AS</span> signup_date, test_group, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> new_users</span><br><span class="line"><span class="keyword">FROM</span> users</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> signup_date, test_group;</span><br></pre></td></tr></table></figure>
<p> <strong>作用</strong>：</p>
<ul>
<li>只需 <code>SELECT * FROM daily_new_users;</code> 即可看到每天新用户的 A&#x2F;B 组分布</li>
</ul>
<p> <strong>示例查询</strong>（查看最近 7 天的实验用户增长）：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> daily_new_users <span class="keyword">WHERE</span> signup_date <span class="operator">&gt;=</span> CURDATE() <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">7</span> <span class="keyword">DAY</span>;</span><br></pre></td></tr></table></figure>

<hr>
<table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>视图名称</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>整合实验数据</strong></td>
<td><code>ab_test_results</code></td>
<td>简化 A&#x2F;B 测试数据查询</td>
</tr>
<tr>
<td><strong>权限控制</strong></td>
<td><code>ab_test_public</code></td>
<td>保护敏感数据，限制访问范围</td>
</tr>
<tr>
<td><strong>计算实验指标</strong></td>
<td><code>ab_test_summary</code></td>
<td>预计算点击率、转化率，提高查询效率</td>
</tr>
<tr>
<td><strong>优化活跃用户查询</strong></td>
<td><code>active_users</code></td>
<td>预过滤活跃用户，避免重复筛选</td>
</tr>
<tr>
<td><strong>监控实验进展</strong></td>
<td><code>daily_new_users</code></td>
<td>统计每天新用户的 A&#x2F;B 组分布</td>
</tr>
</tbody></table>
<p><strong>💡 视图的核心价值：</strong><br>✅ <strong>简化查询</strong>（减少重复 <code>JOIN</code>）<br>✅ <strong>提升性能</strong>（避免每次都计算相同指标）<br>✅ <strong>数据安全</strong>（限制字段访问）<br>✅ <strong>实时更新</strong>（查询最新数据，无需手动维护）  </p>
<hr>
<h1 id="19-22-存储过程"><a href="#19-22-存储过程" class="headerlink" title="19&#x2F;22 存储过程"></a>19&#x2F;22 存储过程</h1><h2 id="什么是存储过程？"><a href="#什么是存储过程？" class="headerlink" title="什么是存储过程？"></a><strong>什么是存储过程？</strong></h2><p><strong>存储过程（Stored Procedure）</strong> 是 <strong>一组 SQL 语句的集合</strong>，它们被预编译并存储在 MySQL 服务器中，可以在需要时通过调用执行。存储过程类似于编程语言中的函数，可以带 <strong>输入参数</strong>、<strong>输出参数</strong>，并包含 <strong>业务逻辑</strong>。  </p>
<hr>
<h2 id="为什么要使用存储过程？"><a href="#为什么要使用存储过程？" class="headerlink" title="为什么要使用存储过程？"></a><strong>为什么要使用存储过程？</strong></h2><p>✅ <strong>提高执行效率</strong>：存储过程被<strong>预编译</strong>，执行速度比普通 SQL 查询快。<br>✅ <strong>减少网络传输</strong>：在客户端只需要<strong>调用存储过程</strong>，不需要多次发送 SQL 语句，减少网络负担。<br>✅ <strong>增强安全性</strong>：可以<strong>隐藏复杂的 SQL 逻辑</strong>，避免直接暴露表结构。<br>✅ <strong>代码复用</strong>：存储过程可以多次使用，减少代码重复，提高可维护性。  </p>
<hr>
<h2 id="如何创建存储过程？"><a href="#如何创建存储过程？" class="headerlink" title="如何创建存储过程？"></a><strong>如何创建存储过程？</strong></h2><h3 id="语法"><a href="#语法" class="headerlink" title="** 语法**"></a>** 语法**</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 存储过程名 (参数)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SQL</span> 语句;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p>🔹 <strong><code>DELIMITER //</code></strong> 用于改变语句结束符，防止 <code>;</code> 导致提前结束。<br>🔹 <strong><code>BEGIN ... END</code></strong> 块中写 SQL 逻辑。<br>🔹 <strong>参数</strong>：</p>
<ul>
<li><code>IN</code>：输入参数</li>
<li><code>OUT</code>：输出参数</li>
<li><code>INOUT</code>：既是输入参数也是输出参数</li>
</ul>
<hr>
<h3 id="示例：创建存储过程"><a href="#示例：创建存储过程" class="headerlink" title="示例：创建存储过程"></a><strong>示例：创建存储过程</strong></h3><p><strong>(1) 简单存储过程</strong><br>** 需求：获取 <code>users</code> 表的用户数量**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> GetUserCount(<span class="keyword">OUT</span> user_count <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> user_count <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li><code>OUT user_count INT</code>：定义一个输出参数 <code>user_count</code></li>
<li><code>SELECT COUNT(*) INTO user_count FROM users;</code>：查询用户数量并存入 <code>user_count</code></li>
</ul>
<p><strong>(2) 带输入参数的存储过程</strong><br>** 需求：根据 <code>test_group</code> 获取某个实验组的用户数量**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> GetGroupUserCount(<span class="keyword">IN</span> group_name <span class="type">VARCHAR</span>(<span class="number">10</span>), <span class="keyword">OUT</span> user_count <span class="type">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> user_count <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> test_group <span class="operator">=</span> group_name;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li><code>IN group_name VARCHAR(10)</code>：接受实验组（A&#x2F;B）作为输入</li>
<li><code>OUT user_count INT</code>：返回用户数量</li>
</ul>
<hr>
<h2 id="如何执行存储过程？"><a href="#如何执行存储过程？" class="headerlink" title="如何执行存储过程？"></a><strong>如何执行存储过程？</strong></h2><p><strong>(1) 执行无参数存储过程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> GetUserCount(<span class="variable">@count</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@count</span> <span class="keyword">AS</span> user_count;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li><code>CALL GetUserCount(@count);</code> 执行存储过程，并将结果存入 <code>@count</code></li>
<li><code>SELECT @count;</code> 查看结果</li>
</ul>
<hr>
<p><strong>(2) 执行带参数存储过程</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> GetGroupUserCount(<span class="string">&#x27;A&#x27;</span>, <span class="variable">@count</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@count</span> <span class="keyword">AS</span> user_count;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li>传入 <code>&quot;A&quot;</code> 作为 <code>test_group</code></li>
<li>获取 <code>&quot;A&quot;</code> 组的用户数量</li>
</ul>
<hr>
<h2 id="复杂存储过程"><a href="#复杂存储过程" class="headerlink" title="复杂存储过程"></a><strong>复杂存储过程</strong></h2><p><strong>(1) 带 <code>IF</code> 逻辑</strong><br>** 需求：检查用户是否在 A&#x2F;B 组中**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> CheckUserGroup(<span class="keyword">IN</span> user_id <span class="type">INT</span>, <span class="keyword">OUT</span> group_name <span class="type">VARCHAR</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> temp_group <span class="type">VARCHAR</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">SELECT</span> test_group <span class="keyword">INTO</span> temp_group <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> user_id;</span><br><span class="line">    </span><br><span class="line">    IF temp_group <span class="keyword">IS</span> <span class="keyword">NULL</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> group_name <span class="operator">=</span> <span class="string">&#x27;Not Found&#x27;</span>;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        <span class="keyword">SET</span> group_name <span class="operator">=</span> temp_group;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li><code>DECLARE temp_group VARCHAR(10);</code> 声明变量  </li>
<li><code>SELECT test_group INTO temp_group</code> 取出用户实验组  </li>
<li><code>IF temp_group IS NULL THEN</code> 处理用户不存在的情况</li>
</ul>
<p> <strong>调用</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> CheckUserGroup(<span class="number">101</span>, <span class="variable">@group</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@group</span> <span class="keyword">AS</span> test_group;</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>(2) 带循环 <code>WHILE</code></strong><br>** 需求：批量更新 <code>users</code> 表，将 <code>age</code> 小于 18 的用户设为 <code>test_group=&#39;C&#39;</code>**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> UpdateUnderageUsers()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> user_id <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&lt;</span> <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">OPEN</span> cur;</span><br><span class="line">    </span><br><span class="line">    read_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> user_id;</span><br><span class="line">        IF done <span class="keyword">THEN</span></span><br><span class="line">            LEAVE read_loop;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">UPDATE</span> users <span class="keyword">SET</span> test_group <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> user_id;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li><strong>声明游标 <code>CURSOR</code></strong>，遍历所有 <code>age &lt; 18</code> 的用户  </li>
<li><strong>使用 <code>WHILE</code> 或 <code>LOOP</code></strong> 逐行处理数据  </li>
<li><strong>批量更新 <code>test_group</code> 为 “C”</strong></li>
</ul>
<p> <strong>调用</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CALL</span> UpdateUnderageUsers();</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a><strong>删除存储过程</strong></h2><p>如果存储过程不再需要，可以删除：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> IF <span class="keyword">EXISTS</span> GetUserCount;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="存储过程-vs-视图"><a href="#存储过程-vs-视图" class="headerlink" title="存储过程 vs 视图"></a><strong>存储过程 vs 视图</strong></h2><table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>存储过程（Stored Procedure）</strong></th>
<th><strong>视图（View）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>存储数据</strong></td>
<td>❌ 不存储数据</td>
<td>❌ 不存储数据</td>
</tr>
<tr>
<td><strong>执行逻辑</strong></td>
<td>✅ 可执行 <strong>复杂业务逻辑</strong></td>
<td>🚫 仅能查询</td>
</tr>
<tr>
<td><strong>带参数</strong></td>
<td>✅ 支持 <code>IN</code>&#x2F;<code>OUT</code> 参数</td>
<td>🚫 不支持</td>
</tr>
<tr>
<td><strong>查询性能</strong></td>
<td>🚀 适用于<strong>大数据批量操作</strong></td>
<td>⚡ 适用于<strong>查询优化</strong></td>
</tr>
<tr>
<td><strong>数据更新</strong></td>
<td>✅ 可执行 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code></td>
<td>⚠️ 部分视图可更新</td>
</tr>
<tr>
<td><strong>安全性</strong></td>
<td>✅ 可封装逻辑，限制用户直接操作</td>
<td>✅ 可限制字段访问</td>
</tr>
</tbody></table>
<p>💡 <strong>适用场景</strong>：</p>
<ul>
<li><strong>视图（View）</strong>：适用于<strong>数据查询</strong>、<strong>权限控制</strong></li>
<li><strong>存储过程（Stored Procedure）</strong>：适用于<strong>数据处理</strong>、<strong>复杂业务逻辑</strong></li>
</ul>
<hr>
<p>✅ <strong>存储过程</strong> 是一组 <strong>可复用的 SQL 语句</strong>，用于<strong>简化复杂查询、提高效率</strong>。<br>✅ <strong>使用 <code>CALL</code> 语句执行存储过程</strong>，可带 <code>IN</code> &#x2F; <code>OUT</code> 参数。<br>✅ <strong>存储过程适用于 A&#x2F;B 测试的批量更新、数据统计、用户分组管理</strong>。<br>✅ <strong>可用 <code>IF</code>、<code>WHILE</code>、<code>CURSOR</code> 实现更复杂的逻辑</strong>。  </p>
<h1 id="20-22-事务处理"><a href="#20-22-事务处理" class="headerlink" title="20&#x2F;22 事务处理"></a>20&#x2F;22 事务处理</h1><h2 id="什么是事务处理？"><a href="#什么是事务处理？" class="headerlink" title="什么是事务处理？"></a><strong>什么是事务处理？</strong></h2><p>事务（Transaction）是一个<strong>逻辑上的操作单元</strong>，它由一组 SQL 语句组成，这些 SQL 语句要么全部执行，要么全部不执行。事务保证了数据库操作的 <strong>原子性（Atomicity）</strong>，<strong>一致性（Consistency）</strong>，<strong>隔离性（Isolation）</strong>，和 <strong>持久性（Durability）</strong>，通常称为 <strong>ACID 属性</strong>。</p>
<h3 id="ACID-属性："><a href="#ACID-属性：" class="headerlink" title="ACID 属性："></a><strong>ACID 属性</strong>：</h3><ol>
<li><strong>原子性（Atomicity）</strong>：事务中的操作要么全部成功，要么全部失败，不能出现部分完成的情况。</li>
<li><strong>一致性（Consistency）</strong>：事务执行前后，数据库都必须保持一致性状态。</li>
<li><strong>隔离性（Isolation）</strong>：一个事务的执行不应受到其他事务的干扰，保证数据的一致性。</li>
<li><strong>持久性（Durability）</strong>：事务提交后，修改的数据会永久保存，系统崩溃也不会丢失。</li>
</ol>
<hr>
<h2 id="为什么需要事务处理？"><a href="#为什么需要事务处理？" class="headerlink" title="为什么需要事务处理？"></a><strong>为什么需要事务处理？</strong></h2><p><strong>(1) 保证数据一致性</strong><br>在没有事务的情况下，多个操作可能会在数据库中出现部分成功、部分失败的情况，导致数据不一致。事务保证了数据库操作的 <strong>完整性</strong>，避免了数据的脏读、幻读等问题。</p>
<p><strong>(2) 提高可靠性</strong><br>例如，银行转账操作：一个账户减去金额，另一个账户增加金额。如果没有事务管理，可能在第一步成功时出现故障，导致账户金额错误。事务确保了要么两个操作都成功，要么都不执行。</p>
<p><strong>(3) 避免数据损坏</strong><br>事务通过确保原子性来避免部分操作失败，保证了数据的完整性和一致性。</p>
<hr>
<h2 id="如何管理事务处理？"><a href="#如何管理事务处理？" class="headerlink" title="如何管理事务处理？"></a><strong>如何管理事务处理？</strong></h2><p><strong>(1) 启动事务 (<code>START TRANSACTION</code>)</strong></p>
<p>在 MySQL 中，<strong>事务处理</strong>是通过显式控制的，事务必须通过 <strong><code>START TRANSACTION</code></strong> 或 <strong><code>BEGIN</code></strong> 来开始：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="comment">-- 或者</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br></pre></td></tr></table></figure>

<p><strong>(2) 提交事务 (<code>COMMIT</code>)</strong></p>
<p>当所有的操作都执行成功时，通过 <strong><code>COMMIT</code></strong> 来提交事务，所有操作将会被永久保存：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p><strong>(3) 回滚事务 (<code>ROLLBACK</code>)</strong></p>
<p>如果事务中有任何操作失败或出现错误，可以通过 <strong><code>ROLLBACK</code></strong> 回滚事务，撤销事务中的所有操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<p><strong>(4) 自动提交</strong></p>
<p>在 MySQL 中，<strong>每次执行 SQL 语句后会自动提交事务</strong>，如果不手动控制事务，则每个语句都会被视为一个独立的事务。这是默认的行为。</p>
<hr>
<h2 id="事务管理的基本语法"><a href="#事务管理的基本语法" class="headerlink" title="事务管理的基本语法"></a><strong>事务管理的基本语法</strong></h2><p><strong>(1) 使用事务控制</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION; <span class="comment">-- 开始事务</span></span><br><span class="line"><span class="comment">-- 事务中的 SQL 操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 扣款操作</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 收款操作</span></span><br><span class="line"><span class="keyword">COMMIT</span>;  <span class="comment">-- 提交事务</span></span><br></pre></td></tr></table></figure>

<p><strong>(2) 事务回滚</strong><br>假设在执行的过程中，出现了问题（例如，扣款成功，收款失败），可以执行 <code>ROLLBACK</code> 来回滚所有的操作。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- 假设此时收款方账户无法找到，执行回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 撤销事务</span></span><br></pre></td></tr></table></figure>

<p><strong>(3) 事务示例：银行转账</strong><br>假设有一个 <code>account</code> 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> account (</span><br><span class="line">    account_id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    balance <span class="type">DECIMAL</span>(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>执行银行转账操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 扣款</span></span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 收款</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>如果第二个 <code>UPDATE</code> 失败，可以回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> account <span class="keyword">SET</span> balance <span class="operator">=</span> balance <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> account_id <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- 扣款</span></span><br><span class="line"><span class="comment">-- 第二个 `UPDATE` 失败</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;  <span class="comment">-- 回滚操作，保持数据一致</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a><strong>事务隔离级别</strong></h2><p>事务的 <strong>隔离性</strong> 控制了一个事务与其他事务之间的干扰程度。MySQL 提供了四种事务隔离级别，分别是：</p>
<ol>
<li><strong>读未提交（Read Uncommitted）</strong>：事务可以读取其他事务未提交的数据，可能会导致脏读。</li>
<li><strong>读已提交（Read Committed）</strong>：事务只能读取其他事务已经提交的数据，避免了脏读，但可能会导致不可重复读。</li>
<li><strong>可重复读（Repeatable Read）</strong>：事务在整个执行期间可以多次读取相同数据，避免了脏读和不可重复读，但可能会出现幻读。</li>
<li><strong>串行化（Serializable）</strong>：事务完全串行执行，完全避免了脏读、不可重复读和幻读，但性能最差。</li>
</ol>
<p><strong>设置隔离级别</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="事务处理-vs-存储过程"><a href="#事务处理-vs-存储过程" class="headerlink" title="事务处理 vs 存储过程"></a><strong>事务处理 vs 存储过程</strong></h2><p><strong>(1) 事务处理</strong></p>
<ul>
<li>事务主要关注 <strong>一组操作的完整性和一致性</strong>，用于确保多个 SQL 语句在同一事务中的原子性、隔离性等。</li>
<li>事务通常用于需要保证 <strong>原子性和一致性的操作</strong>，如银行转账等场景。</li>
</ul>
<p><strong>(2) 存储过程</strong></p>
<ul>
<li>存储过程是一组 <strong>封装好的 SQL 语句</strong>，用于 <strong>简化重复的操作</strong>，可以执行一系列复杂的业务逻辑。</li>
<li>存储过程有 <strong>输入输出参数</strong>，并且可以包含 <strong>条件判断、循环等控制结构</strong>，而事务主要用于对数据的一组操作进行控制。</li>
</ul>
<p><strong>对比：</strong></p>
<table>
<thead>
<tr>
<th><strong>特性</strong></th>
<th><strong>事务</strong></th>
<th><strong>存储过程</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>用途</strong></td>
<td>管理一组 SQL 语句的执行</td>
<td>封装一系列 SQL 语句和逻辑</td>
</tr>
<tr>
<td><strong>控制粒度</strong></td>
<td>操作的原子性、隔离性、持久性等</td>
<td>提供输入、输出参数及控制结构</td>
</tr>
<tr>
<td><strong>是否持久化</strong></td>
<td>不存储在数据库中</td>
<td>存储在数据库中，能被多次调用</td>
</tr>
<tr>
<td><strong>支持条件、循环等</strong></td>
<td>支持（通过事务控制）</td>
<td>支持（通过编程控制）</td>
</tr>
<tr>
<td><strong>执行方式</strong></td>
<td>手动开始、提交、回滚</td>
<td>通过 <code>CALL</code> 语句执行</td>
</tr>
</tbody></table>
<hr>
<ul>
<li><strong>事务</strong> 主要用来管理一组数据库操作，确保这些操作的原子性、一致性、隔离性和持久性，保证数据的一致性和可靠性。</li>
<li><strong>存储过程</strong> 是一组预编译的 SQL 语句，可以被多次调用，封装了业务逻辑，用于简化和复用代码。</li>
<li><strong>事务与存储过程的区别</strong>：事务关注数据操作的完整性和一致性，而存储过程更多是用于封装操作和业务逻辑，能更灵活地实现复杂的功能。</li>
</ul>
<h1 id="21-22-游标"><a href="#21-22-游标" class="headerlink" title="21&#x2F;22 游标"></a>21&#x2F;22 游标</h1><h2 id="什么是游标（Cursor）？"><a href="#什么是游标（Cursor）？" class="headerlink" title="什么是游标（Cursor）？"></a><strong>什么是游标（Cursor）？</strong></h2><p>游标（Cursor）是一种 <strong>数据库查询处理机制</strong>，用于逐行访问 <strong>查询结果集</strong>。在 MySQL 中，普通的 <code>SELECT</code> 语句一次性返回所有符合条件的记录，而 <strong>游标允许你按行处理数据</strong>，适用于 <strong>需要逐条处理数据的复杂业务场景</strong>。</p>
<hr>
<h2 id="游标和普通查询（聚集数据）的区别"><a href="#游标和普通查询（聚集数据）的区别" class="headerlink" title="游标和普通查询（聚集数据）的区别"></a><strong>游标和普通查询（聚集数据）的区别</strong></h2><table>
<thead>
<tr>
<th><strong>对比项</strong></th>
<th><strong>游标（Cursor）</strong></th>
<th><strong>普通查询（SELECT 结果集）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>数据处理方式</strong></td>
<td><strong>逐行读取数据</strong>，适用于 <strong>复杂逻辑</strong></td>
<td><strong>一次性获取全部数据</strong></td>
</tr>
<tr>
<td><strong>内存占用</strong></td>
<td>可能占用较大内存，需要手动 <code>CLOSE</code></td>
<td>一次性读取，不占用游标资源</td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td>需要<strong>逐条处理数据</strong>、执行复杂的 <strong>业务逻辑</strong></td>
<td>直接获取数据并用于统计、展示等</td>
</tr>
<tr>
<td><strong>是否可修改数据</strong></td>
<td>只可 <strong>逐行操作</strong>（可结合 <code>UPDATE</code>&#x2F;<code>DELETE</code>）</td>
<td>只可整体操作结果集</td>
</tr>
</tbody></table>
<hr>
<h2 id="游标的核心语句"><a href="#游标的核心语句" class="headerlink" title="游标的核心语句"></a><strong>游标的核心语句</strong></h2><p>在 MySQL 中，游标通常和 <strong>存储过程（Stored Procedure）</strong> 结合使用，常见的游标操作语句有：</p>
<ol>
<li><strong>声明游标 (<code>DECLARE CURSOR FOR</code>)</strong>：定义一个游标，存储 <code>SELECT</code> 语句的结果集。</li>
<li><strong>打开游标 (<code>OPEN cursor_name</code>)</strong>：开始使用游标，查询数据。</li>
<li><strong>获取数据 (<code>FETCH cursor_name INTO</code>)</strong>：逐行获取游标查询的结果。</li>
<li><strong>关闭游标 (<code>CLOSE cursor_name</code>)</strong>：释放游标占用的资源。</li>
</ol>
<hr>
<h2 id="游标的使用示例"><a href="#游标的使用示例" class="headerlink" title="游标的使用示例"></a><strong>游标的使用示例</strong></h2><p><strong>基本游标操作</strong><br>** 需求：逐行读取 <code>users</code> 表的 <code>id</code> 和 <code>name</code>**</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ProcessUsers()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> user_id <span class="type">INT</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> user_name <span class="type">VARCHAR</span>(<span class="number">50</span>);</span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 定义游标，查询 users 表中的 id 和 name</span></span><br><span class="line">    <span class="keyword">DECLARE</span> user_cursor <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line">    <span class="keyword">SELECT</span> id, name <span class="keyword">FROM</span> users;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 处理游标到达末尾的情况</span></span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 打开游标</span></span><br><span class="line">    <span class="keyword">OPEN</span> user_cursor;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 循环获取数据</span></span><br><span class="line">    read_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> user_cursor <span class="keyword">INTO</span> user_id, user_name;</span><br><span class="line">        IF done <span class="keyword">THEN</span></span><br><span class="line">            LEAVE read_loop;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 这里可以添加处理逻辑，例如输出数据或者更新记录</span></span><br><span class="line">        <span class="keyword">SELECT</span> CONCAT(<span class="string">&#x27;User ID:&#x27;</span>, user_id, <span class="string">&#x27; Name:&#x27;</span>, user_name);</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 关闭游标</span></span><br><span class="line">    <span class="keyword">CLOSE</span> user_cursor;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ol>
<li><strong><code>DECLARE user_cursor CURSOR FOR SELECT ...</code></strong> 定义游标。</li>
<li><strong><code>DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;</code></strong> 处理游标结束的情况。</li>
<li><strong><code>OPEN user_cursor;</code></strong> 打开游标，开始访问数据。</li>
<li><strong><code>FETCH user_cursor INTO ...;</code></strong> 逐行读取数据。</li>
<li><strong><code>LEAVE read_loop;</code></strong> 退出循环，防止死循环。</li>
<li><strong><code>CLOSE user_cursor;</code></strong> 关闭游标，释放资源。</li>
</ol>
<hr>
<h2 id="使用游标更新数据"><a href="#使用游标更新数据" class="headerlink" title="使用游标更新数据"></a><strong>使用游标更新数据</strong></h2><p>需求：将 <code>users</code> 表中年龄小于 18 岁的用户设为 <code>test_group=&#39;C&#39;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> UpdateUnderageUsers()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> user_id <span class="type">INT</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 定义游标，查询所有小于 18 岁的用户</span></span><br><span class="line">    <span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&lt;</span> <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 处理游标结束情况</span></span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 打开游标</span></span><br><span class="line">    <span class="keyword">OPEN</span> cur;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 逐行处理</span></span><br><span class="line">    read_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> user_id;</span><br><span class="line">        IF done <span class="keyword">THEN</span></span><br><span class="line">            LEAVE read_loop;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">-- 更新用户的 test_group</span></span><br><span class="line">        <span class="keyword">UPDATE</span> users <span class="keyword">SET</span> test_group <span class="operator">=</span> <span class="string">&#x27;C&#x27;</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> user_id;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 关闭游标</span></span><br><span class="line">    <span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li>使用游标遍历 <code>users</code> 表，找到 <code>age &lt; 18</code> 的用户，并更新 <code>test_group</code>。</li>
</ul>
<hr>
<h2 id="使用游标删除数据"><a href="#使用游标删除数据" class="headerlink" title="使用游标删除数据"></a><strong>使用游标删除数据</strong></h2><p>需求：删除 <code>orders</code> 表中已过期的订单</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> DeleteExpiredOrders()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">DECLARE</span> done <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">DECLARE</span> order_id <span class="type">INT</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 定义游标，查找过期的订单</span></span><br><span class="line">    <span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> </span><br><span class="line">    <span class="keyword">SELECT</span> id <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_date <span class="operator">&lt;</span> NOW() <span class="operator">-</span> <span class="type">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 处理游标结束情况</span></span><br><span class="line">    <span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">NOT</span> FOUND <span class="keyword">SET</span> done <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 打开游标</span></span><br><span class="line">    <span class="keyword">OPEN</span> cur;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 逐行删除数据</span></span><br><span class="line">    read_loop: LOOP</span><br><span class="line">        <span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> order_id;</span><br><span class="line">        IF done <span class="keyword">THEN</span></span><br><span class="line">            LEAVE read_loop;</span><br><span class="line">        <span class="keyword">END</span> IF;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">DELETE</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> id <span class="operator">=</span> order_id;</span><br><span class="line">    <span class="keyword">END</span> LOOP;</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- 关闭游标</span></span><br><span class="line">    <span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span> <span class="operator">/</span><span class="operator">/</span></span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>
<p> <strong>解释</strong>：</p>
<ul>
<li>游标获取所有 <strong>30 天前的订单</strong>，逐行删除。</li>
</ul>
<hr>
<h2 id="游标-vs-普通查询"><a href="#游标-vs-普通查询" class="headerlink" title="游标 vs 普通查询"></a><strong>游标 vs 普通查询</strong></h2><table>
<thead>
<tr>
<th><strong>对比项</strong></th>
<th><strong>游标（Cursor）</strong></th>
<th><strong>普通查询（SELECT）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>适用场景</strong></td>
<td>适用于 <strong>逐行操作、复杂业务逻辑</strong></td>
<td>适用于 <strong>批量查询、数据统计</strong></td>
</tr>
<tr>
<td><strong>执行方式</strong></td>
<td>逐行读取并处理</td>
<td>一次性返回所有结果</td>
</tr>
<tr>
<td><strong>性能</strong></td>
<td><strong>低（适合小数据量）</strong></td>
<td><strong>高（适合大数据量）</strong></td>
</tr>
<tr>
<td><strong>数据修改</strong></td>
<td>可以 <strong>逐行 <code>UPDATE</code> &#x2F; <code>DELETE</code></strong></td>
<td>不能直接修改结果集</td>
</tr>
</tbody></table>
<p>✅ <strong>游标适用于：</strong> 需要 <strong>逐行操作数据</strong>，而不能一次性处理的场景（如批量更新、删除、复杂计算）。<br>❌ <strong>不建议使用游标：</strong> 如果可以用 <code>JOIN</code> 或 <code>UPDATE ... WHERE</code> 语句替代，尽量不要使用游标，因为游标的性能比直接 SQL 语句 <strong>低很多</strong>。</p>
<hr>
<ul>
<li><strong>游标用于逐行访问 <code>SELECT</code> 查询的结果集</strong>，适合 <strong>复杂逻辑处理</strong>。</li>
<li><strong>核心语句</strong>：<ul>
<li><code>DECLARE CURSOR FOR SELECT ...</code> 定义游标</li>
<li><code>OPEN 游标名;</code> 打开游标</li>
<li><code>FETCH 游标名 INTO 变量;</code> 读取数据</li>
<li><code>CLOSE 游标名;</code> 关闭游标</li>
</ul>
</li>
<li><strong>适用于</strong> 逐行处理的数据修改（如批量更新、删除等）。</li>
<li><strong>普通查询适用于一次性获取数据</strong>，避免使用游标处理 <strong>大数据量</strong>，否则会影响性能。</li>
</ul>
<p> <strong>如果数据量较大，建议使用 <code>JOIN</code> 或 <code>UPDATE ... WHERE</code> 来优化查询，而不是使用游标！</strong></p>
<h1 id="22-22-SQL特性"><a href="#22-22-SQL特性" class="headerlink" title="22&#x2F;22 SQL特性"></a>22&#x2F;22 SQL特性</h1><h2 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h2><p>约束（Constraint）是 <strong>数据库表级规则</strong>，用于保证数据的完整性、准确性和一致性。MySQL 提供了多种约束，确保表中的数据符合预期的规则，防止错误数据的插入。</p>
<p><strong>1. 约束的类型</strong></p>
<table>
<thead>
<tr>
<th><strong>约束类型</strong></th>
<th><strong>作用</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>PRIMARY KEY</strong> （主键）</td>
<td>确保每一行的 <strong>唯一性</strong>，且不能为 <code>NULL</code></td>
<td><code>id</code></td>
</tr>
<tr>
<td><strong>FOREIGN KEY</strong> （外键）</td>
<td>关联另一个表的主键，保证数据一致性</td>
<td><code>user_id</code></td>
</tr>
<tr>
<td><strong>UNIQUE</strong> （唯一约束）</td>
<td>确保字段值唯一，但可以有 <code>NULL</code></td>
<td><code>email</code></td>
</tr>
<tr>
<td><strong>NOT NULL</strong> （非空）</td>
<td>确保字段不能为空</td>
<td><code>name</code></td>
</tr>
<tr>
<td><strong>CHECK</strong> （检查约束）</td>
<td>确保字段值符合指定条件（MySQL 8.0+）</td>
<td><code>age &gt;= 18</code></td>
</tr>
<tr>
<td><strong>DEFAULT</strong> （默认值）</td>
<td>为字段提供默认值</td>
<td><code>status=&#39;active&#39;</code></td>
</tr>
</tbody></table>
<p><strong>2. 各种约束的使用方式</strong><br><strong>2.1 <code>PRIMARY KEY</code>（主键约束）</strong></p>
<ul>
<li>主键是 <strong>表的唯一标识</strong>，不能有 <code>NULL</code>，通常用于 <code>id</code>。</li>
<li>一个表<strong>只能有一个主键</strong>，可以是<strong>单列</strong>或<strong>多列</strong>。</li>
</ul>
<p><strong>(1) 在 <code>CREATE TABLE</code> 时添加主键</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,  <span class="comment">-- id 是主键，唯一且不能为 NULL</span></span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>(2) 组合主键</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    order_id <span class="type">INT</span>,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    quantity <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (order_id, product_id)  <span class="comment">-- 组合主键，确保 order_id + product_id 唯一</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.2 <code>FOREIGN KEY</code>（外键约束）</strong></p>
<ul>
<li><strong>保证数据的完整性</strong>，确保某个字段的值来自另一个表的主键。</li>
<li><strong>可设置级联操作</strong>（<code>CASCADE</code>、<code>SET NULL</code>、<code>RESTRICT</code>）。</li>
</ul>
<p><strong>(1) <code>FOREIGN KEY</code> 约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id)  <span class="comment">-- user_id 必须在 users 表中存在</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>(2) 级联删除 <code>CASCADE</code></strong><br>当 <code>users</code> 表的 <code>id</code> 被删除时，<code>orders</code> 表中对应的 <code>user_id</code> 记录也会被删除：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    user_id <span class="type">INT</span>,</span><br><span class="line">    <span class="keyword">FOREIGN KEY</span> (user_id) <span class="keyword">REFERENCES</span> users(id) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>✅ <strong><code>ON DELETE CASCADE</code> 适用于：</strong> 级联删除，如用户删除时自动删除其订单。</p>
<hr>
<p><strong>2.3 <code>UNIQUE</code>（唯一约束）</strong></p>
<ul>
<li>确保字段值唯一，<strong>可以有多个 <code>NULL</code></strong>（但 <code>PRIMARY KEY</code> 不允许 <code>NULL</code>）。</li>
<li>适用于 <code>email</code>、<code>phone</code> 等字段，防止重复。</li>
</ul>
<p><strong>(1) <code>CREATE TABLE</code> 时添加 <code>UNIQUE</code> 约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>  <span class="comment">-- email 不能重复</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>(2) 添加多个唯一约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> (email, phone)  <span class="comment">-- email + phone 组合唯一</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>(3) <code>ALTER TABLE</code> 添加唯一约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD CONSTRAINT</span> unique_email <span class="keyword">UNIQUE</span> (email);</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.4 <code>NOT NULL</code>（非空约束）</strong></p>
<ul>
<li><strong>防止 <code>NULL</code> 值插入</strong>，确保字段必须有值。</li>
<li>适用于 <code>name</code>、<code>birth_date</code>、<code>email</code> 等字段。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>  <span class="comment">-- name 不能为空</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="keyword">NULL</span>); <span class="comment">-- ❌ 错误，name 不能为空</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.5 <code>CHECK</code>（检查约束，MySQL 8.0+）</strong></p>
<ul>
<li><strong>保证字段值符合某个条件</strong>，适用于 <code>age</code>、<code>salary</code> 等字段。</li>
</ul>
<p><strong>(1) <code>CHECK</code> 约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span>)  <span class="comment">-- 限制年龄必须 &gt;=18</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>(2) <code>ALTER TABLE</code> 添加 <code>CHECK</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">ADD CONSTRAINT</span> age_check <span class="keyword">CHECK</span> (age <span class="operator">&gt;=</span> <span class="number">18</span>);</span><br></pre></td></tr></table></figure>

<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, age) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">20</span>); <span class="comment">-- ✅ 正确</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> users (id, age) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">15</span>); <span class="comment">-- ❌ 错误，age 不能小于 18</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>2.6 <code>DEFAULT</code>（默认值约束）</strong></p>
<ul>
<li><strong>为字段提供默认值</strong>，当插入数据时未指定该字段时，使用默认值。</li>
</ul>
<p><strong>(1) <code>DEFAULT</code> 约束</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    status <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;active&#x27;</span>  <span class="comment">-- 默认值为 &#x27;active&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id) <span class="keyword">VALUES</span> (<span class="number">1</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users; </span><br><span class="line"><span class="comment">-- 结果: id=1, status=&#x27;active&#x27; (未提供 status，自动填充默认值)</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>3. 删除约束</strong><br>如果表已创建，如何删除约束？</p>
<table>
<thead>
<tr>
<th><strong>约束类型</strong></th>
<th><strong>删除方式</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>主键</strong></td>
<td><code>ALTER TABLE table_name DROP PRIMARY KEY;</code></td>
</tr>
<tr>
<td><strong>外键</strong></td>
<td><code>ALTER TABLE table_name DROP FOREIGN KEY fk_name;</code></td>
</tr>
<tr>
<td><strong>唯一约束</strong></td>
<td><code>ALTER TABLE table_name DROP INDEX index_name;</code></td>
</tr>
<tr>
<td><strong>检查约束</strong></td>
<td><code>ALTER TABLE table_name DROP CONSTRAINT constraint_name;</code></td>
</tr>
</tbody></table>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> unique_email; <span class="comment">-- 删除唯一约束</span></span><br><span class="line"><span class="keyword">ALTER TABLE</span> orders <span class="keyword">DROP</span> <span class="keyword">FOREIGN KEY</span> fk_user_id; <span class="comment">-- 删除外键</span></span><br></pre></td></tr></table></figure>

<hr>
<p><strong>4. 总结</strong></p>
<table>
<thead>
<tr>
<th><strong>约束类型</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>PRIMARY KEY</code></td>
<td>确保字段唯一且非空，表的主键</td>
</tr>
<tr>
<td><code>FOREIGN KEY</code></td>
<td>关联其他表的主键，保证数据完整性</td>
</tr>
<tr>
<td><code>UNIQUE</code></td>
<td>确保字段值唯一</td>
</tr>
<tr>
<td><code>NOT NULL</code></td>
<td>确保字段不为空</td>
</tr>
<tr>
<td><code>CHECK</code></td>
<td>约束字段值符合某个规则（如 <code>age &gt;= 18</code>）</td>
</tr>
<tr>
<td><code>DEFAULT</code></td>
<td>提供字段默认值</td>
</tr>
</tbody></table>
<p>✅ <strong>建议</strong></p>
<ol>
<li><strong><code>PRIMARY KEY</code> 一般用于 <code>id</code> 字段</strong>，确保每条数据唯一。</li>
<li><strong><code>FOREIGN KEY</code> 用于关联表</strong>，避免无效数据。</li>
<li><strong><code>UNIQUE</code> 适用于 <code>email</code>、<code>phone</code> 等需要唯一性的字段</strong>。</li>
<li><strong><code>NOT NULL</code> 适用于 <code>name</code>、<code>age</code> 等不能为空的字段</strong>。</li>
<li><strong><code>CHECK</code> 适用于 <code>age</code>、<code>salary</code> 之类的数据校验（MySQL 8.0+）</strong>。</li>
<li><strong><code>DEFAULT</code> 避免 <code>NULL</code> 值，提升数据完整性</strong>。</li>
</ol>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引（Index）是一种 <strong>加速数据库查询</strong> 的数据结构，类似于 <strong>书的目录</strong>，可以提高 <code>SELECT</code> 语句的查询效率，同时也会影响 <code>INSERT</code>、<code>UPDATE</code>、<code>DELETE</code> 的性能。</p>
<hr>
<p><strong>1. 为什么需要索引？</strong><br>在没有索引的情况下，MySQL 需要 <strong>全表扫描</strong> 来查找数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;test@example.com&#x27;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>如果 <code>users</code> 表有 100 万条数据</strong>，MySQL 必须检查每一行，导致查询 <strong>很慢</strong>。</li>
<li><strong>如果 <code>email</code> 字段有索引</strong>，MySQL 直接 <strong>查找索引</strong>，就像翻书找目录一样，速度 <strong>更快</strong>！</li>
</ul>
<hr>
<p><strong>2. 索引的类型</strong></p>
<table>
<thead>
<tr>
<th><strong>索引类型</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>PRIMARY KEY</strong> （主键索引）</td>
<td><strong>唯一标识每行数据</strong>，默认创建索引</td>
</tr>
<tr>
<td><strong>UNIQUE</strong> （唯一索引）</td>
<td><strong>确保数据唯一</strong>，提高查询速度</td>
</tr>
<tr>
<td><strong>INDEX</strong> （普通索引）</td>
<td>提高查询速度，但不保证唯一性</td>
</tr>
<tr>
<td><strong>FULLTEXT</strong> （全文索引）</td>
<td>用于<strong>全文搜索</strong>（<code>LIKE</code> 查询不适用）</td>
</tr>
<tr>
<td><strong>COMPOSITE INDEX</strong>（组合索引）</td>
<td><strong>多个列组成一个索引</strong>，提高查询效率</td>
</tr>
<tr>
<td><strong>SPATIAL INDEX</strong> （空间索引）</td>
<td><strong>地理空间数据</strong>，适用于 GIS</td>
</tr>
</tbody></table>
<hr>
<p><strong>3. 如何创建索引？</strong><br><strong>3.1 <code>PRIMARY KEY</code>（主键索引）</strong><br>主键索引在创建表时自动生成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>说明</strong>：<code>id</code> 是主键，自动生成索引。</p>
<hr>
<p> <strong>3.2 <code>UNIQUE</code>（唯一索引）</strong><br><strong>防止重复数据</strong>，比如 <code>email</code> 不能重复：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>或者单独创建唯一索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>查询优化</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> email <span class="operator">=</span> <span class="string">&#x27;test@example.com&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>如果 <code>email</code> 没有索引</strong>，查询需要 <strong>全表扫描</strong>，性能很低。<br><strong>如果 <code>email</code> 有索引</strong>，MySQL 直接查找索引，查询 <strong>更快</strong>！</p>
<hr>
<p> <strong>3.3 <code>INDEX</code>（普通索引）</strong><br>普通索引 <strong>仅用于加速查询</strong>，不保证唯一性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name <span class="keyword">ON</span> users(name);</span><br></pre></td></tr></table></figure>
<p>适用于<strong>经常查询但不要求唯一的字段</strong>，如 <code>name</code>、<code>age</code>。</p>
<hr>
<p> <strong>3.4 <code>FULLTEXT</code>（全文索引，适用于文本搜索）</strong><br>适用于 <code>TEXT</code> 或 <code>VARCHAR</code> 类型的大量文本搜索：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> articles (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">255</span>),</span><br><span class="line">    content TEXT,</span><br><span class="line">    FULLTEXT (title, content)  <span class="comment">-- 对标题和内容创建全文索引</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>优化文本搜索</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> articles <span class="keyword">WHERE</span> <span class="keyword">MATCH</span>(title, content) AGAINST(<span class="string">&#x27;MySQL 索引&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>⚠ <strong><code>FULLTEXT</code> 仅适用于 <code>MyISAM</code> 和 <code>InnoDB（MySQL 5.6+）</code>，不能用于 <code>LIKE &#39;%xx%&#39;</code> 查询！</strong></p>
<hr>
<p> <strong>3.5 <code>COMPOSITE INDEX</code>（组合索引）</strong><br>组合索引可以提升 <strong>多列查询的效率</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age <span class="keyword">ON</span> users(name, age);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>优化查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;Alice&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure>
<p>🚀 <strong>索引的使用规则（最左前缀原则）：</strong></p>
<ul>
<li><code>idx_name_age(name, age)</code><ul>
<li><strong>✔ <code>WHERE name = &#39;Alice&#39; AND age = 25</code></strong> ✅ <strong>可以用索引</strong></li>
<li><strong>✔ <code>WHERE name = &#39;Alice&#39;</code></strong> ✅ <strong>可以用索引</strong></li>
<li><strong>❌ <code>WHERE age = 25</code></strong> ❌ <strong>无法使用索引（顺序问题）</strong></li>
</ul>
</li>
</ul>
<hr>
<p> <strong>4. 如何查看索引？</strong><br> <strong>4.1 查询表的索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> INDEX <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<p><strong>返回结果示例</strong>：</p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Non_unique</th>
<th>Key_name</th>
<th>Column_name</th>
<th>Index_type</th>
</tr>
</thead>
<tbody><tr>
<td>users</td>
<td>0</td>
<td>PRIMARY</td>
<td>id</td>
<td>BTREE</td>
</tr>
<tr>
<td>users</td>
<td>1</td>
<td>idx_name</td>
<td>name</td>
<td>BTREE</td>
</tr>
</tbody></table>
<p> <strong>4.2 <code>EXPLAIN</code> 分析索引使用情况</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;Alice&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>返回结果示例</strong></p>
<table>
<thead>
<tr>
<th>id</th>
<th>select_type</th>
<th>table</th>
<th>type</th>
<th>key</th>
<th>rows</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>SIMPLE</td>
<td>users</td>
<td>ref</td>
<td>idx_name</td>
<td>1</td>
</tr>
</tbody></table>
<p>🔍 <strong><code>key=idx_name</code> 说明索引 <code>idx_name</code> 被使用</strong>，查询优化成功！</p>
<hr>
<p> <strong>5. 如何删除索引？</strong><br> <strong>5.1 删除普通索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX idx_name <span class="keyword">ON</span> users;</span><br></pre></td></tr></table></figure>

<p> <strong>5.2 删除唯一索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> INDEX idx_email;</span><br></pre></td></tr></table></figure>

<p> <strong>5.3 删除主键索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER TABLE</span> users <span class="keyword">DROP</span> <span class="keyword">PRIMARY KEY</span>;</span><br></pre></td></tr></table></figure>
<p>⚠ <strong>注意：</strong> 如果 <code>PRIMARY KEY</code> 被删除，表中不能再有 <code>AUTO_INCREMENT</code>！</p>
<hr>
<p> <strong>6. 索引的优缺点</strong><br> <strong>✅ 优势</strong></p>
<ol>
<li><strong>加快查询速度</strong>（减少 <code>WHERE</code> 语句的查询时间）。</li>
<li><strong>提高 <code>ORDER BY</code>、<code>GROUP BY</code> 的效率</strong>。</li>
<li><strong>减少磁盘 I&#x2F;O 读取</strong>。</li>
</ol>
<p> <strong>❌ 缺点</strong></p>
<ol>
<li><strong>影响 <code>INSERT</code> &#x2F; <code>UPDATE</code> &#x2F; <code>DELETE</code> 性能</strong>（索引需要同步更新）。</li>
<li><strong>占用存储空间</strong>（索引需要额外的磁盘空间）。</li>
<li><strong>错误使用可能导致索引失效</strong>。</li>
</ol>
<hr>
<p> <strong>7. 索引优化技巧</strong></p>
<table>
<thead>
<tr>
<th><strong>场景</strong></th>
<th><strong>优化方案</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>大量查询，少量更新</strong></td>
<td>使用索引</td>
</tr>
<tr>
<td><strong>频繁 <code>INSERT</code> &#x2F; <code>UPDATE</code></strong></td>
<td>尽量减少索引数量</td>
</tr>
<tr>
<td><strong><code>LIKE &#39;%xx%&#39;</code> 查询</strong></td>
<td>使用 <code>FULLTEXT</code>，避免 <code>LIKE &#39;%xx%&#39;</code></td>
</tr>
<tr>
<td><strong>多个 <code>WHERE</code> 条件</strong></td>
<td>使用<strong>组合索引</strong></td>
</tr>
<tr>
<td><strong>主键查询</strong></td>
<td>使用 <code>PRIMARY KEY</code></td>
</tr>
</tbody></table>
<hr>
<p> <strong>8. 总结</strong></p>
<table>
<thead>
<tr>
<th><strong>索引类型</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>PRIMARY KEY</code></td>
<td>唯一标识每行数据，默认有索引</td>
</tr>
<tr>
<td><code>UNIQUE</code></td>
<td>确保字段唯一，防止重复数据</td>
</tr>
<tr>
<td><code>INDEX</code></td>
<td>普通索引，加速查询</td>
</tr>
<tr>
<td><code>FULLTEXT</code></td>
<td>适用于全文搜索</td>
</tr>
<tr>
<td><code>COMPOSITE INDEX</code></td>
<td>组合多个字段，提高查询性能</td>
</tr>
</tbody></table>
<p>✅ <strong>最佳实践</strong></p>
<ol>
<li><strong>主键字段必须有索引</strong>。</li>
<li><strong>查询频繁的字段应该加索引</strong>，如 <code>email</code>、<code>phone</code>。</li>
<li><strong>避免 <code>LIKE &#39;%xx%&#39;</code>，使用 <code>FULLTEXT</code> 代替</strong>。</li>
<li><strong><code>ORDER BY</code>、<code>GROUP BY</code> 应该使用索引字段</strong>。</li>
<li><strong>索引不是越多越好，避免影响 <code>INSERT</code>&#x2F;<code>UPDATE</code>&#x2F;<code>DELETE</code> 性能</strong>。</li>
</ol>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器（Trigger）是一种 <strong>自动执行的 SQL 语句</strong>，当 <strong>INSERT、UPDATE 或 DELETE</strong> 操作发生时，触发器会 <strong>自动触发</strong> 预定义的操作。它主要用于 <strong>数据完整性维护、日志记录、自动计算等</strong>。</p>
<hr>
<p> <strong>1. 为什么使用触发器？</strong><br>✅ <strong>自动执行 SQL 逻辑</strong><br>✅ <strong>保证数据完整性</strong><br>✅ <strong>自动记录日志</strong><br>✅ <strong>减少手动 SQL 语句</strong></p>
<p><strong>示例：</strong></p>
<ul>
<li><strong>用户删除时，自动删除关联订单</strong></li>
<li><strong>订单更新时，自动更新库存</strong></li>
<li><strong>记录数据变更日志</strong></li>
</ul>
<hr>
<p> <strong>2. 触发器的基本语法</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> 触发器名</span><br><span class="line">&#123; BEFORE <span class="operator">|</span> AFTER &#125; &#123; <span class="keyword">INSERT</span> <span class="operator">|</span> <span class="keyword">UPDATE</span> <span class="operator">|</span> <span class="keyword">DELETE</span> &#125;</span><br><span class="line"><span class="keyword">ON</span> 表名</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="comment">-- 触发的 SQL 语句</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>3. 触发器的类型</strong></p>
<table>
<thead>
<tr>
<th><strong>触发时机</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>BEFORE INSERT</code></td>
<td><strong>插入数据前</strong> 触发，可用于<strong>数据校验、默认值</strong></td>
</tr>
<tr>
<td><code>AFTER INSERT</code></td>
<td><strong>插入数据后</strong> 触发，可用于<strong>日志记录</strong></td>
</tr>
<tr>
<td><code>BEFORE UPDATE</code></td>
<td><strong>更新数据前</strong> 触发，可用于<strong>检查旧数据</strong></td>
</tr>
<tr>
<td><code>AFTER UPDATE</code></td>
<td><strong>更新数据后</strong> 触发，可用于<strong>计算衍生值</strong></td>
</tr>
<tr>
<td><code>BEFORE DELETE</code></td>
<td><strong>删除数据前</strong> 触发，可用于<strong>检查权限</strong></td>
</tr>
<tr>
<td><code>AFTER DELETE</code></td>
<td><strong>删除数据后</strong> 触发，可用于<strong>日志记录</strong></td>
</tr>
</tbody></table>
<hr>
<p> <strong>4. 触发器的创建</strong><br> <strong>4.1 <code>BEFORE INSERT</code>（插入前触发）</strong></p>
<ul>
<li><strong>确保用户年龄 <code>age &gt;= 18</code>，否则自动修改</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_insert_user</span><br><span class="line">BEFORE <span class="keyword">INSERT</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF NEW.age <span class="operator">&lt;</span> <span class="number">18</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> NEW.age <span class="operator">=</span> <span class="number">18</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p><strong>解释：</strong></p>
<ul>
<li><code>NEW.age</code> 代表 <strong>新插入的数据</strong></li>
<li><strong>如果 <code>age</code> 小于 18，自动改为 18</strong></li>
</ul>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name, age) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Alice&#x27;</span>, <span class="number">16</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br><span class="line"><span class="comment">-- age 被自动修改为 18</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>4.2 <code>AFTER INSERT</code>（插入后触发）</strong></p>
<ul>
<li><strong>插入用户时，自动写入 <code>user_logs</code> 日志</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_insert_user</span><br><span class="line">AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> user_logs (user_id, action) <span class="keyword">VALUES</span> (NEW.id, <span class="string">&#x27;User Created&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (id, name) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> user_logs;</span><br><span class="line"><span class="comment">-- 记录：&quot;User Created&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>4.3 <code>BEFORE UPDATE</code>（更新前触发）</strong></p>
<ul>
<li><strong>防止 <code>salary</code> 低于 <code>3000</code></strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_update_salary</span><br><span class="line">BEFORE <span class="keyword">UPDATE</span> <span class="keyword">ON</span> employees</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF NEW.salary <span class="operator">&lt;</span> <span class="number">3000</span> <span class="keyword">THEN</span></span><br><span class="line">        <span class="keyword">SET</span> NEW.salary <span class="operator">=</span> <span class="number">3000</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">2500</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="comment">-- salary 自动变成 3000</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>4.4 <code>AFTER UPDATE</code>（更新后触发）</strong></p>
<ul>
<li><strong>记录薪资变更日志</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_update_salary</span><br><span class="line">AFTER <span class="keyword">UPDATE</span> <span class="keyword">ON</span> employees</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> salary_logs (employee_id, old_salary, new_salary)</span><br><span class="line">    <span class="keyword">VALUES</span> (OLD.id, OLD.salary, NEW.salary);</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees <span class="keyword">SET</span> salary <span class="operator">=</span> <span class="number">5000</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> salary_logs;</span><br><span class="line"><span class="comment">-- 记录：&quot;old_salary: 3000, new_salary: 5000&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>4.5 <code>BEFORE DELETE</code>（删除前触发）</strong></p>
<ul>
<li><strong>防止删除 <code>admin</code> 账户</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> before_delete_admin</span><br><span class="line">BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    IF OLD.role <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span> <span class="keyword">THEN</span></span><br><span class="line">        SIGNAL <span class="keyword">SQLSTATE</span> <span class="string">&#x27;45000&#x27;</span></span><br><span class="line">        <span class="keyword">SET</span> MESSAGE_TEXT <span class="operator">=</span> <span class="string">&#x27;Cannot delete admin user&#x27;</span>;</span><br><span class="line">    <span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> role <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="comment">-- 报错：&quot;Cannot delete admin user&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>4.6 <code>AFTER DELETE</code>（删除后触发）</strong></p>
<ul>
<li><strong>删除用户时，自动写入 <code>delete_logs</code></strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> after_delete_user</span><br><span class="line">AFTER <span class="keyword">DELETE</span> <span class="keyword">ON</span> users</span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">INSERT INTO</span> delete_logs (user_id, deleted_at)</span><br><span class="line">    <span class="keyword">VALUES</span> (OLD.id, NOW());</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>示例</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> delete_logs;</span><br><span class="line"><span class="comment">-- 记录：&quot;user_id: 5, deleted_at: 2025-02-23&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>5. 查看 &amp; 删除触发器</strong><br> <strong>5.1 查看所有触发器</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS;</span><br></pre></td></tr></table></figure>
<p> <strong>5.2 查看某张表的触发器</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> TRIGGERS <span class="keyword">LIKE</span> <span class="string">&#x27;users&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p> <strong>5.3 删除触发器</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> after_insert_user;</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>6. 触发器 vs. 存储过程 vs. 事务</strong></p>
<table>
<thead>
<tr>
<th><strong>对比项</strong></th>
<th><strong>触发器（Trigger）</strong></th>
<th><strong>存储过程（Stored Procedure）</strong></th>
<th><strong>事务（Transaction）</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>执行方式</strong></td>
<td><strong>自动触发</strong></td>
<td><strong>手动调用</strong></td>
<td><strong>手动提交&#x2F;回滚</strong></td>
</tr>
<tr>
<td><strong>作用</strong></td>
<td><strong>响应表操作（增删改）</strong></td>
<td><strong>封装 SQL 逻辑</strong></td>
<td><strong>保证数据一致性</strong></td>
</tr>
<tr>
<td><strong>适用场景</strong></td>
<td><strong>数据校验、日志记录</strong></td>
<td><strong>批量操作</strong></td>
<td><strong>多个 SQL 操作确保原子性</strong></td>
</tr>
<tr>
<td><strong>控制事务</strong></td>
<td>❌ <strong>不能 <code>COMMIT/ROLLBACK</code></strong></td>
<td>✅ <strong>支持事务</strong></td>
<td>✅ <strong>核心功能</strong></td>
</tr>
</tbody></table>
<hr>
<p> <strong>7. 触发器的优缺点</strong><br> <strong>✅ 优势</strong></p>
<ol>
<li><strong>自动执行</strong>（减少手动 SQL 语句）</li>
<li><strong>增强数据完整性</strong>（防止不合法数据）</li>
<li><strong>可用于日志记录</strong></li>
</ol>
<p> <strong>❌ 缺点</strong></p>
<ol>
<li><strong>调试困难</strong>（不易追踪触发器何时执行）</li>
<li><strong>性能问题</strong>（不当使用可能影响查询速度）</li>
<li><strong>无法触发 <code>COMMIT/ROLLBACK</code></strong></li>
</ol>
<hr>
<p> <strong>8. 触发器的最佳实践</strong><br>🚀 <strong>如何正确使用触发器？</strong><br>✅ <strong>仅在必要时使用触发器</strong>，避免滥用影响性能<br>✅ <strong>不适用于复杂业务逻辑</strong>，存储过程更合适<br>✅ <strong>调试时使用 <code>SHOW TRIGGERS</code> 和 <code>EXPLAIN</code></strong><br>✅ <strong>日志触发器是最佳用途（AFTER INSERT, AFTER DELETE）</strong>  </p>
<hr>
<p> <strong>9. 总结</strong></p>
<table>
<thead>
<tr>
<th><strong>触发器类型</strong></th>
<th><strong>适用场景</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>BEFORE INSERT</code></td>
<td><strong>数据校验、默认值</strong></td>
</tr>
<tr>
<td><code>AFTER INSERT</code></td>
<td><strong>日志记录、关联操作</strong></td>
</tr>
<tr>
<td><code>BEFORE UPDATE</code></td>
<td><strong>限制更新数据</strong></td>
</tr>
<tr>
<td><code>AFTER UPDATE</code></td>
<td><strong>记录变更日志</strong></td>
</tr>
<tr>
<td><code>BEFORE DELETE</code></td>
<td><strong>防止误删数据</strong></td>
</tr>
<tr>
<td><code>AFTER DELETE</code></td>
<td><strong>自动写入删除日志</strong></td>
</tr>
</tbody></table>
<h2 id="数据库安全"><a href="#数据库安全" class="headerlink" title="数据库安全"></a>数据库安全</h2><p>数据库安全（Database Security）指的是 <strong>防止未经授权的访问、数据泄露、篡改和破坏</strong>，确保数据的 <strong>机密性、完整性和可用性</strong>。</p>
<hr>
<p> <strong>1. 为什么数据库安全很重要？</strong><br>✅ <strong>防止数据泄露</strong>（用户隐私、企业机密）<br>✅ <strong>防止 SQL 注入</strong>（黑客攻击）<br>✅ <strong>保护数据完整性</strong>（防止误操作）<br>✅ <strong>控制访问权限</strong>（避免数据被随意修改）  </p>
<p><strong>示例安全问题：</strong></p>
<ul>
<li><strong>SQL 注入</strong>：攻击者输入恶意 SQL，获取&#x2F;删除数据</li>
<li><strong>弱密码</strong>：使用 <code>root/root</code> 导致数据库被入侵</li>
<li><strong>权限过大</strong>：所有用户都能 <code>DROP TABLE</code>，风险极高</li>
<li><strong>数据未加密</strong>：黑客窃取数据库后可直接查看用户信息</li>
</ul>
<hr>
<p> <strong>2. 用户管理与权限控制</strong><br>MySQL 提供 <strong>用户管理</strong> 和 <strong>权限分配</strong> 来控制访问。</p>
<p> <strong>2.1 创建用户</strong><br>默认情况下，MySQL 只有 <code>root</code> 超级管理员，建议创建普通用户：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;StrongPass123!&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>最佳实践</strong></p>
<ul>
<li><strong>使用强密码</strong>（大写+小写+数字+特殊字符）</li>
<li><strong>限制 IP 访问</strong>（<code>localhost</code> 表示只能本机访问）</li>
</ul>
<hr>
<p> <strong>2.2 授权权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, <span class="keyword">INSERT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">TO</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>说明</strong></p>
<ul>
<li><code>SELECT, INSERT</code>：仅允许查询和插入数据</li>
<li><code>mydb.*</code>：对 <code>mydb</code> 数据库的所有表生效</li>
<li><strong>避免 <code>GRANT ALL</code>（超级权限）！</strong></li>
</ul>
<hr>
<p> <strong>2.3 撤销权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> mydb.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>🔍 <strong>查看用户权限</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> GRANTS <span class="keyword">FOR</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>2.4 删除用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;test_user&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>3. 防止 SQL 注入</strong><br>SQL 注入是最常见的数据库攻击方式，攻击者通过输入恶意 SQL 代码破坏数据库。</p>
<p> <strong>3.1 SQL 注入示例</strong><br><strong>❌ 不安全代码</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;$input_username&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;$input_password&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><strong>攻击者输入</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; OR &#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><strong>实际执行的 SQL</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">OR</span> <span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">AND</span> password <span class="operator">=</span> <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>绕过验证，所有用户信息泄露！</strong></p>
<hr>
<p> <strong>3.2 防范 SQL 注入</strong><br>✅ <strong>使用</strong> <strong>预编译查询（Prepared Statement）</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$stmt</span> = <span class="variable">$pdo</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;</span>);</span><br><span class="line"><span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>([<span class="variable">$username</span>, <span class="variable">$password</span>]);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>永远不要直接拼接 SQL 语句</strong><br>✅ <strong>限制用户权限，避免 <code>DROP</code> 或 <code>DELETE</code> 整个数据库</strong><br>✅ <strong>使用 Web 应用防火墙（WAF）</strong></p>
<hr>
<p> <strong>4. 数据加密</strong><br>即使攻击者获取了数据库，也不能直接查看敏感信息。</p>
<p> <strong>4.1 密码加密</strong><br>❌ <strong>错误做法</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (username, password) <span class="keyword">VALUES</span> (<span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>✅ <strong>正确做法</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT INTO</span> users (username, password) <span class="keyword">VALUES</span> (<span class="string">&#x27;Alice&#x27;</span>, SHA2(<span class="string">&#x27;123456&#x27;</span>, <span class="number">256</span>));</span><br></pre></td></tr></table></figure>
<p>🔍 <strong>检查加密密码</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> username, password <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure>
<p>🚀 <strong>推荐哈希算法</strong></p>
<ul>
<li><code>SHA2(&#39;password&#39;, 256)</code> （MySQL 内置）</li>
<li><code>bcrypt</code>（更安全，需要应用层处理）</li>
</ul>
<hr>
<p> <strong>5. 备份与恢复</strong><br>💾 <strong>定期备份数据库，防止数据丢失</strong></p>
<p> <strong>5.1 备份数据库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u root -p mydb &gt; mydb_backup.sql</span><br></pre></td></tr></table></figure>
<p> <strong>5.2 恢复数据库</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p mydb &lt; mydb_backup.sql</span><br></pre></td></tr></table></figure>
<p>✅ <strong>最佳实践</strong></p>
<ul>
<li><strong>自动化备份（每日 &#x2F; 每周）</strong></li>
<li><strong>使用 <code>binlog</code>（二进制日志）记录变更</strong></li>
<li><strong>备份文件加密存储，防止被窃取</strong></li>
</ul>
<hr>
<p> <strong>6. 限制连接与访问控制</strong><br>✅ <strong>限制 root 远程访问</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> mysql.user <span class="keyword">SET</span> host<span class="operator">=</span><span class="string">&#x27;localhost&#x27;</span> <span class="keyword">WHERE</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>防止暴力破解</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">WITH</span> MAX_CONNECTIONS_PER_HOUR <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>使用防火墙（如 <code>iptables</code>）限制数据库访问</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> iptables -A INPUT -p tcp --dport 3306 -s 192.168.1.100 -j ACCEPT</span><br></pre></td></tr></table></figure>
<p>✅ <strong>定期检查连接用户</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">user</span>, host <span class="keyword">FROM</span> mysql.user;</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>7. 审计日志</strong><br><strong>监控所有数据库操作，发现异常访问</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FULL</span> PROCESSLIST;</span><br></pre></td></tr></table></figure>
<p>✅ <strong>启用 MySQL 日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">log_error = /var/log/mysql/error.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 2</span><br></pre></td></tr></table></figure>
<p>🚀 <strong>分析日志</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -f /var/log/mysql/error.log</span><br></pre></td></tr></table></figure>

<hr>
<p> <strong>8. 总结</strong></p>
<table>
<thead>
<tr>
<th><strong>安全措施</strong></th>
<th><strong>方法</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>用户权限管理</strong></td>
<td><code>GRANT</code> &#x2F; <code>REVOKE</code></td>
</tr>
<tr>
<td><strong>防止 SQL 注入</strong></td>
<td><strong>预编译查询、限制用户权限</strong></td>
</tr>
<tr>
<td><strong>密码加密</strong></td>
<td><code>SHA2()</code> &#x2F; <code>bcrypt</code></td>
</tr>
<tr>
<td><strong>定期备份</strong></td>
<td><code>mysqldump</code> &#x2F; <code>binlog</code></td>
</tr>
<tr>
<td><strong>限制远程访问</strong></td>
<td><code>iptables</code> &#x2F; <code>host 限制</code></td>
</tr>
<tr>
<td><strong>日志审计</strong></td>
<td><strong>启用 <code>slow_query_log</code>，检查异常 SQL</strong></td>
</tr>
</tbody></table>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" rel="tag"># 读书笔记</a>
              <a href="/tags/SQL/" rel="tag"># SQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/02/20/%E9%9D%A2%E7%BB%8F-%E5%92%A8%E8%AF%A2-%E5%AE%9A%E9%87%8F%E7%A0%94%E7%A9%B6/" rel="prev" title="面经/咨询/定量研究">
                  <i class="fa fa-angle-left"></i> 面经/咨询/定量研究
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/02/21/%E9%9D%A2%E7%BB%8F-%E5%9B%BD%E4%BC%81-%E6%95%B0%E5%AD%97%E5%8C%96%E5%92%A8%E8%AF%A2/" rel="next" title="面经/国企/数字化咨询">
                  面经/国企/数字化咨询 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hakuxc在存档</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
